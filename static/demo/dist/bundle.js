webpackJsonp([0],{157:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(54),r=n(159);t.App=function(){return o.createElement(o.View,null,o.createElement(o.Text,null,"TEST"),o.createElement(r.LookupLscTest,null))}},159:function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function u(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,u)}s((o=o.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(a=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,a,u,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u};Object.defineProperty(t,"__esModule",{value:!0});var a=n(54),u=n(160),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.notifyUpdate=function(e,n,o){return r(t,void 0,void 0,function(){var t;return i(this,function(r){return t=e,this.setState({cancel:o,hasStarted:!0,timeToExpireSeconds:n,obj:t}),[2]})})},t.downloadTimeoutId=0,t.download=function(e){void 0===e&&(e=1e3),clearTimeout(t.downloadTimeoutId),t.downloadTimeoutId=setTimeout(function(){return r(t,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return this.state.cancel&&this.state.cancel(),[4,u.lookupLscDataAccess.readAndUpdate({containerName:this.state.containerName,blobName:this.state.blobName},{shouldAutoRefresh:!0},this.notifyUpdate)];case 1:return e=t.sent(),this.setState({hasStarted:!0,timeToExpireSeconds:void 0,obj:e}),[2]}})})},e)},t.setContainerName=function(e){t.setState({containerName:e}),t.download(3e3)},t.setBlobName=function(e){t.setState({blobName:e}),t.download(3e3)},t}return o(t,e),t.prototype.render=function(){return this.state.hasStarted||(this.setState({containerName:"test",blobName:"test",hasStarted:!0}),this.download(0)),a.createElement(a.View,null,a.createElement(a.Text,null,"hasStarted: ",""+this.state.hasStarted),a.createElement(a.Text,null,"timeToExpireSeconds: ",""+this.state.timeToExpireSeconds),a.createElement(a.Text,null,JSON.stringify(this.state.obj)),a.createElement(a.View,null,"Container: ",a.createElement(a.TextInput,{value:this.state.containerName,onChangeText:this.setContainerName})),a.createElement(a.View,null,"Blob: ",a.createElement(a.TextInput,{value:this.state.blobName,onChangeText:this.setBlobName})))},t}(a.Component);t.LookupLscTest=s},160:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(164),r=n(412);t.lookupLscDataAccess=new o.DataAccess(r.clientConfig_lookupLsc)},161:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(54),r=n(157);o.App.initialize(!0,!0),o.UserInterface.setMainView(o.createElement(r.App,null))},162:function(e,t,n){"use strict";function o(e,t){return e.reduce(function(e,n){var o=t(n);return(e[o]=e[o]||{items:[]}).items.push(n),e},{})}function r(e,t){var n=o(e,t);return Object.getOwnPropertyNames(n).map(function(e){return n[e].items})}function i(e,t){for(var n in t)e[n]=t[n];return e}Object.defineProperty(t,"__esModule",{value:!0}),t.group=o,t.groupToArray=r,t.assignPartial=i},163:function(e,t,n){"use strict";function o(e,t,n){void 0===t&&(t=1e3),n=n||{};var o=n.maxTime,r=n.maxAttempts||(o?void 0:5),u=n.base||2,s=i.length;i.push(0);var l=-1,c=function(){if(e(),i[s]!==a&&(l++,!r||l<r)){var n=t*Math.pow(u,l),f=o?Math.min(o,n):n;console.log("setInterval_exponentialBackoff",{actualTime:f,backoffTime:n,timeMs:t,maxTime:o,maxAttempts:r,base:u}),i[s]=setTimeout(function(){c()},f)}};return c(),s}function r(e){clearTimeout(i[e]),i[e]=a}Object.defineProperty(t,"__esModule",{value:!0});var i=[],a=-1;t.setInterval_exponentialBackoff=o,t.clearInterval_exponentialBackoff=r},164:function(e,t,n){"use strict";function o(e,t){return s(this,void 0,void 0,function(){var n;return l(this,function(o){switch(o.label){case 0:return[4,r(e,t)];case 1:return n=o.sent().data,[2,n]}})})}function r(e,t){return s(this,void 0,void 0,function(){var n,o;return l(this,function(r){switch(r.label){case 0:return[4,c.default(e.getLookupUrl(t))];case 1:return n=r.sent(),[4,n.json()];case 2:return o=r.sent(),o.error?[2,{data:null,lookup:o}]:[3,3];case 3:return[4,i(e,t,o)];case 4:return[2,r.sent()]}})})}function i(e,t,n){return s(this,void 0,void 0,function(){var o,r;return l(this,function(i){switch(i.label){case 0:return[4,c.default(e.getDataDownloadUrl(t,n))];case 1:return o=i.sent(),[4,o.json()];case 2:return r=i.sent(),[2,{data:r,lookup:n}]}})})}function a(e,t,n,o){return s(this,void 0,void 0,function(){var a,d,p,h,b,m,v=this;return l(this,function(y){switch(y.label){case 0:return[4,r(e,t)];case 1:return a=y.sent(),d=a.data,p=a.lookup,o&&(h=0,b=function(){clearInterval(h),f.clearInterval_exponentialBackoff(h)},m=function(){return s(v,void 0,void 0,function(){var r,a,s;return l(this,function(l){switch(l.label){case 0:return console.log("readAppBlobAndUpdate lookupLoop"),r=p,[4,c.default(e.getLookupUrl(t))];case 1:return a=l.sent(),[4,a.json()];case 2:return p=l.sent(),JSON.stringify(r)===JSON.stringify(p)?[3,6]:JSON.stringify(r.timeKey)===JSON.stringify(p.timeKey)?[3,5]:p.error?(o(null,p.timeToExpireSeconds,b),[3,5]):[3,3];case 3:return[4,i(e,t,p)];case 4:s=l.sent().data;try{o(s,p.timeToExpireSeconds,b)}catch(e){console.error("readAppBlobAndUpdate notifyUpdate ERROR",{err:e})}l.label=5;case 5:n.shouldAutoRefresh&&(console.log("readAppBlobAndUpdate AutoRefresh",u({},p)),b(),h=setInterval(m,1e3*p.timeToExpireSeconds)),l.label=6;case 6:return[2]}})})},console.log("readAppBlobAndUpdate Loop Start",u({},p)),h=f.setInterval_exponentialBackoff(m,1e3*p.timeToExpireSeconds/7,{maxTime:1e3*e.timeToLiveSeconds})),[2,d]}})})}var u=this&&this.__assign||Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function u(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,u)}s((o=o.apply(e,t||[])).next())})},l=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(a=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,a,u,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u};Object.defineProperty(t,"__esModule",{value:!0});var c=n(407),f=n(163),d=function(){function e(e){this.config=e}return e.prototype.read=function(e){return s(this,void 0,void 0,function(){return l(this,function(t){return[2,o(this.config,e)]})})},e.prototype.readAndUpdate=function(e,t,n){return s(this,void 0,void 0,function(){return l(this,function(o){return[2,a(this.config,e,t,n)]})})},e}();t.DataAccess=d,t.readAppBlob=o,t.readAppBlob_inner=r,t.readAppBlobData=i,t.readAppBlobAndUpdate=a},165:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(162),r=function(){function e(e){this.timePollSeconds=1,this.maxPollCount=5,this.timeToLiveSeconds=60,this.lookup_domain="/",this.lookup_route="api/lookup-lsc",this.downloadBlob_domain="/",this.downloadBlob_route="blob",this.shouldGzipDownloadBlob=!1,o.assignPartial(this,e)}return e.prototype.getLookupUrl=function(e){return this.lookup_domain+"/"+this.lookup_route+"/"+e.containerName+"/"+e.blobName},e.prototype.getDataDownloadUrl=function(e,t){return this.downloadBlob_domain+"/"+(this.downloadBlob_route?this.downloadBlob_route+"/":"")+e.containerName+"/"+this.getDataDownloadBlobName(e.blobName,t)},e.prototype.getDataDownloadBlobName=function(e,t){return e+"/"+t.timeKey+(this.shouldGzipDownloadBlob?"_gzip":"")},e}();t.ClientConfig=r},410:function(e,t){},411:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(165);t.clientConfig=new o.ClientConfig({lookup_domain:"https://told-stack-demo.azureedge.net",downloadBlob_domain:"https://told-stack-demo.azureedge.net",lookup_route:"api/lookup-lsc",downloadBlob_route:"api/lookup-lsc-download"})},412:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(411);t.clientConfig_lookupLsc=o.clientConfig}},[161]);
//# sourceMappingURL=bundle.js.map