{"version":3,"sources":["webpack:///bundle.js","webpack:///./src/app/app.tsx","webpack:///./../config/src/lookup-lsc/client.ts","webpack:///./src/config.ts","webpack:///./src/index.tsx","webpack:///./../../../told-stack-npm/src/core/utils/objects.ts","webpack:///./../../../told-stack-npm/src/data-patterns/lookup-lsc/src-config/client-config.ts","webpack:///./../config/src/core/logger-client.ts","webpack:///./../../../told-stack-npm/src/core/logger/config/client-config.ts","webpack:///./src/app/server-access/logger.ts","webpack:///./../../../told-stack-npm/src/core/logger/client/logger.ts","webpack:///./../config/src/payment/stripe-client.ts","webpack:///./../../../told-stack-npm/src/payment/stripe/config/client-config.ts","webpack:///./src/app/components/stripe-test.tsx","webpack:///./src/app/server-access/stripe.ts","webpack:///./../../../told-stack-npm/src/core/utils/instance-loader.ts","webpack:///./../../../told-stack-npm/src/core/utils/observable.ts","webpack:///./../../../told-stack-npm/src/core/utils/script-loader.ts","webpack:///./../../../told-stack-npm/src/core/utils/uuid.ts","webpack:///./../../../told-stack-npm/src/payment/common/checkout-types.ts","webpack:///./../../../told-stack-npm/src/payment/stripe/client/checkout-process.ts","webpack:///./../../../told-stack-npm/src/payment/stripe/client/stripe-checkout-access.ts"],"names":["webpackJsonp","157","module","exports","__webpack_require__","Object","defineProperty","value","RX","stripe_test_1","App","createElement","View","Text","StripeTest","158","client_config_1","clientConfig","ClientConfig","lookup_domain","downloadBlob_domain","lookup_route","downloadBlob_route","161","client_1","clientConfig_lookupLsc","logger_client_1","clientConfig_logger","stripe_client_1","clientConfig_stripe","162","app_1","initialize","UserInterface","setMainView","163","group","items","getKey","reduce","o","x","k","push","groupToArray","g","getOwnPropertyNames","map","assignPartial","t","p","166","objects_1","options","this","timePollSeconds","maxPollCount","timeToLiveSeconds","shouldGzipDownloadBlob","prototype","getLookupUrl","key","containerName","blobName","getDataDownloadUrl","lookup","getDataDownloadBlobName","timeKey","412","timeBatchSeconds","sendLog_domain","sendLog_route","413","_this","maxSendSize","maxDataSize","getSendLogUrl","416","logger_1","config_1","logger","Logger","sessionId","userId","path","appVersion","platform","userAgent","417","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","verb","n","v","op","f","TypeError","_","y","call","label","ops","pop","trys","length","sent","throw","return","Symbol","iterator","config","getUserInfo","getContextInfo","getDeviceInfo","_hasSentSessionInfo","_startTime","Date","now","_lastSendTime","_items","_timeoutId","sendBatch","shouldSendImmediately","scheduleSend","sendNow","timeUsed","timeRemaining","clearTimeout","setTimeout","sendSessionInfo","category","event","data","userInfo","appContextInfo","deviceInfo","isError","undefined","time","runTime","startTime","error","log","major","d","sentItems","hasSentAll","count","r","_a","_b","_c","forEach","JSON","stringify","substr","Math","floor","slice","fetch","method","ok","_attempts","filter","maxItemSendAttempts","418","stripePublishableKey","checkoutOptions","business","name","imageUrl","requirements","requireZipCode","requireBillingAddress","experience","allowRememberMe","419","420","__extends","extendStatics","setPrototypeOf","__proto__","Array","b","hasOwnProperty","__","constructor","create","stripe_1","checkout_types_1","_super","arguments","prepare","stripeCheckoutProcess","setState","isReady","open","subscribe","console","state","product","amountCents","description","user","email","render","hasStarted","Button","disabled","onPress","CheckoutStatus","status","checkoutId","timeChanged","Component","421","checkout_process_1","StripeCheckoutProcess","logCheckoutEvent","422","InstanceLoader","_load","_isLoading","_resolves","_getInstance","_instance","resolves","err","load","get","enumerable","configurable","423","O","Observable","default","424","ScriptLoader","hasStartedLoading","resolveAll","instance","onBeforeLoadScript","document","s","id","scriptElementId","getElementById","fjs","getElementsByTagName","js","onload","onAfterLoadScript","getInstance","src","url","parentNode","insertBefore","425","uuid","v4","replace","a","random","toString","426","427","observable_1","stripe_checkout_access_1","uuid_1","runtime","observer","lastResult","updateResult","tokenCallback","_access","StripeCheckoutAccess","NotStarted","token","args","Submitting","recommendedOptions","amount","image","zipCode","billingAddress","additionalOptions","opened","Opened","closed","Closed","openOptions","configOptions","Started","getResult","Error","428","__assign","assign","i","script_loader_1","instance_loader_1","scriptLoader","StripeCheckout","handlerLoader","handler","configure","_handler"],"mappings":"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","file":"bundle.js","sourcesContent":["webpackJsonp([0],{\n\n/***/ 157:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RX = __webpack_require__(54);\r\nvar stripe_test_1 = __webpack_require__(420);\r\n// import { Store } from './store/store';\r\n// import { handleRoute } from \"./routes\";\r\n// import { Root } from \"./components/page/root\";\r\n// const store = Store;\r\n// handleRoute();\r\n// <Root store={store} />\r\nexports.App = function () { return (RX.createElement(RX.View, null,\r\n    RX.createElement(RX.Text, null, \"TEST\"),\r\n    RX.createElement(stripe_test_1.StripeTest, null))); };\r\n\n\n/***/ }),\n\n/***/ 158:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar client_config_1 = __webpack_require__(166);\r\nexports.clientConfig = new client_config_1.ClientConfig({\r\n    // lookup_domain: 'https://told-stack-demo.azurewebsites.net',\r\n    // downloadBlob_domain: 'https://told-stack-demo.azurewebsites.net',\r\n    lookup_domain: 'https://told-stack-demo.azureedge.net',\r\n    downloadBlob_domain: 'https://told-stack-demo.azureedge.net',\r\n    lookup_route: 'api/lookup-lsc',\r\n    downloadBlob_route: 'api/lookup-lsc-download'\r\n});\r\n\n\n/***/ }),\n\n/***/ 161:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar client_1 = __webpack_require__(158);\r\nexports.clientConfig_lookupLsc = client_1.clientConfig;\r\nvar logger_client_1 = __webpack_require__(412);\r\nexports.clientConfig_logger = logger_client_1.clientConfig;\r\nvar stripe_client_1 = __webpack_require__(418);\r\nexports.clientConfig_stripe = stripe_client_1.clientConfig;\r\n\n\n/***/ }),\n\n/***/ 162:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RX = __webpack_require__(54);\r\nvar app_1 = __webpack_require__(157);\r\nRX.App.initialize(true, true);\r\nRX.UserInterface.setMainView(RX.createElement(app_1.App, null));\r\n\n\n/***/ }),\n\n/***/ 163:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\n// export function objectToValueIterator<T>(obj: { [key: string]: T }): { [key: string]: T } & Iterable<T> {\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n//     const o = obj as any;\r\n//     o[Symbol.iterator] = () => {\r\n//         let keys = Object.getOwnPropertyNames(obj);\r\n//         let i = 0;\r\n//         return {\r\n//             next: () => {\r\n//                 const key = keys[i++];\r\n//                 const value = obj[key];\r\n//                 return {\r\n//                     value,\r\n//                     done: i >= keys.length\r\n//                 };\r\n//             }\r\n//         };\r\n//     };\r\n//     return o;\r\n// }\r\n// export function objectToKeyValueIterator<T>(obj: { [key: string]: T }): { [key: string]: T } & Iterable<{ key: string, value: T }> {\r\n//     const o = obj as any;\r\n//     o[Symbol.iterator] = () => {\r\n//         let keys = Object.getOwnPropertyNames(obj);\r\n//         let i = 0;\r\n//         return {\r\n//             next: () => {\r\n//                 const key = keys[i++];\r\n//                 const value = obj[key];\r\n//                 return {\r\n//                     value: { key, value },\r\n//                     done: i >= keys.length\r\n//                 };\r\n//             }\r\n//         };\r\n//     };\r\n//     return o;\r\n// }\r\nfunction group(items, getKey) {\r\n    var g = items.reduce(function (o, x) {\r\n        var k = getKey(x);\r\n        var group = o[k] = o[k] || { items: [] };\r\n        group.items.push(x);\r\n        return o;\r\n    }, {});\r\n    //return objectToValueIterator(g);\r\n    return g;\r\n}\r\nexports.group = group;\r\nfunction groupToArray(items, getKey) {\r\n    var g = group(items, getKey);\r\n    return Object.getOwnPropertyNames(g).map(function (k) { return g[k].items; });\r\n}\r\nexports.groupToArray = groupToArray;\r\nfunction assignPartial(t, p) {\r\n    for (var k in p) {\r\n        t[k] = p[k];\r\n    }\r\n    return t;\r\n}\r\nexports.assignPartial = assignPartial;\r\n\n\n/***/ }),\n\n/***/ 166:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar objects_1 = __webpack_require__(163);\r\nvar ClientConfig = (function () {\r\n    function ClientConfig(options) {\r\n        this.timePollSeconds = 1;\r\n        this.maxPollCount = 5;\r\n        this.timeToLiveSeconds = 60;\r\n        this.lookup_domain = '/';\r\n        this.lookup_route = 'api/lookup-lsc';\r\n        this.downloadBlob_domain = '/';\r\n        this.downloadBlob_route = 'blob';\r\n        // WARNING: Gzip is not working in the 4th step: Reading from .gzip blob with node and sending to client\r\n        // In addition, since using a function instead of proxy, gzip is done automatically by the function\r\n        // So it is not needed, and would only be useful to reduce storage size at the cost of increased processing\r\n        this.shouldGzipDownloadBlob = false;\r\n        objects_1.assignPartial(this, options);\r\n    }\r\n    ClientConfig.prototype.getLookupUrl = function (key) {\r\n        return this.lookup_domain + \"/\" + this.lookup_route + \"/\" + key.containerName + \"/\" + key.blobName;\r\n    };\r\n    ClientConfig.prototype.getDataDownloadUrl = function (key, lookup) {\r\n        return this.downloadBlob_domain + \"/\" + (this.downloadBlob_route ? this.downloadBlob_route + '/' : '') + key.containerName + \"/\" + this.getDataDownloadBlobName(key.blobName, lookup);\r\n    };\r\n    ClientConfig.prototype.getDataDownloadBlobName = function (blobName, lookup) {\r\n        // TODO: Test if works with .ext and switch to underscore if needed\r\n        return blobName + \"/\" + lookup.timeKey + (this.shouldGzipDownloadBlob ? '_gzip' : '');\r\n    };\r\n    return ClientConfig;\r\n}());\r\nexports.ClientConfig = ClientConfig;\r\n\n\n/***/ }),\n\n/***/ 412:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar client_config_1 = __webpack_require__(413);\r\nexports.clientConfig = new client_config_1.ClientConfig({\r\n    timeBatchSeconds: 10,\r\n    sendLog_domain: 'https://told-stack-demo.azureedge.net',\r\n    // sendLog_domain: 'http://localhost:7071',\r\n    sendLog_route: 'api/logger/send-log',\r\n});\r\n\n\n/***/ }),\n\n/***/ 413:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar objects_1 = __webpack_require__(163);\r\nvar ClientConfig = (function () {\r\n    function ClientConfig(options) {\r\n        var _this = this;\r\n        this.maxSendSize = 32 * 1024;\r\n        this.maxDataSize = 28 * 1024;\r\n        this.sendLog_domain = '/';\r\n        this.sendLog_route = 'api/logger/send-log';\r\n        this.getSendLogUrl = function () { return _this.sendLog_domain + \"/\" + _this.sendLog_route; };\r\n        objects_1.assignPartial(this, options);\r\n    }\r\n    return ClientConfig;\r\n}());\r\nexports.ClientConfig = ClientConfig;\r\n\n\n/***/ }),\n\n/***/ 416:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar logger_1 = __webpack_require__(417);\r\nvar config_1 = __webpack_require__(161);\r\nexports.logger = new logger_1.Logger(config_1.clientConfig_logger, function () { return ({ sessionId: 's1234', userId: 'u1234' }); }, function () { return ({ path: 'a/b/c' }); }, function () { return ({ appVersion: 'v1.0', platform: 'web', userAgent: 'testUserAgent' }); });\r\n\n\n/***/ }),\n\n/***/ 417:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Logger = (function () {\r\n    function Logger(config, getUserInfo, getContextInfo, getDeviceInfo) {\r\n        var _this = this;\r\n        this.config = config;\r\n        this.getUserInfo = getUserInfo;\r\n        this.getContextInfo = getContextInfo;\r\n        this.getDeviceInfo = getDeviceInfo;\r\n        this._hasSentSessionInfo = false;\r\n        this._startTime = Date.now();\r\n        this._lastSendTime = Date.now();\r\n        this._items = [];\r\n        this._timeoutId = 0;\r\n        this.sendBatch = function (shouldSendImmediately) {\r\n            if (shouldSendImmediately === void 0) { shouldSendImmediately = false; }\r\n            if (!shouldSendImmediately\r\n                && Date.now() - _this._lastSendTime < _this.config.timeBatchSeconds * 1000) {\r\n                _this.scheduleSend();\r\n                return;\r\n            }\r\n            var items = _this._items;\r\n            _this._items = [];\r\n            _this.sendNow(items);\r\n        };\r\n        this.scheduleSend = function () {\r\n            var timeUsed = Date.now() - _this._lastSendTime;\r\n            var timeRemaining = _this.config.timeBatchSeconds - timeUsed;\r\n            clearTimeout(_this._timeoutId);\r\n            _this._timeoutId = setTimeout(_this.sendBatch, timeRemaining);\r\n        };\r\n        setTimeout(function () { return _this.sendSessionInfo(); }, 250);\r\n    }\r\n    Logger.prototype.sendSessionInfo = function () {\r\n        if (!this._hasSentSessionInfo) {\r\n            this._hasSentSessionInfo = true;\r\n            this._items.push({\r\n                category: 'Session',\r\n                event: 'Info',\r\n                data: null,\r\n                userInfo: this.getUserInfo(),\r\n                appContextInfo: this.getContextInfo(),\r\n                deviceInfo: this.getDeviceInfo(),\r\n                isError: undefined,\r\n                time: Date.now(),\r\n                runTime: Date.now() - this._startTime,\r\n                startTime: this._startTime,\r\n            });\r\n            this.sendBatch(true);\r\n        }\r\n    };\r\n    Logger.prototype.error = function (category, event, data, shouldSendImmediately) {\r\n        if (shouldSendImmediately === void 0) { shouldSendImmediately = false; }\r\n        this.log(category, event, data, true, true);\r\n    };\r\n    Logger.prototype.major = function (category, event, data, shouldSendImmediately) {\r\n        if (shouldSendImmediately === void 0) { shouldSendImmediately = false; }\r\n        this.log(category, event, data, true);\r\n    };\r\n    Logger.prototype.log = function (category, event, data, shouldSendImmediately, isError) {\r\n        if (shouldSendImmediately === void 0) { shouldSendImmediately = false; }\r\n        if (isError === void 0) { isError = false; }\r\n        var d = {\r\n            category: category,\r\n            event: event,\r\n            data: data,\r\n            userInfo: this.getUserInfo(),\r\n            appContextInfo: this.getContextInfo(),\r\n            deviceInfo: undefined,\r\n            isError: isError,\r\n            time: Date.now(),\r\n            runTime: Date.now() - this._startTime,\r\n            startTime: this._startTime,\r\n        };\r\n        this._items.push(d);\r\n        this.sendBatch(shouldSendImmediately);\r\n    };\r\n    Logger.prototype.sendNow = function (items) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            var sentItems, body, hasSentAll, count, r, _a, _b;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        this._lastSendTime = Date.now();\r\n                        if (!items || !items.length) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        items.forEach(function (x) {\r\n                            if (!x.data) {\r\n                                return;\r\n                            }\r\n                            var d = x.data;\r\n                            if (typeof x.data !== 'string') {\r\n                                d = JSON.stringify(x.data);\r\n                            }\r\n                            if (d.length > _this.config.maxDataSize) {\r\n                                x.data = 'truncated:' + d.substr(0, _this.config.maxDataSize - 16) + '...';\r\n                            }\r\n                        });\r\n                        sentItems = items;\r\n                        body = JSON.stringify(items);\r\n                        hasSentAll = true;\r\n                        count = items.length;\r\n                        while (body.length > this.config.maxSendSize) {\r\n                            if (count === 1) {\r\n                                // Truncate Message Data\r\n                                sentItems.forEach(function (x) { return x.data = 'truncated:' + JSON.stringify(x.data).substr(0, _this.config.maxDataSize) + '...'; });\r\n                                break;\r\n                            }\r\n                            hasSentAll = false;\r\n                            count = Math.floor(count / 2);\r\n                            sentItems = items.slice(0, count);\r\n                            body = JSON.stringify(sentItems);\r\n                        }\r\n                        if (!hasSentAll) {\r\n                            (_a = this._items).push.apply(_a, items.slice(count));\r\n                        }\r\n                        return [4 /*yield*/, fetch(this.config.getSendLogUrl(), { method: 'POST', body: body })];\r\n                    case 1:\r\n                        r = _c.sent();\r\n                        // If send failure, add items back to end of queue to try again\r\n                        if (!r.ok) {\r\n                            sentItems.forEach(function (x) { return x._attempts++; });\r\n                            (_b = this._items).push.apply(_b, sentItems.filter(function (x) { return x._attempts < _this.config.maxItemSendAttempts; }));\r\n                        }\r\n                        // Immediately Send Again to Send the rest of the batch\r\n                        if (!hasSentAll) {\r\n                            setTimeout(function () { return _this.sendBatch(true); });\r\n                        }\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Logger;\r\n}());\r\nexports.Logger = Logger;\r\n\n\n/***/ }),\n\n/***/ 418:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar client_config_1 = __webpack_require__(419);\r\nexports.clientConfig = new client_config_1.ClientConfig({\r\n    stripePublishableKey: 'pk_test_hB4VRQY8ICsC6mVsRo8jjnIh',\r\n    checkoutOptions: {\r\n        business: {\r\n            name: 'Told Software',\r\n            imageUrl: 'https://toldstackdemo.blob.core.windows.net/images/ToldLogo128.png'\r\n        },\r\n        requirements: {\r\n            requireZipCode: true,\r\n            requireBillingAddress: true,\r\n        },\r\n        experience: {\r\n            allowRememberMe: true\r\n        },\r\n    },\r\n});\r\n\n\n/***/ }),\n\n/***/ 419:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar objects_1 = __webpack_require__(163);\r\nvar ClientConfig = (function () {\r\n    function ClientConfig(options) {\r\n        this.options = options;\r\n        objects_1.assignPartial(this, options);\r\n    }\r\n    return ClientConfig;\r\n}());\r\nexports.ClientConfig = ClientConfig;\r\n\n\n/***/ }),\n\n/***/ 420:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RX = __webpack_require__(54);\r\nvar stripe_1 = __webpack_require__(421);\r\nvar checkout_types_1 = __webpack_require__(426);\r\nvar StripeTest = (function (_super) {\r\n    __extends(StripeTest, _super);\r\n    function StripeTest() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.prepare = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var _this = this;\r\n            var r;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, stripe_1.stripeCheckoutProcess.prepare()];\r\n                    case 1:\r\n                        r = _a.sent();\r\n                        this.setState({\r\n                            isReady: true,\r\n                            open: r.open,\r\n                        });\r\n                        r.result.subscribe(function (x) {\r\n                            console.log('Result Changed', { result: x });\r\n                            _this.setState({\r\n                                result: x\r\n                            });\r\n                        });\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n        _this.open = function () {\r\n            if (_this.state.open) {\r\n                _this.state.open({\r\n                    product: { amountCents: 100, description: 'Cool Thing to Buy' },\r\n                    user: { email: 'me@home.com' },\r\n                });\r\n            }\r\n        };\r\n        return _this;\r\n    }\r\n    StripeTest.prototype.render = function () {\r\n        if (!this.state.hasStarted) {\r\n            this.setState({\r\n                hasStarted: true\r\n            });\r\n            setTimeout(this.prepare);\r\n        }\r\n        return (RX.createElement(RX.View, null,\r\n            RX.createElement(RX.Button, { disabled: !this.state.isReady, onPress: this.open }, \"Checkout\"),\r\n            this.state.result && (RX.createElement(RX.View, null,\r\n                RX.createElement(RX.Text, null,\r\n                    \"status: \",\r\n                    checkout_types_1.CheckoutStatus[this.state.result.status]),\r\n                RX.createElement(RX.Text, null,\r\n                    \"checkoutId: \",\r\n                    this.state.result.checkoutId),\r\n                RX.createElement(RX.Text, null,\r\n                    \"timeChanged: \",\r\n                    this.state.result.timeChanged)))));\r\n    };\r\n    return StripeTest;\r\n}(RX.Component));\r\nexports.StripeTest = StripeTest;\r\n\n\n/***/ }),\n\n/***/ 421:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar checkout_process_1 = __webpack_require__(427);\r\nvar config_1 = __webpack_require__(161);\r\nvar logger_1 = __webpack_require__(416);\r\nexports.stripeCheckoutProcess = new checkout_process_1.StripeCheckoutProcess(config_1.clientConfig_stripe, {\r\n    logCheckoutEvent: function (event, data) {\r\n        logger_1.logger.major('Stripe', event, data);\r\n    }\r\n});\r\n\n\n/***/ }),\n\n/***/ 422:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar InstanceLoader = (function () {\r\n    function InstanceLoader(_load) {\r\n        var _this = this;\r\n        this._load = _load;\r\n        this._isLoading = false;\r\n        this._resolves = [];\r\n        this._getInstance = function () {\r\n            return new Promise(function (resolve, reject) {\r\n                if (_this._instance) {\r\n                    return resolve(_this._instance);\r\n                }\r\n                _this._resolves.push(resolve);\r\n                if (_this._isLoading) {\r\n                    return;\r\n                }\r\n                _this._isLoading = true;\r\n                console.log('InstanceLoader START');\r\n                _this._load().then(function (x) {\r\n                    console.log('InstanceLoader LOADED');\r\n                    _this._instance = x;\r\n                    var resolves = _this._resolves;\r\n                    _this._resolves = null;\r\n                    resolves.forEach(function (r) {\r\n                        setTimeout(function () {\r\n                            try {\r\n                                r(x);\r\n                            }\r\n                            catch (err) {\r\n                                console.error('InstanceLoader: A resolver threw an uncaught error', { err: err });\r\n                            }\r\n                        });\r\n                    });\r\n                    console.log('InstanceLoader DONE');\r\n                });\r\n            });\r\n        };\r\n    }\r\n    InstanceLoader.prototype.load = function () {\r\n        return this._getInstance();\r\n    };\r\n    Object.defineProperty(InstanceLoader.prototype, \"instance\", {\r\n        get: function () {\r\n            return this._getInstance();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return InstanceLoader;\r\n}());\r\nexports.InstanceLoader = InstanceLoader;\r\n\n\n/***/ }),\n\n/***/ 423:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n// import * as Observable from 'zen-observable';\r\nvar O = __webpack_require__(429);\r\nexports.Observable = O.default;\r\n\n\n/***/ }),\n\n/***/ 424:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ScriptLoader = (function () {\r\n    function ScriptLoader(options) {\r\n        var _this = this;\r\n        this.options = options;\r\n        this.hasStartedLoading = false;\r\n        this.resolves = [];\r\n        this.resolveAll = function () {\r\n            var r = _this.resolves;\r\n            _this.resolves = [];\r\n            r.forEach(function (x) { return x(_this.instance); });\r\n        };\r\n    }\r\n    ScriptLoader.prototype.load = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (_this.instance) {\r\n                resolve(_this.instance);\r\n                return;\r\n            }\r\n            // Subscribe\r\n            _this.resolves.push(resolve);\r\n            if (_this.hasStartedLoading) {\r\n                return;\r\n            }\r\n            _this.hasStartedLoading = true;\r\n            console.log('ScriptLoader.load START');\r\n            if (_this.options.onBeforeLoadScript) {\r\n                _this.options.onBeforeLoadScript();\r\n            }\r\n            // Load Script\r\n            var d = document;\r\n            var s = 'script';\r\n            var id = _this.options.scriptElementId;\r\n            // Script already loaded\r\n            if (d.getElementById(id)) {\r\n                _this.resolveAll();\r\n                return;\r\n            }\r\n            var fjs = d.getElementsByTagName(s)[0];\r\n            var js = d.createElement(s);\r\n            js.id = id;\r\n            js.onload = function () {\r\n                if (_this.options.onAfterLoadScript) {\r\n                    _this.options.onAfterLoadScript();\r\n                }\r\n                _this.instance = _this.options.getInstance();\r\n                _this.resolveAll();\r\n            };\r\n            js.src = _this.options.url;\r\n            fjs.parentNode.insertBefore(js, fjs);\r\n        });\r\n    };\r\n    return ScriptLoader;\r\n}());\r\nexports.ScriptLoader = ScriptLoader;\r\n\n\n/***/ }),\n\n/***/ 425:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n// https://gist.github.com/jed/982883\r\nexports.uuid = {\r\n    v4: function () { return ('' + 1e7 + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, function (a) { return (a ^ Math.random() * 16 >> a / 4).toString(16); }); }\r\n};\r\n\n\n/***/ }),\n\n/***/ 426:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CheckoutStatus;\r\n(function (CheckoutStatus) {\r\n    // Nothing has happened yet\r\n    CheckoutStatus[CheckoutStatus[\"NotStarted\"] = 0] = \"NotStarted\";\r\n    // The user has clicked the open button and is opening\r\n    CheckoutStatus[CheckoutStatus[\"Started\"] = 1] = \"Started\";\r\n    // The form has called the opened callback\r\n    CheckoutStatus[CheckoutStatus[\"Opened\"] = 2] = \"Opened\";\r\n    // The form has called the closed callback (Caneelled)\r\n    CheckoutStatus[CheckoutStatus[\"Closed\"] = 3] = \"Closed\";\r\n    // The user has submitted and the provider is verifying the information \r\n    CheckoutStatus[CheckoutStatus[\"Verifing\"] = 4] = \"Verifing\";\r\n    // The payment was sent to the server\r\n    CheckoutStatus[CheckoutStatus[\"Submitting\"] = 5] = \"Submitting\";\r\n    // The payment is being processed on the server\r\n    CheckoutStatus[CheckoutStatus[\"Processing\"] = 6] = \"Processing\";\r\n    // The payment was made successfully\r\n    CheckoutStatus[CheckoutStatus[\"Success\"] = 7] = \"Success\";\r\n    // The payment failed (Try Again)\r\n    CheckoutStatus[CheckoutStatus[\"PaymentFailed\"] = 8] = \"PaymentFailed\";\r\n    // The payment succeeded but the processing failed (Customer Support)\r\n    CheckoutStatus[CheckoutStatus[\"ProcessingFailed\"] = 9] = \"ProcessingFailed\";\r\n    // The payment process was not found\r\n    CheckoutStatus[CheckoutStatus[\"NotFound\"] = 10] = \"NotFound\";\r\n})(CheckoutStatus = exports.CheckoutStatus || (exports.CheckoutStatus = {}));\r\n\n\n/***/ }),\n\n/***/ 427:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar observable_1 = __webpack_require__(423);\r\nvar checkout_types_1 = __webpack_require__(426);\r\nvar stripe_checkout_access_1 = __webpack_require__(428);\r\nvar objects_1 = __webpack_require__(163);\r\nvar uuid_1 = __webpack_require__(425);\r\nvar StripeCheckoutProcess = (function () {\r\n    function StripeCheckoutProcess(config, runtime) {\r\n        var _this = this;\r\n        this.config = config;\r\n        this.runtime = runtime;\r\n        this.prepare = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var _this = this;\r\n            var checkoutId, observer, lastResult, updateResult, result, tokenCallback, open;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        console.log('StripeCheckoutProcess START');\r\n                        if (!this._access) {\r\n                            this._access = new stripe_checkout_access_1.StripeCheckoutAccess(this.config.stripePublishableKey);\r\n                        }\r\n                        console.log('StripeCheckoutProcess Prepare Stripe Access');\r\n                        return [4 /*yield*/, this._access.prepare()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        console.log('StripeCheckoutProcess Setup Result Observer');\r\n                        checkoutId = uuid_1.uuid.v4();\r\n                        lastResult = {\r\n                            checkoutId: checkoutId,\r\n                            status: checkout_types_1.CheckoutStatus.NotStarted,\r\n                            timeChanged: Date.now(),\r\n                        };\r\n                        updateResult = function (result) {\r\n                            console.log('StripeCheckoutProcess updateResult', { result: result });\r\n                            if (result.checkoutId && result.checkoutId !== lastResult.checkoutId) {\r\n                                throw 'StripeCheckoutProcess: Cannot change checkoutId';\r\n                            }\r\n                            objects_1.assignPartial(lastResult, result);\r\n                            lastResult.checkoutId = checkoutId;\r\n                            lastResult.timeChanged = Date.now();\r\n                            observer.next(lastResult);\r\n                            _this.runtime.logCheckoutEvent('ResultChange', lastResult);\r\n                        };\r\n                        result = new observable_1.Observable(function (o) {\r\n                            console.log('StripeCheckoutProcess Observable START');\r\n                            observer = o;\r\n                        });\r\n                        tokenCallback = function (token, args) {\r\n                            updateResult({ status: checkout_types_1.CheckoutStatus.Submitting });\r\n                            // TODO: Submit to server\r\n                        };\r\n                        open = function (options) {\r\n                            var o = {};\r\n                            objects_1.assignPartial(o, _this.config.checkoutOptions);\r\n                            objects_1.assignPartial(o, options);\r\n                            _this._access.open({\r\n                                tokenCallback: tokenCallback,\r\n                                recommendedOptions: {\r\n                                    amount: o.product.amountCents,\r\n                                    name: o.business.name,\r\n                                    image: o.business.imageUrl,\r\n                                    description: o.product.description,\r\n                                    zipCode: o.requirements.requireZipCode,\r\n                                    billingAddress: o.requirements.requireBillingAddress,\r\n                                },\r\n                                additionalOptions: {\r\n                                    email: o.user.email,\r\n                                    allowRememberMe: o.experience.allowRememberMe,\r\n                                    opened: function () {\r\n                                        updateResult({ status: checkout_types_1.CheckoutStatus.Opened });\r\n                                    },\r\n                                    closed: function () {\r\n                                        if (lastResult.status < checkout_types_1.CheckoutStatus.Submitting) {\r\n                                            updateResult({ status: checkout_types_1.CheckoutStatus.Closed });\r\n                                        }\r\n                                    },\r\n                                },\r\n                            });\r\n                            _this.runtime.logCheckoutEvent('Open', { checkoutId: checkoutId, openOptions: options, configOptions: _this.config.checkoutOptions });\r\n                            updateResult({ status: checkout_types_1.CheckoutStatus.Started });\r\n                        };\r\n                        console.log('StripeCheckoutProcess DONE');\r\n                        return [2 /*return*/, {\r\n                                open: open,\r\n                                result: result\r\n                            }];\r\n                }\r\n            });\r\n        }); };\r\n    }\r\n    StripeCheckoutProcess.prototype.getResult = function (checkoutId) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    return StripeCheckoutProcess;\r\n}());\r\nexports.StripeCheckoutProcess = StripeCheckoutProcess;\r\n\n\n/***/ }),\n\n/***/ 428:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar script_loader_1 = __webpack_require__(424);\r\nvar instance_loader_1 = __webpack_require__(422);\r\nvar scriptLoader = new script_loader_1.ScriptLoader({\r\n    url: 'https://checkout.stripe.com/checkout.js',\r\n    scriptElementId: 'StripeCheckout',\r\n    getInstance: function () {\r\n        return StripeCheckout;\r\n    }\r\n});\r\nvar StripeCheckoutAccess = (function () {\r\n    function StripeCheckoutAccess(stripePublishableKey) {\r\n        var _this = this;\r\n        this.stripePublishableKey = stripePublishableKey;\r\n        this.handlerLoader = new instance_loader_1.InstanceLoader(function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var s, handler;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        console.log('StripeCheckoutProcess.handlerLoader START');\r\n                        return [4 /*yield*/, scriptLoader.load()];\r\n                    case 1:\r\n                        s = _a.sent();\r\n                        console.log('StripeCheckoutProcess.handlerLoader LOADED');\r\n                        return [4 /*yield*/, s.configure({ key: this.stripePublishableKey })];\r\n                    case 2:\r\n                        handler = _a.sent();\r\n                        console.log('StripeCheckoutProcess.handlerLoader END');\r\n                        return [2 /*return*/, handler];\r\n                }\r\n            });\r\n        }); });\r\n        this.prepare = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = this;\r\n                        return [4 /*yield*/, this.handlerLoader.instance];\r\n                    case 1:\r\n                        _a._handler = _b.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n        // This must be a direct call to handler.open (It cannot be async or will get popup-blocked)\r\n        this.open = function (options) {\r\n            var handler = _this._handler;\r\n            if (!handler) {\r\n                throw 'The Stripe Checkout Handler must be loaded before Open is Clicked';\r\n            }\r\n            handler.open(__assign({ token: options.tokenCallback }, options.recommendedOptions, options.additionalOptions));\r\n        };\r\n    }\r\n    return StripeCheckoutAccess;\r\n}());\r\nexports.StripeCheckoutAccess = StripeCheckoutAccess;\r\n\n\n/***/ })\n\n},[162]);\n\n\n// WEBPACK FOOTER //\n// bundle.js","import * as RX from 'reactxp';\r\nimport { LookupLscTest } from \"./components/lookup-lsc-test\";\r\nimport { LoggerTest } from \"./components/logger-test\";\r\nimport { StripeTest } from \"./components/stripe-test\";\r\n// import { Store } from './store/store';\r\n// import { handleRoute } from \"./routes\";\r\n// import { Root } from \"./components/page/root\";\r\n\r\n// const store = Store;\r\n\r\n// handleRoute();\r\n\r\n// <Root store={store} />\r\nexport const App = () => (\r\n    <RX.View>\r\n        <RX.Text>TEST</RX.Text>\r\n        {/*<LookupLscTest />*/}\r\n        {/*<LoggerTest />*/}\r\n        <StripeTest />\r\n    </RX.View>\r\n);\n\n\n// WEBPACK FOOTER //\n// ./src/app/app.tsx","import { ClientConfig } from \"@told/stack/src/data-patterns/lookup-lsc/src-config/client-config\";\r\n\r\nexport const clientConfig = new ClientConfig({\r\n    // lookup_domain: 'https://told-stack-demo.azurewebsites.net',\r\n    // downloadBlob_domain: 'https://told-stack-demo.azurewebsites.net',\r\n    lookup_domain: 'https://told-stack-demo.azureedge.net',\r\n    downloadBlob_domain: 'https://told-stack-demo.azureedge.net',\r\n\r\n    lookup_route: 'api/lookup-lsc',\r\n    downloadBlob_route: 'api/lookup-lsc-download'\r\n});\n\n\n// WEBPACK FOOTER //\n// ./../config/src/lookup-lsc/client.ts","export { clientConfig as clientConfig_lookupLsc } from '../../config/src/lookup-lsc/client';\nexport { clientConfig as clientConfig_logger } from '../../config/src/core/logger-client';\nexport { clientConfig as clientConfig_stripe } from '../../config/src/payment/stripe-client';\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.ts","import * as RX from 'reactxp';\r\nimport { App } from './app/app';\r\n\r\nRX.App.initialize(true, true);\r\nRX.UserInterface.setMainView(<App />);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.tsx","\r\n// export function objectToValueIterator<T>(obj: { [key: string]: T }): { [key: string]: T } & Iterable<T> {\r\n\r\n//     const o = obj as any;\r\n//     o[Symbol.iterator] = () => {\r\n//         let keys = Object.getOwnPropertyNames(obj);\r\n//         let i = 0;\r\n\r\n//         return {\r\n//             next: () => {\r\n//                 const key = keys[i++];\r\n//                 const value = obj[key];\r\n//                 return {\r\n//                     value,\r\n//                     done: i >= keys.length\r\n//                 };\r\n//             }\r\n//         };\r\n//     };\r\n\r\n//     return o;\r\n// }\r\n\r\n\r\n// export function objectToKeyValueIterator<T>(obj: { [key: string]: T }): { [key: string]: T } & Iterable<{ key: string, value: T }> {\r\n\r\n//     const o = obj as any;\r\n//     o[Symbol.iterator] = () => {\r\n//         let keys = Object.getOwnPropertyNames(obj);\r\n//         let i = 0;\r\n\r\n//         return {\r\n//             next: () => {\r\n//                 const key = keys[i++];\r\n//                 const value = obj[key];\r\n//                 return {\r\n//                     value: { key, value },\r\n//                     done: i >= keys.length\r\n//                 };\r\n//             }\r\n//         };\r\n//     };\r\n\r\n//     return o;\r\n// }\r\n\r\nexport function group<T>(items: T[], getKey: (x: T) => string) {\r\n    const g = items.reduce((o, x) => {\r\n        const k = getKey(x);\r\n        const group = o[k] = o[k] || { items: [] };\r\n        group.items.push(x);\r\n        return o;\r\n    }, {} as any) as { [key: string]: { items: T[] } };\r\n\r\n    //return objectToValueIterator(g);\r\n    return g;\r\n}\r\n\r\nexport function groupToArray<T>(items: T[], getKey: (x: T) => string) {\r\n    const g = group(items, getKey);\r\n    return Object.getOwnPropertyNames(g).map(k => g[k].items);\r\n}\r\n\r\n\r\nexport function assignPartial<T>(t: T, p: Partial<T>): T {\r\n    for (let k in p) {\r\n        t[k] = p[k];\r\n    }\r\n\r\n    return t;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/objects.ts","import { HttpFunctionRequest } from \"../../../core/types/functions\";\r\nimport { assignPartial } from \"../../../core/utils/objects\";\r\n\r\nexport interface DataKey {\r\n    containerName: string;\r\n    blobName: string;\r\n}\r\n\r\nexport interface LookupData {\r\n    timeKey: string\r\n}\r\n\r\nexport interface LookupResponse {\r\n    timeKey?: string;\r\n    error?: string;\r\n    timeToExpireSeconds: number;\r\n}\r\n\r\nexport interface ClientConfigType {\r\n    timeToLiveSeconds: number;\r\n    timePollSeconds: number;\r\n    maxPollCount: number;\r\n\r\n    getLookupUrl(key: DataKey): string;\r\n    getDataDownloadUrl(key: DataKey, lookup: LookupData): string;\r\n}\r\n\r\nexport interface ClientConfigOptions {\r\n    timeToLiveSeconds: number;\r\n    timePollSeconds: number;\r\n    maxPollCount: number;\r\n    lookup_domain: string;\r\n    lookup_route: string;\r\n    downloadBlob_domain: string;\r\n    downloadBlob_route: string;\r\n}\r\n\r\nexport class ClientConfig implements ClientConfigType, ClientConfigOptions {\r\n    timePollSeconds = 1;\r\n    maxPollCount = 5;\r\n    timeToLiveSeconds = 60;\r\n\r\n    lookup_domain = '/';\r\n    lookup_route = 'api/lookup-lsc';\r\n    downloadBlob_domain = '/';\r\n    downloadBlob_route = 'blob';\r\n\r\n    // WARNING: Gzip is not working in the 4th step: Reading from .gzip blob with node and sending to client\r\n    // In addition, since using a function instead of proxy, gzip is done automatically by the function\r\n    // So it is not needed, and would only be useful to reduce storage size at the cost of increased processing\r\n    shouldGzipDownloadBlob = false;\r\n\r\n    constructor(options?: Partial<ClientConfigOptions>) {\r\n        assignPartial(this, options);\r\n    }\r\n\r\n    getLookupUrl(key: DataKey): string {\r\n        return `${this.lookup_domain}/${this.lookup_route}/${key.containerName}/${key.blobName}`;\r\n    }\r\n\r\n    getDataDownloadUrl(key: DataKey, lookup: LookupData): string {\r\n        return `${this.downloadBlob_domain}/${this.downloadBlob_route ? this.downloadBlob_route + '/' : ''}${key.containerName}/${this.getDataDownloadBlobName(key.blobName, lookup)}`;\r\n    }\r\n\r\n    getDataDownloadBlobName(blobName: string, lookup: LookupData) {\r\n        // TODO: Test if works with .ext and switch to underscore if needed\r\n        return `${blobName}/${lookup.timeKey}${this.shouldGzipDownloadBlob ? '_gzip' : ''}`;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/data-patterns/lookup-lsc/src-config/client-config.ts","import { ClientConfig } from \"@told/stack/src/core/logger/config/client-config\";\r\n\r\nexport const clientConfig = new ClientConfig({\r\n    timeBatchSeconds: 10,\r\n    sendLog_domain: 'https://told-stack-demo.azureedge.net',\r\n    // sendLog_domain: 'http://localhost:7071',\r\n    sendLog_route: 'api/logger/send-log',\r\n});\n\n\n// WEBPACK FOOTER //\n// ./../config/src/core/logger-client.ts","import { assignPartial } from \"../../utils/objects\";\r\n\r\nexport interface ClientConfigOptions {\r\n    timeBatchSeconds: number;\r\n\r\n    sendLog_domain: string;\r\n    sendLog_route: string;\r\n}\r\n\r\nexport class ClientConfig {\r\n    timeBatchSeconds: 60;\r\n    maxItemSendAttempts: 3;\r\n    maxSendSize = 32 * 1024;\r\n    maxDataSize = 28 * 1024;\r\n\r\n    sendLog_domain = '/';\r\n    sendLog_route = 'api/logger/send-log';\r\n\r\n    constructor(options: Partial<ClientConfigOptions>) {\r\n        assignPartial(this, options);\r\n    }\r\n\r\n    getSendLogUrl = () => `${this.sendLog_domain}/${this.sendLog_route}`;\r\n\r\n\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/logger/config/client-config.ts","import { Logger } from '@told/stack/src/core/logger/client/logger';\r\nimport { clientConfig_logger as clientConfig } from '../../config';\r\n\r\nexport const logger = new Logger(clientConfig,\r\n    () => ({ sessionId: 's1234', userId: 'u1234' }),\r\n    () => ({ path: 'a/b/c' }),\r\n    () => ({ appVersion: 'v1.0', platform: 'web', userAgent: 'testUserAgent' }),\r\n);\n\n\n// WEBPACK FOOTER //\n// ./src/app/server-access/logger.ts","import { ClientConfig } from \"../config/client-config\";\r\nimport { UserInfo, AppContextInfo, DeviceInfo, LogItem } from \"../config/types\";\r\n\r\nexport class Logger {\r\n\r\n    private _hasSentSessionInfo = false;\r\n    private _startTime = Date.now();\r\n    private _lastSendTime = Date.now();\r\n\r\n    private _items: LogItem[] = [];\r\n\r\n    private _timeoutId: any = 0;\r\n\r\n    constructor(\r\n        private config: ClientConfig,\r\n        private getUserInfo: () => UserInfo,\r\n        private getContextInfo: () => AppContextInfo,\r\n        private getDeviceInfo: () => DeviceInfo,\r\n    ) {\r\n        setTimeout(() => this.sendSessionInfo(), 250);\r\n    }\r\n\r\n    private sendSessionInfo() {\r\n        if (!this._hasSentSessionInfo) {\r\n            this._hasSentSessionInfo = true;\r\n\r\n            this._items.push({\r\n                category: 'Session',\r\n                event: 'Info',\r\n                data: null,\r\n\r\n                userInfo: this.getUserInfo(),\r\n                appContextInfo: this.getContextInfo(),\r\n                deviceInfo: this.getDeviceInfo(),\r\n\r\n                isError: undefined,\r\n                time: Date.now(),\r\n                runTime: Date.now() - this._startTime,\r\n                startTime: this._startTime,\r\n            });\r\n\r\n            this.sendBatch(true);\r\n        }\r\n    }\r\n\r\n    error(category: string, event: string, data: Object, shouldSendImmediately = false) {\r\n        this.log(category, event, data, true, true);\r\n    }\r\n\r\n    major(category: string, event: string, data: Object, shouldSendImmediately = false) {\r\n        this.log(category, event, data, true);\r\n    }\r\n\r\n    log(category: string, event: string, data: Object, shouldSendImmediately = false, isError = false) {\r\n\r\n        const d: LogItem = {\r\n            category,\r\n            event,\r\n            data,\r\n\r\n            userInfo: this.getUserInfo(),\r\n            appContextInfo: this.getContextInfo(),\r\n            deviceInfo: undefined,\r\n\r\n            isError,\r\n            time: Date.now(),\r\n            runTime: Date.now() - this._startTime,\r\n            startTime: this._startTime,\r\n        };\r\n\r\n        this._items.push(d);\r\n        this.sendBatch(shouldSendImmediately);\r\n\r\n    }\r\n\r\n    private sendBatch = (shouldSendImmediately = false) => {\r\n        if (!shouldSendImmediately\r\n            && Date.now() - this._lastSendTime < this.config.timeBatchSeconds * 1000\r\n        ) {\r\n            this.scheduleSend();\r\n            return;\r\n        }\r\n\r\n        const items = this._items;\r\n        this._items = [];\r\n        this.sendNow(items);\r\n    }\r\n\r\n    private async sendNow(items: LogItem[]) {\r\n        this._lastSendTime = Date.now();\r\n        if (!items || !items.length) { return; }\r\n\r\n        items.forEach(x => {\r\n            if (!x.data) { return; }\r\n\r\n            let d = x.data;\r\n            if (typeof x.data !== 'string') {\r\n                d = JSON.stringify(x.data);\r\n            }\r\n\r\n            if (d.length > this.config.maxDataSize) {\r\n                x.data = 'truncated:' + d.substr(0, this.config.maxDataSize - 16) + '...';\r\n            }\r\n        });\r\n\r\n        let sentItems = items;\r\n        let body = JSON.stringify(items);\r\n\r\n        // If body is too large, break it up\r\n        let hasSentAll = true;\r\n        let count = items.length;\r\n        while (body.length > this.config.maxSendSize) {\r\n            if (count === 1) {\r\n                // Truncate Message Data\r\n                sentItems.forEach(x => x.data = 'truncated:' + JSON.stringify(x.data).substr(0, this.config.maxDataSize) + '...');\r\n                break;\r\n            }\r\n\r\n            hasSentAll = false;\r\n            count = Math.floor(count / 2);\r\n            sentItems = items.slice(0, count);\r\n            body = JSON.stringify(sentItems);\r\n        }\r\n\r\n        if (!hasSentAll) {\r\n            this._items.push(...items.slice(count));\r\n        }\r\n\r\n        const r = await fetch(this.config.getSendLogUrl(), { method: 'POST', body });\r\n\r\n        // If send failure, add items back to end of queue to try again\r\n        if (!r.ok) {\r\n            sentItems.forEach(x => x._attempts++);\r\n            this._items.push(...sentItems.filter(x => x._attempts < this.config.maxItemSendAttempts));\r\n        }\r\n\r\n        // Immediately Send Again to Send the rest of the batch\r\n        if (!hasSentAll) {\r\n            setTimeout(() => this.sendBatch(true));\r\n        }\r\n    }\r\n\r\n    private scheduleSend = () => {\r\n        const timeUsed = Date.now() - this._lastSendTime;\r\n        const timeRemaining = this.config.timeBatchSeconds - timeUsed;\r\n        clearTimeout(this._timeoutId);\r\n        this._timeoutId = setTimeout(this.sendBatch, timeRemaining);\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/logger/client/logger.ts","import { ClientConfig } from \"@told/stack/src/payment/stripe/config/client-config\";\r\n\r\nexport const clientConfig = new ClientConfig({\r\n    stripePublishableKey: 'pk_test_hB4VRQY8ICsC6mVsRo8jjnIh',\r\n    checkoutOptions: {\r\n        business: {\r\n            name: 'Told Software',\r\n            imageUrl: 'https://toldstackdemo.blob.core.windows.net/images/ToldLogo128.png'\r\n        },\r\n        requirements: {\r\n            requireZipCode: true,\r\n            requireBillingAddress: true,\r\n        },\r\n        experience: {\r\n            allowRememberMe: true\r\n        },\r\n    },\r\n});\n\n\n// WEBPACK FOOTER //\n// ./../config/src/payment/stripe-client.ts","import { CheckoutOptions, CheckoutResult } from \"../../common/checkout-types\";\r\nimport { ClientConfig as LoggerClientConfig } from \"../../../core/logger/config/client-config\";\r\nimport { assignPartial } from \"../../../core/utils/objects\";\r\n\r\nexport type CheckoutEventType = 'Open' | 'ResultChange';\r\n\r\nexport interface ClientConfigOptions {\r\n    stripePublishableKey: string;\r\n    checkoutOptions: Partial<CheckoutOptions>;\r\n}\r\n\r\nexport interface ClientRuntimeOptions{\r\n    logCheckoutEvent: (type: CheckoutEventType, data: Object) => void;\r\n}\r\n\r\nexport class ClientConfig implements ClientConfigOptions {\r\n    stripePublishableKey: string;\r\n    checkoutOptions: CheckoutOptions;\r\n\r\n    constructor(private options: Partial<ClientConfigOptions>) {\r\n        assignPartial(this, options);\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/payment/stripe/config/client-config.ts","import * as RX from 'reactxp';\r\nimport { stripeCheckoutProcess } from \"../server-access/stripe\";\r\nimport { CheckoutOptions, CheckoutResult, CheckoutProcessOpen, CheckoutStatus } from \"@told/stack/src/payment/common/checkout-types\";\r\n\r\nexport class StripeTest extends RX.Component<{}, {\r\n    hasStarted: boolean,\r\n    isReady: boolean,\r\n    result: CheckoutResult,\r\n    open: CheckoutProcessOpen\r\n}>{\r\n\r\n    prepare = async () => {\r\n        const r = await stripeCheckoutProcess.prepare();\r\n        this.setState({\r\n            isReady: true,\r\n            open: r.open,\r\n        } as any);\r\n\r\n        r.result.subscribe(x => {\r\n            console.log('Result Changed', { result: x });\r\n\r\n            this.setState({\r\n                result: x\r\n            } as any);\r\n        });\r\n    }\r\n\r\n    open = () => {\r\n        if (this.state.open) {\r\n            this.state.open({\r\n                product: { amountCents: 100, description: 'Cool Thing to Buy' },\r\n                user: { email: 'me@home.com' },\r\n            });\r\n        }\r\n    }\r\n\r\n    render() {\r\n\r\n        if (!this.state.hasStarted) {\r\n            this.setState({\r\n                hasStarted: true\r\n            } as any);\r\n\r\n            setTimeout(this.prepare);\r\n        }\r\n\r\n        return (\r\n            <RX.View>\r\n                <RX.Button\r\n                    disabled={!this.state.isReady}\r\n                    onPress={this.open}\r\n                >Checkout</RX.Button>\r\n                {this.state.result && (\r\n                    <RX.View>\r\n                        <RX.Text>status: {CheckoutStatus[this.state.result.status]}</RX.Text>\r\n                        <RX.Text>checkoutId: {this.state.result.checkoutId}</RX.Text>\r\n                        <RX.Text>timeChanged: {this.state.result.timeChanged}</RX.Text>\r\n                    </RX.View>\r\n                )}\r\n            </RX.View>\r\n        );\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/components/stripe-test.tsx","import { StripeCheckoutProcess } from '@told/stack/src/payment/stripe/client/checkout-process';\r\nimport { clientConfig_stripe as clientConfig } from '../../config';\r\nimport { logger } from \"./logger\";\r\n\r\nexport const stripeCheckoutProcess = new StripeCheckoutProcess(clientConfig, {\r\n    logCheckoutEvent: (event, data) => {\r\n        logger.major('Stripe', event, data);\r\n    }\r\n});\n\n\n// WEBPACK FOOTER //\n// ./src/app/server-access/stripe.ts","import { delay } from \"./delay\";\r\n\r\nexport class InstanceLoader<T> {\r\n    private _isLoading = false;\r\n    private _instance: T;\r\n    private _resolves: ((value: T) => void)[] = [];\r\n\r\n    constructor(private _load: () => Promise<T>) {\r\n\r\n    }\r\n\r\n    load() {\r\n        return this._getInstance();\r\n    }\r\n\r\n    get instance() {\r\n        return this._getInstance();\r\n    }\r\n\r\n    private _getInstance = () => {\r\n        return new Promise<T>((resolve, reject) => {\r\n            if (this._instance) { return resolve(this._instance); }\r\n\r\n            this._resolves.push(resolve);\r\n\r\n            if (this._isLoading) { return; }\r\n            this._isLoading = true;\r\n\r\n            console.log('InstanceLoader START');\r\n\r\n            this._load().then(x => {\r\n                console.log('InstanceLoader LOADED');\r\n\r\n                this._instance = x;\r\n\r\n                const resolves = this._resolves;\r\n                this._resolves = null;\r\n\r\n                resolves.forEach(r => {\r\n                    setTimeout(() => {\r\n                        try {\r\n                            r(x);\r\n                        } catch (err) {\r\n                            console.error('InstanceLoader: A resolver threw an uncaught error', { err });\r\n                        }\r\n                    });\r\n                });\r\n\r\n                console.log('InstanceLoader DONE');\r\n            });\r\n\r\n        });\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/instance-loader.ts","// import * as Observable from 'zen-observable';\r\nimport O = require('zen-observable');\r\nexport type Observable<T> = O<T>;\r\nexport const Observable = (O as any).default as typeof O;\r\nexport type Observer<T> = ZenObservable.SubscriptionObserver<T>;\r\n\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/observable.ts","\r\nexport class ScriptLoader<T> {\r\n    private hasStartedLoading = false;\r\n    private instance: T;\r\n\r\n    private resolves: ((value: T) => void)[] = [];\r\n\r\n    constructor(private options: { url: string, scriptElementId: string, getInstance: () => T, onBeforeLoadScript?: () => void, onAfterLoadScript?: () => void }) {\r\n\r\n    }\r\n\r\n    private resolveAll = () => {\r\n        const r = this.resolves;\r\n        this.resolves = [];\r\n        r.forEach(x => x(this.instance));\r\n    };\r\n\r\n    load(): Promise<T> {\r\n        return new Promise<T>((resolve, reject) => {\r\n            if (this.instance) {\r\n                resolve(this.instance);\r\n                return;\r\n            }\r\n\r\n            // Subscribe\r\n            this.resolves.push(resolve);\r\n\r\n            if (this.hasStartedLoading) {\r\n                return;\r\n            }\r\n\r\n            this.hasStartedLoading = true;\r\n            console.log('ScriptLoader.load START');\r\n\r\n            if (this.options.onBeforeLoadScript) { this.options.onBeforeLoadScript(); }\r\n\r\n            // Load Script\r\n            const d = document;\r\n            const s = 'script';\r\n            const id = this.options.scriptElementId;\r\n\r\n            // Script already loaded\r\n            if (d.getElementById(id)) {\r\n                this.resolveAll();\r\n                return;\r\n            }\r\n\r\n            const fjs = d.getElementsByTagName(s)[0];\r\n            const js = d.createElement(s) as HTMLScriptElement;\r\n            js.id = id;\r\n\r\n            js.onload = () => {\r\n                if (this.options.onAfterLoadScript) { this.options.onAfterLoadScript(); }\r\n                this.instance = this.options.getInstance();\r\n                this.resolveAll();\r\n            }\r\n\r\n            js.src = this.options.url;\r\n            fjs.parentNode.insertBefore(js, fjs);\r\n        });\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/script-loader.ts","// https://gist.github.com/jed/982883\r\nexport const uuid = {\r\n    v4: () => ('' + 1e7 + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (a: any) => (a ^ Math.random() * 16 >> a / 4).toString(16))\r\n};\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/uuid.ts","import { Observable } from \"../../core/utils/observable\";\r\n\r\nexport interface CheckoutBusinessOptions {\r\n    name: string;\r\n    imageUrl: string;\r\n}\r\n\r\nexport interface CheckoutProductOptions {\r\n    amountCents: number;\r\n    description: string;\r\n}\r\n\r\nexport interface CheckoutUserOptions {\r\n    email?: string;\r\n}\r\n\r\nexport interface CheckoutRequirementOptions {\r\n    requireZipCode: boolean;\r\n    requireBillingAddress: boolean;\r\n}\r\n\r\nexport interface CheckoutExperienceOptions {\r\n    allowRememberMe: boolean;\r\n}\r\n\r\nexport interface CheckoutOptions {\r\n    product: CheckoutProductOptions;\r\n    user: CheckoutUserOptions;\r\n\r\n    business: CheckoutBusinessOptions;\r\n    requirements: CheckoutRequirementOptions;\r\n    experience: CheckoutExperienceOptions;\r\n}\r\n\r\nexport enum CheckoutStatus {\r\n    // Nothing has happened yet\r\n    NotStarted,\r\n    // The user has clicked the open button and is opening\r\n    Started,\r\n    // The form has called the opened callback\r\n    Opened,\r\n    // The form has called the closed callback (Caneelled)\r\n    Closed,\r\n    // The user has submitted and the provider is verifying the information \r\n    Verifing,\r\n    // The payment was sent to the server\r\n    Submitting,\r\n    // The payment is being processed on the server\r\n    Processing,\r\n    // The payment was made successfully\r\n    Success,\r\n    // The payment failed (Try Again)\r\n    PaymentFailed,\r\n    // The payment succeeded but the processing failed (Customer Support)\r\n    ProcessingFailed,\r\n    // The payment process was not found\r\n    NotFound,\r\n}\r\n\r\nexport type CheckoutProcessOpen = (options: Partial<CheckoutOptions>) => void;\r\n\r\nexport interface CheckoutProcessPrepareResult {\r\n    open: CheckoutProcessOpen;\r\n    result: Observable<CheckoutResult>;\r\n}\r\n\r\nexport interface CheckoutResult {\r\n    checkoutId: string;\r\n    status: CheckoutStatus;\r\n    timeChanged: number;\r\n}\r\n\r\nexport interface CheckoutProcess {\r\n    // Prepare must be called before user can Click Button (Button should be disabled until ready)\r\n    prepare(): Promise<CheckoutProcessPrepareResult>;\r\n\r\n    // User Clicks Button (direct call only)\r\n    // open(options: CheckoutOptions): Observable<CheckoutResult>;\r\n\r\n    // Check Results on a Previously Submitted Process\r\n    getResult(checkoutId: string): Observable<CheckoutResult>;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/payment/common/checkout-types.ts","import { Observable, Observer } from \"../../../core/utils/observable\";\r\nimport { CheckoutProcess, CheckoutOptions, CheckoutResult, CheckoutProcessPrepareResult, CheckoutStatus } from '../../common/checkout-types';\r\nimport { ClientConfig, ClientRuntimeOptions } from \"../config/client-config\";\r\nimport { StripeCheckoutAccess, StripeToken, StripeTokenArgs } from \"./stripe-checkout-access\";\r\nimport { assignPartial } from \"../../../core/utils/objects\";\r\nimport { uuid } from \"../../../core/utils/uuid\";\r\n\r\nexport class StripeCheckoutProcess implements CheckoutProcess {\r\n\r\n    private _access: StripeCheckoutAccess;\r\n\r\n    constructor(private config: ClientConfig, private runtime: ClientRuntimeOptions) {\r\n\r\n    }\r\n\r\n    prepare = async (): Promise<CheckoutProcessPrepareResult> => {\r\n        console.log('StripeCheckoutProcess START');\r\n\r\n        if (!this._access) {\r\n            this._access = new StripeCheckoutAccess(this.config.stripePublishableKey);\r\n        }\r\n\r\n        console.log('StripeCheckoutProcess Prepare Stripe Access');\r\n        await this._access.prepare();\r\n\r\n        console.log('StripeCheckoutProcess Setup Result Observer');\r\n        const checkoutId = uuid.v4();\r\n\r\n        let observer: Observer<CheckoutResult>;\r\n        let lastResult: CheckoutResult = {\r\n            checkoutId,\r\n            status: CheckoutStatus.NotStarted,\r\n            timeChanged: Date.now(),\r\n        };\r\n\r\n        const updateResult = (result: Partial<CheckoutResult>) => {\r\n            console.log('StripeCheckoutProcess updateResult', { result });\r\n\r\n            if (result.checkoutId && result.checkoutId !== lastResult.checkoutId) {\r\n                throw 'StripeCheckoutProcess: Cannot change checkoutId';\r\n            }\r\n\r\n            assignPartial(lastResult, result);\r\n            lastResult.checkoutId = checkoutId;\r\n            lastResult.timeChanged = Date.now();\r\n            observer.next(lastResult);\r\n\r\n            this.runtime.logCheckoutEvent('ResultChange', lastResult);\r\n        }\r\n\r\n        const result = new Observable<CheckoutResult>(o => {\r\n            console.log('StripeCheckoutProcess Observable START');\r\n            observer = o;\r\n        });\r\n\r\n        const tokenCallback = (token: StripeToken, args: StripeTokenArgs) => {\r\n\r\n            updateResult({ status: CheckoutStatus.Submitting });\r\n\r\n            // TODO: Submit to server\r\n\r\n        };\r\n\r\n        const open = (options: Partial<CheckoutOptions>): void => {\r\n\r\n            const o = {} as CheckoutOptions;\r\n            assignPartial(o, this.config.checkoutOptions);\r\n            assignPartial(o, options);\r\n\r\n            this._access.open({\r\n                tokenCallback,\r\n                recommendedOptions: {\r\n                    amount: o.product.amountCents,\r\n                    name: o.business.name,\r\n                    image: o.business.imageUrl,\r\n                    description: o.product.description,\r\n                    zipCode: o.requirements.requireZipCode,\r\n                    billingAddress: o.requirements.requireBillingAddress,\r\n                },\r\n                additionalOptions: {\r\n                    email: o.user.email,\r\n                    allowRememberMe: o.experience.allowRememberMe,\r\n                    opened: () => {\r\n                        updateResult({ status: CheckoutStatus.Opened });\r\n                    },\r\n                    closed: () => {\r\n                        if (lastResult.status < CheckoutStatus.Submitting) {\r\n                            updateResult({ status: CheckoutStatus.Closed });\r\n                        }\r\n                    },\r\n                },\r\n            });\r\n\r\n            this.runtime.logCheckoutEvent('Open', { checkoutId, openOptions: options, configOptions: this.config.checkoutOptions });\r\n            updateResult({ status: CheckoutStatus.Started });\r\n        };\r\n\r\n        console.log('StripeCheckoutProcess DONE');\r\n\r\n        return {\r\n            open,\r\n            result\r\n        };\r\n    }\r\n\r\n    getResult(checkoutId: string): Observable<CheckoutResult> {\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/payment/stripe/client/checkout-process.ts","import { ScriptLoader } from \"../../../core/utils/script-loader\";\r\nimport { InstanceLoader } from \"../../../core/utils/instance-loader\";\r\n\r\n// https://stripe.com/docs/checkout#integration-custom\r\n\r\nexport interface StripeCheckout {\r\n    configure(options: StripeConfigureOptions & StripeRequiredOptions & StripeRecommendedOptions & StripeAdditionalOptions): StripeCheckoutHandler;\r\n}\r\n\r\nexport interface StripeCheckoutHandler {\r\n    open(options: StripeRequiredOptions & StripeRecommendedOptions & StripeAdditionalOptions): void;\r\n}\r\n\r\nexport interface StripeConfigureOptions {\r\n    // Stripe Publishable Key\r\n    key: string;\r\n}\r\n\r\nexport interface StripeRequiredOptions {\r\n    // Callback\r\n    token?: (token: StripeToken, args: StripeTokenArgs) => void;\r\n}\r\n\r\n// export export interface TokenResult {\r\n//     token: StripeToken;\r\n//     args: StripeTokenArgs;\r\n// }\r\n\r\nexport interface StripeRecommendedOptions {\r\n    // Business Image\r\n    image?: string;\r\n    // Business Name\r\n    name?: string;\r\n    // Product Description\r\n    description?: string;\r\n    // Amount in Cents\r\n    amount?: number;\r\n    // Language\r\n    locale?: 'auto' | string;\r\n    // Zip Code Required\r\n    zipCode?: boolean;\r\n    // Billing Address Required\r\n    billingAddress?: boolean;\r\n}\r\n\r\nexport interface StripeAdditionalOptions {\r\n    // Currency Code (Default: USD)\r\n    currency?: string;\r\n    // Payment Button Label\r\n    panelLabel?: string;\r\n    // Shipping Addres Required\r\n    shippingAddress?: boolean;\r\n    // Prefilled Email\r\n    email?: string;\r\n    // Start Button Text  (Simple Only)\r\n    // label?: string;\r\n    // Remember Me Allowed\r\n    allowRememberMe?: boolean;\r\n    // Bitcoin Payment Allowed\r\n    bitcoin?: boolean;\r\n    // Opened Callback\r\n    opened?: () => void;\r\n    // Closed Callback\r\n    closed?: () => void;\r\n}\r\n\r\nexport interface StripeToken {\r\n    id: string;\r\n    email: string;\r\n}\r\n\r\nexport interface StripeTokenArgs {\r\n\r\n    // Billing name and address\r\n    billing_name?: string;\r\n    billing_address_country?: string;\r\n    billing_address_zip?: string;\r\n    billing_address_state?: string;\r\n    billing_address_line1?: string;\r\n    billing_address_city?: string;\r\n    billing_address_country_code?: string;\r\n\r\n    // Shipping name and address\r\n    shipping_name?: string;\r\n    shipping_address_country?: string;\r\n    shipping_address_zip?: string;\r\n    shipping_address_state?: string;\r\n    shipping_address_line1?: string;\r\n    shipping_address_city?: string;\r\n    shipping_address_country_code?: string;\r\n}\r\n\r\n\r\ndeclare var StripeCheckout: StripeCheckout;\r\n\r\nconst scriptLoader = new ScriptLoader({\r\n    url: 'https://checkout.stripe.com/checkout.js',\r\n    scriptElementId: 'StripeCheckout',\r\n    getInstance: () => {\r\n        return StripeCheckout;\r\n    }\r\n});\r\n\r\nexport class StripeCheckoutAccess {\r\n\r\n    _handler: StripeCheckoutHandler;\r\n\r\n    constructor(private stripePublishableKey: string) { }\r\n\r\n    private handlerLoader = new InstanceLoader(async () => {\r\n        console.log('StripeCheckoutProcess.handlerLoader START');\r\n        const s = await scriptLoader.load();\r\n        console.log('StripeCheckoutProcess.handlerLoader LOADED');\r\n        const handler = await s.configure({ key: this.stripePublishableKey });\r\n        console.log('StripeCheckoutProcess.handlerLoader END');\r\n        return handler;\r\n    });\r\n\r\n    prepare = async () => {\r\n        this._handler = await this.handlerLoader.instance;\r\n        return;\r\n    }\r\n\r\n    // This must be a direct call to handler.open (It cannot be async or will get popup-blocked)\r\n    open = (options: {\r\n        tokenCallback: (token: StripeToken, args: StripeTokenArgs) => void,\r\n        recommendedOptions?: StripeRecommendedOptions,\r\n        additionalOptions?: StripeAdditionalOptions\r\n    }) => {\r\n        const handler = this._handler;\r\n\r\n        if (!handler) {\r\n            throw 'The Stripe Checkout Handler must be loaded before Open is Clicked';\r\n        }\r\n\r\n        handler.open({\r\n            token: options.tokenCallback,\r\n            ...options.recommendedOptions,\r\n            ...options.additionalOptions,\r\n        });\r\n    };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/payment/stripe/client/stripe-checkout-access.ts"],"sourceRoot":""}