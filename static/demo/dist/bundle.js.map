{"version":3,"sources":["webpack:///bundle.js","webpack:///./src/app/app.tsx","webpack:///./../config/src/core/logger-client.ts","webpack:///./../config/src/lookup-lsc/client.ts","webpack:///./../config/src/payment/stripe-client.ts","webpack:///./src/app/components/stripe-test.tsx","webpack:///./src/app/server-access/logger.ts","webpack:///./src/app/server-access/stripe.ts","webpack:///./src/app/utils/deviceInfo.ts","webpack:///./src/index.tsx","webpack:///./../../../told-stack-npm/src/core/account/session-id.ts","webpack:///./../../../told-stack-npm/src/core/logger/client/logger.ts","webpack:///./../../../told-stack-npm/src/core/logger/config/client-config.ts","webpack:///./../../../told-stack-npm/src/core/utils/hash.ts","webpack:///./../../../told-stack-npm/src/core/utils/instance-loader.ts","webpack:///./../../../told-stack-npm/src/core/utils/rand.ts","webpack:///./../../../told-stack-npm/src/core/utils/script-loader.ts","webpack:///./../../../told-stack-npm/src/core/utils/time.ts","webpack:///./../../../told-stack-npm/src/core/utils/uuid.ts","webpack:///./../../../told-stack-npm/src/data-patterns/lookup-lsc/src-config/client-config.ts","webpack:///./../../../told-stack-npm/src/payment/common/checkout-types.ts","webpack:///./../../../told-stack-npm/src/payment/stripe/client/checkout-process.ts","webpack:///./../../../told-stack-npm/src/payment/stripe/client/stripe-checkout-access.ts","webpack:///./../../../told-stack-npm/src/payment/stripe/config/client-config.ts","webpack:///./../../../told-stack-npm/src/core/utils/objects.ts","webpack:///./src/config.ts","webpack:///./../../../told-stack-npm/src/core/utils/observable.ts"],"names":["webpackJsonp","136","module","exports","__webpack_require__","Object","defineProperty","value","RX","stripe_test_1","App","createElement","View","Text","StripeTest","137","client_config_1","clientConfig","ClientConfig","timeBatchSeconds","sendLog_domain","sendLog_route","138","lookup_domain","downloadBlob_domain","lookup_route","downloadBlob_route","139","__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","verb","n","v","op","f","TypeError","_","y","t","call","label","ops","pop","trys","length","push","g","sent","throw","return","Symbol","iterator","_this","stripePublishableKey","checkoutOptions","business","name","imageUrl","statementDescriptor","requirements","requireZipCode","requireBillingAddress","experience","allowRememberMe","_a","140","__extends","extendStatics","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","stripe_1","_super","arguments","prepare","r","stripeCheckoutProcess","setState","isReady","open","subscribe","x","console","log","state","product","productCode","amountCents","monthlyAmountCents","description","statementDescriptor_subscription","subscriptionPlanId_noPrice","subscriptionPlanName","user","email","render","hasStarted","setTimeout","Button","disabled","onPress","clientCheckoutId","checkoutStatus","paymentStatus","subscriptionStatus","deliverableStatus","deliverableStatus_executionResult","Component","141","subscribeLoggerToDeviceInfoChanges","deviceInfoAccess","getDeviceInfo","lastDeviceInfo","getDeviceInfo_observable","logger","logger_1","session_id_1","config_1","deviceInfo_1","session","SessionId","DeviceInfoAccess","Logger","clientConfig_logger","sessionId","userId","version","path","deviceInfo","142","checkout_process_1","StripeCheckoutProcess","clientConfig_stripe","logCheckoutEvent","event","data","major","143","observable_1","objects_1","forceRefresh","init","_b","_c","_d","platform","Platform","getType","isHighPixelDensityScreen","UserInterface","windowSize","measureWindow","pixelRatio","getPixelRatio","getContentSizeMultiplier","lastContentSizeMultiplier","getMaxContentSizeMultiplier","maxContentSizeMultiplier","isScreenReaderEnabled","Accessibility","Linking","getInitialUrl","initialUrl","timeZoneOffset","Date","getTimezoneOffset","isLocationAvailable","Location","isAvailable","web_userAgent","window","navigator","userAgent","web_platform","web_language","language","web_locationHref","location","href","lastActivationState","Types","AppActivationState","getActivationState","_observable","Observable","observer","_observer","trigger","change","assignPartial","_isSubscribed","activationStateChangedEvent","deepLinkRequestEvent","lastDeepLinkRequest","Network","connectivityChangedEvent","lastConnectivity","contentSizeMultiplierChangedEvent","keyboardNavigationEvent","lastIsNavigatingWithKeyboard","UserPresence","userPresenceChangedEvent","lastUserPresence","144","app_1","initialize","setMainView","145","createSessonId","toISOString","rand_1","randHex","createUserId_anonymous","setActualUserId","indexOf","146","config","getUserInfo","getContextInfo","_hasSentSessionInfo","_startTime","now","_lastSendTime","_items","_timeoutId","sendBatch","shouldSendImmediately","scheduleSend","items","sendNow","timeUsed","timeRemaining","clearTimeout","sendSessionInfo","isError","category","time","runTime","startTime","userInfo","appContextInfo","error","undefined","sentItems","hasSentAll","count","forEach","JSON","stringify","maxDataSize","substr","maxSendSize","Math","floor","slice","fetch","getSendLogUrl","method","ok","_attempts","filter","maxItemSendAttempts","147","options","148","hashEmail_partial","replace","hash","text","split","reduce","c","charCodeAt","149","InstanceLoader","_load","_isLoading","_resolves","_getInstance","_instance","resolves","err","load","get","enumerable","configurable","150","random","toString","151","ScriptLoader","hasStartedLoading","resolveAll","instance","onBeforeLoadScript","document","s","id","scriptElementId","getElementById","fjs","getElementsByTagName","js","onload","onAfterLoadScript","getInstance","src","url","parentNode","insertBefore","152","setInterval_exponentialBackoff","callback","timeMs","maxTime","maxAttempts","base","ids","attempt","CANCEL","backoffTime","pow","actualTime","min","clearInterval_exponentialBackoff","153","uuid","v4","a","154","timePollSeconds","maxPollCount","timeToLiveSeconds","shouldGzipDownloadBlob","getLookupUrl","key","containerName","blobName","getDataDownloadUrl","lookup","getDataDownloadBlobName","timeKey","155","CheckoutStatus","PaymentStatus","SubscriptionStatus","DeliverableStatus","DeliverableStatus_ExecutionResult","156","checkout_types_1","stripe_checkout_access_1","uuid_1","time_1","runtime","userToken","lastResult","actualCheckoutOptions","updateResult","tokenCallback","_access","StripeCheckoutAccess","getUserToken","serverCheckoutId","NotStarted","timeChanged","o","token","args","rSubmit","submitResult","updateUrl_1","updateIntervalId_1","Submitting","getSubmitTokenUrl","metadata","getStripeChargeMetadata","getStripeChargeStatementDescriptor","getStripeChargeStatementDescriptor_subscription","json","Submitted","getCheckoutStatusUrl","rStatus","Submission_Rejected_LoginAndResubmit","Processing","recommendedOptions","amount","image","zipCode","billingAddress","additionalOptions","opened","Opened","closed","Closed","openOptions","configOptions","Started","getResult","checkoutId","Error","157","__assign","assign","i","script_loader_1","instance_loader_1","scriptLoader","StripeCheckout","handlerLoader","handler","configure","_handler","158","hash_1","domain","submit_route","status_route_partial","status_route","getEmailHash","20","group","getKey","k","groupToArray","getOwnPropertyNames","map","75","client_1","clientConfig_lookupLsc","logger_client_1","stripe_client_1","76","Observable_1"],"mappings":"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","file":"bundle.js","sourcesContent":["webpackJsonp([0],{\n\n/***/ 136:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RX = __webpack_require__(31);\r\nvar stripe_test_1 = __webpack_require__(140);\r\n// import { Store } from './store/store';\r\n// import { handleRoute } from \"./routes\";\r\n// import { Root } from \"./components/page/root\";\r\n// const store = Store;\r\n// handleRoute();\r\n// <Root store={store} />\r\nexports.App = function () { return (RX.createElement(RX.View, null,\r\n    RX.createElement(RX.Text, null, \"TEST\"),\r\n    RX.createElement(stripe_test_1.StripeTest, null))); };\r\n\n\n/***/ }),\n\n/***/ 137:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar client_config_1 = __webpack_require__(147);\r\nexports.clientConfig = new client_config_1.ClientConfig({\r\n    timeBatchSeconds: 10,\r\n    sendLog_domain: 'https://told-stack-demo.azureedge.net',\r\n    // sendLog_domain: 'http://localhost:7071',\r\n    sendLog_route: 'api/logger/send-log',\r\n});\r\n\n\n/***/ }),\n\n/***/ 138:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar client_config_1 = __webpack_require__(154);\r\nexports.clientConfig = new client_config_1.ClientConfig({\r\n    // lookup_domain: 'https://told-stack-demo.azurewebsites.net',\r\n    // downloadBlob_domain: 'https://told-stack-demo.azurewebsites.net',\r\n    lookup_domain: 'https://told-stack-demo.azureedge.net',\r\n    downloadBlob_domain: 'https://told-stack-demo.azureedge.net',\r\n    lookup_route: 'api/lookup-lsc',\r\n    downloadBlob_route: 'api/lookup-lsc-download'\r\n});\r\n\n\n/***/ }),\n\n/***/ 139:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar _this = this;\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar client_config_1 = __webpack_require__(158);\r\nexports.clientConfig = new client_config_1.ClientConfig({\r\n    stripePublishableKey: 'pk_stripe_publishable_key_1234',\r\n    checkoutOptions: {\r\n        business: {\r\n            name: 'Told Software',\r\n            imageUrl: 'https://toldstackdemo.blob.core.windows.net/images/ToldLogo128.png',\r\n            statementDescriptor: 'ToldSoft',\r\n        },\r\n        requirements: {\r\n            requireZipCode: true,\r\n            requireBillingAddress: true,\r\n        },\r\n        experience: {\r\n            allowRememberMe: true\r\n        },\r\n    },\r\n}, function () { return __awaiter(_this, void 0, void 0, function () { return __generator(this, function (_a) {\r\n    return [2 /*return*/, null];\r\n}); }); });\r\n\n\n/***/ }),\n\n/***/ 140:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RX = __webpack_require__(31);\r\nvar stripe_1 = __webpack_require__(142);\r\nvar StripeTest = (function (_super) {\r\n    __extends(StripeTest, _super);\r\n    function StripeTest() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.prepare = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var _this = this;\r\n            var r;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, stripe_1.stripeCheckoutProcess.prepare()];\r\n                    case 1:\r\n                        r = _a.sent();\r\n                        this.setState({\r\n                            isReady: true,\r\n                            open: r.open,\r\n                        });\r\n                        r.result.subscribe(function (x) {\r\n                            console.log('Result Changed', { result: x });\r\n                            _this.setState({\r\n                                result: x\r\n                            });\r\n                        });\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n        _this.open = function () {\r\n            if (_this.state.open) {\r\n                _this.state.open({\r\n                    product: {\r\n                        productCode: 'test-product-01',\r\n                        amountCents: 10000,\r\n                        monthlyAmountCents: 1000,\r\n                        description: 'Cool Thing to Buy',\r\n                        statementDescriptor: 'prod 01',\r\n                        statementDescriptor_subscription: 'prod 01 sub',\r\n                        subscriptionPlanId_noPrice: 'prod01',\r\n                        subscriptionPlanName: 'prod01',\r\n                    },\r\n                    user: { email: 'me@home.com' },\r\n                });\r\n            }\r\n        };\r\n        return _this;\r\n    }\r\n    StripeTest.prototype.render = function () {\r\n        if (!this.state.hasStarted) {\r\n            this.setState({\r\n                hasStarted: true\r\n            });\r\n            setTimeout(this.prepare);\r\n        }\r\n        return (RX.createElement(RX.View, null,\r\n            RX.createElement(RX.Button, { disabled: !this.state.isReady, onPress: this.open }, \"Checkout\"),\r\n            this.state.result && (RX.createElement(RX.View, null,\r\n                RX.createElement(RX.Text, null,\r\n                    \"checkoutId: \",\r\n                    this.state.result.clientCheckoutId),\r\n                RX.createElement(RX.Text, null,\r\n                    \"checkoutStatus: \",\r\n                    this.state.result.checkoutStatus),\r\n                RX.createElement(RX.Text, null,\r\n                    \"paymentStatus: \",\r\n                    this.state.result.paymentStatus),\r\n                RX.createElement(RX.Text, null,\r\n                    \"subscriptionStatus: \",\r\n                    this.state.result.subscriptionStatus),\r\n                RX.createElement(RX.Text, null,\r\n                    \"deliverableStatus: \",\r\n                    this.state.result.deliverableStatus),\r\n                RX.createElement(RX.Text, null,\r\n                    \"deliverableStatus_executionResult: \",\r\n                    this.state.result.deliverableStatus_executionResult)))));\r\n    };\r\n    return StripeTest;\r\n}(RX.Component));\r\nexports.StripeTest = StripeTest;\r\n\n\n/***/ }),\n\n/***/ 141:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar logger_1 = __webpack_require__(146);\r\nvar session_id_1 = __webpack_require__(145);\r\nvar config_1 = __webpack_require__(75);\r\nvar deviceInfo_1 = __webpack_require__(143);\r\nvar session = new session_id_1.SessionId();\r\nvar deviceInfoAccess = new deviceInfo_1.DeviceInfoAccess();\r\nvar lastDeviceInfo;\r\nexports.logger = new logger_1.Logger(config_1.clientConfig_logger, function () { return ({ sessionId: session.sessionId, userId: session.userId }); }, function () { return ({ version: 'v1.0', path: 'a/b/c' }); }, function () { return ({ deviceInfo: lastDeviceInfo }); });\r\nfunction subscribeLoggerToDeviceInfoChanges() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, deviceInfoAccess.getDeviceInfo()];\r\n                case 1:\r\n                    lastDeviceInfo = _a.sent();\r\n                    deviceInfoAccess.getDeviceInfo_observable().subscribe(function (x) {\r\n                        lastDeviceInfo = x;\r\n                        console.log('DeviceInfo Changed', { lastDeviceInfo: lastDeviceInfo });\r\n                        exports.logger.log('DeviceInfo', 'Changed', lastDeviceInfo);\r\n                    });\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.subscribeLoggerToDeviceInfoChanges = subscribeLoggerToDeviceInfoChanges;\r\nsubscribeLoggerToDeviceInfoChanges();\r\n\n\n/***/ }),\n\n/***/ 142:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar checkout_process_1 = __webpack_require__(156);\r\nvar config_1 = __webpack_require__(75);\r\nvar logger_1 = __webpack_require__(141);\r\nexports.stripeCheckoutProcess = new checkout_process_1.StripeCheckoutProcess(config_1.clientConfig_stripe, {\r\n    logCheckoutEvent: function (event, data) {\r\n        logger_1.logger.major('Stripe', event, data);\r\n    }\r\n});\r\n\n\n/***/ }),\n\n/***/ 143:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RX = __webpack_require__(31);\r\nvar observable_1 = __webpack_require__(76);\r\nvar objects_1 = __webpack_require__(20);\r\nvar DeviceInfoAccess = (function () {\r\n    function DeviceInfoAccess() {\r\n        var _this = this;\r\n        this.getDeviceInfo = function (forceRefresh) {\r\n            if (forceRefresh === void 0) { forceRefresh = false; }\r\n            return __awaiter(_this, void 0, void 0, function () {\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0: return [4 /*yield*/, this.init(forceRefresh)];\r\n                        case 1:\r\n                            _a.sent();\r\n                            return [2 /*return*/, this.deviceInfo];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        this.init = function (forceRefresh) {\r\n            if (forceRefresh === void 0) { forceRefresh = false; }\r\n            return __awaiter(_this, void 0, void 0, function () {\r\n                var _a, _b, _c;\r\n                return __generator(this, function (_d) {\r\n                    switch (_d.label) {\r\n                        case 0:\r\n                            if (!forceRefresh && this.deviceInfo) {\r\n                                return [2 /*return*/];\r\n                            }\r\n                            this.deviceInfo = {};\r\n                            this.deviceInfo.platform = RX.Platform.getType();\r\n                            this.deviceInfo.isHighPixelDensityScreen = RX.UserInterface.isHighPixelDensityScreen();\r\n                            this.deviceInfo.windowSize = RX.UserInterface.measureWindow();\r\n                            this.deviceInfo.pixelRatio = RX.UserInterface.getPixelRatio();\r\n                            _a = this.deviceInfo;\r\n                            return [4 /*yield*/, RX.UserInterface.getContentSizeMultiplier()];\r\n                        case 1:\r\n                            _a.lastContentSizeMultiplier = _d.sent();\r\n                            _b = this.deviceInfo;\r\n                            return [4 /*yield*/, RX.UserInterface.getMaxContentSizeMultiplier()];\r\n                        case 2:\r\n                            _b.maxContentSizeMultiplier = _d.sent();\r\n                            this.deviceInfo.isScreenReaderEnabled = RX.Accessibility.isScreenReaderEnabled();\r\n                            _c = this.deviceInfo;\r\n                            return [4 /*yield*/, RX.Linking.getInitialUrl()];\r\n                        case 3:\r\n                            _c.initialUrl = _d.sent();\r\n                            this.deviceInfo.timeZoneOffset = new Date().getTimezoneOffset();\r\n                            this.deviceInfo.isLocationAvailable = RX.Location.isAvailable();\r\n                            if (this.deviceInfo.platform === 'web') {\r\n                                this.deviceInfo.web_userAgent = window.navigator.userAgent;\r\n                                this.deviceInfo.web_platform = window.navigator.platform;\r\n                                this.deviceInfo.web_language = window.navigator.language;\r\n                                this.deviceInfo.web_locationHref = window.location.href;\r\n                            }\r\n                            this.deviceInfo.lastActivationState = RX.Types.AppActivationState[RX.App.getActivationState()];\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        };\r\n    }\r\n    DeviceInfoAccess.prototype.getDeviceInfo_observable = function () {\r\n        var _this = this;\r\n        if (!this._observable) {\r\n            this._observable = new observable_1.Observable(function (observer) {\r\n                _this._observer = observer;\r\n            });\r\n            this.subscribe();\r\n        }\r\n        return this._observable;\r\n    };\r\n    DeviceInfoAccess.prototype.trigger = function (change) {\r\n        console.log('DeviceInfoAccess.trigger', { change: change });\r\n        objects_1.assignPartial(this.deviceInfo, change);\r\n        if (this._observer) {\r\n            this._observer.next(change);\r\n        }\r\n    };\r\n    DeviceInfoAccess.prototype.subscribe = function () {\r\n        var _this = this;\r\n        if (!this._isSubscribed) {\r\n            return;\r\n        }\r\n        this._isSubscribed = true;\r\n        RX.App.activationStateChangedEvent.subscribe(function (state) {\r\n            _this.trigger({\r\n                lastActivationState: RX.Types.AppActivationState[state]\r\n            });\r\n        });\r\n        RX.Linking.deepLinkRequestEvent.subscribe(function (e) {\r\n            _this.trigger({\r\n                lastDeepLinkRequest: e\r\n            });\r\n        });\r\n        RX.Network.connectivityChangedEvent.subscribe(function (e) {\r\n            _this.trigger({\r\n                lastConnectivity: e\r\n            });\r\n        });\r\n        RX.UserInterface.contentSizeMultiplierChangedEvent.subscribe(function (e) {\r\n            _this.trigger({\r\n                lastContentSizeMultiplier: e\r\n            });\r\n        });\r\n        RX.UserInterface.keyboardNavigationEvent.subscribe(function (e) {\r\n            _this.trigger({\r\n                lastIsNavigatingWithKeyboard: e\r\n            });\r\n        });\r\n        RX.UserPresence.userPresenceChangedEvent.subscribe(function (e) {\r\n            _this.trigger({\r\n                lastUserPresence: e\r\n            });\r\n        });\r\n    };\r\n    return DeviceInfoAccess;\r\n}());\r\nexports.DeviceInfoAccess = DeviceInfoAccess;\r\n\n\n/***/ }),\n\n/***/ 144:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RX = __webpack_require__(31);\r\nvar app_1 = __webpack_require__(136);\r\nRX.App.initialize(true, true);\r\nRX.UserInterface.setMainView(RX.createElement(app_1.App, null));\r\n\n\n/***/ }),\n\n/***/ 145:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar rand_1 = __webpack_require__(150);\r\nvar SessionId = (function () {\r\n    function SessionId(userId) {\r\n        if (userId === void 0) { userId = null; }\r\n        this.userId = userId;\r\n        this.sessionId = createSessonId();\r\n        if (!this.userId) {\r\n            this.userId = createUserId_anonymous();\r\n        }\r\n    }\r\n    SessionId.prototype.setActualUserId = function (userId) {\r\n        if (this.userId.indexOf('anon-') !== 0) {\r\n            throw 'setActualUserId is only valid if the current userId is anonymous';\r\n        }\r\n        this.userId = userId;\r\n    };\r\n    return SessionId;\r\n}());\r\nexports.SessionId = SessionId;\r\nfunction createSessonId() {\r\n    var iso = (new Date()).toISOString();\r\n    var rand = rand_1.randHex(16);\r\n    return \"s_\" + iso + \"_\" + rand;\r\n}\r\nexports.createSessonId = createSessonId;\r\nfunction createUserId_anonymous() {\r\n    var iso = (new Date()).toISOString();\r\n    var rand = rand_1.randHex(16);\r\n    return \"u_anon_\" + iso + \"_\" + rand;\r\n}\r\nexports.createUserId_anonymous = createUserId_anonymous;\r\n\n\n/***/ }),\n\n/***/ 146:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Logger = (function () {\r\n    function Logger(config, getUserInfo, getContextInfo, getDeviceInfo) {\r\n        var _this = this;\r\n        this.config = config;\r\n        this.getUserInfo = getUserInfo;\r\n        this.getContextInfo = getContextInfo;\r\n        this.getDeviceInfo = getDeviceInfo;\r\n        this._hasSentSessionInfo = false;\r\n        this._startTime = Date.now();\r\n        this._lastSendTime = Date.now();\r\n        this._items = [];\r\n        this._timeoutId = 0;\r\n        this.sendBatch = function (shouldSendImmediately) {\r\n            if (shouldSendImmediately === void 0) { shouldSendImmediately = false; }\r\n            if (!shouldSendImmediately\r\n                && Date.now() - _this._lastSendTime < _this.config.timeBatchSeconds * 1000) {\r\n                _this.scheduleSend();\r\n                return;\r\n            }\r\n            var items = _this._items;\r\n            _this._items = [];\r\n            _this.sendNow(items);\r\n        };\r\n        this.scheduleSend = function () {\r\n            var timeUsed = Date.now() - _this._lastSendTime;\r\n            var timeRemaining = _this.config.timeBatchSeconds - timeUsed;\r\n            clearTimeout(_this._timeoutId);\r\n            _this._timeoutId = setTimeout(_this.sendBatch, timeRemaining);\r\n        };\r\n        setTimeout(function () { return _this.sendSessionInfo(); }, 250);\r\n    }\r\n    Logger.prototype.sendSessionInfo = function () {\r\n        if (!this._hasSentSessionInfo) {\r\n            this._hasSentSessionInfo = true;\r\n            this._items.push({\r\n                isError: null,\r\n                category: 'Session',\r\n                event: 'Info',\r\n                data: null,\r\n                time: Date.now(),\r\n                runTime: Date.now() - this._startTime,\r\n                startTime: this._startTime,\r\n                userInfo: this.getUserInfo(),\r\n                appContextInfo: this.getContextInfo(),\r\n                deviceInfo: this.getDeviceInfo(),\r\n            });\r\n            this.sendBatch(true);\r\n        }\r\n    };\r\n    Logger.prototype.error = function (category, event, data, shouldSendImmediately) {\r\n        if (shouldSendImmediately === void 0) { shouldSendImmediately = false; }\r\n        this.log(category, event, data, true, true);\r\n    };\r\n    Logger.prototype.major = function (category, event, data, shouldSendImmediately) {\r\n        if (shouldSendImmediately === void 0) { shouldSendImmediately = false; }\r\n        this.log(category, event, data, true);\r\n    };\r\n    Logger.prototype.log = function (category, event, data, shouldSendImmediately, isError) {\r\n        if (shouldSendImmediately === void 0) { shouldSendImmediately = false; }\r\n        if (isError === void 0) { isError = false; }\r\n        var d = {\r\n            isError: isError ? true : undefined,\r\n            category: category,\r\n            event: event,\r\n            data: data,\r\n            time: Date.now(),\r\n            runTime: Date.now() - this._startTime,\r\n            startTime: this._startTime,\r\n            userInfo: this.getUserInfo(),\r\n            appContextInfo: this.getContextInfo(),\r\n            deviceInfo: undefined,\r\n        };\r\n        this._items.push(d);\r\n        this.sendBatch(shouldSendImmediately);\r\n    };\r\n    Logger.prototype.sendNow = function (items) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            var sentItems, body, hasSentAll, count, r, _a, _b;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        this._lastSendTime = Date.now();\r\n                        if (!items || !items.length) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        items.forEach(function (x) {\r\n                            if (!x.data) {\r\n                                return;\r\n                            }\r\n                            var d = x.data;\r\n                            if (typeof x.data !== 'string') {\r\n                                d = JSON.stringify(x.data);\r\n                            }\r\n                            if (d.length > _this.config.maxDataSize) {\r\n                                x.data = 'truncated:' + d.substr(0, _this.config.maxDataSize - 16) + '...';\r\n                            }\r\n                        });\r\n                        sentItems = items;\r\n                        body = JSON.stringify(items);\r\n                        hasSentAll = true;\r\n                        count = items.length;\r\n                        while (body.length > this.config.maxSendSize) {\r\n                            if (count === 1) {\r\n                                // Truncate Message Data\r\n                                sentItems.forEach(function (x) { return x.data = 'truncated:' + JSON.stringify(x.data).substr(0, _this.config.maxDataSize) + '...'; });\r\n                                break;\r\n                            }\r\n                            hasSentAll = false;\r\n                            count = Math.floor(count / 2);\r\n                            sentItems = items.slice(0, count);\r\n                            body = JSON.stringify(sentItems);\r\n                        }\r\n                        if (!hasSentAll) {\r\n                            (_a = this._items).push.apply(_a, items.slice(count));\r\n                        }\r\n                        return [4 /*yield*/, fetch(this.config.getSendLogUrl(), { method: 'POST', body: body })];\r\n                    case 1:\r\n                        r = _c.sent();\r\n                        // If send failure, add items back to end of queue to try again\r\n                        if (!r.ok) {\r\n                            sentItems.forEach(function (x) { return x._attempts++; });\r\n                            (_b = this._items).push.apply(_b, sentItems.filter(function (x) { return x._attempts < _this.config.maxItemSendAttempts; }));\r\n                        }\r\n                        // Immediately Send Again to Send the rest of the batch\r\n                        if (!hasSentAll) {\r\n                            setTimeout(function () { return _this.sendBatch(true); });\r\n                        }\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Logger;\r\n}());\r\nexports.Logger = Logger;\r\n\n\n/***/ }),\n\n/***/ 147:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar objects_1 = __webpack_require__(20);\r\nvar ClientConfig = (function () {\r\n    function ClientConfig(options) {\r\n        var _this = this;\r\n        this.maxSendSize = 32 * 1024;\r\n        this.maxDataSize = 28 * 1024;\r\n        this.sendLog_domain = '/';\r\n        this.sendLog_route = 'api/logger/send-log';\r\n        this.getSendLogUrl = function () { return _this.sendLog_domain + \"/\" + _this.sendLog_route; };\r\n        objects_1.assignPartial(this, options);\r\n    }\r\n    return ClientConfig;\r\n}());\r\nexports.ClientConfig = ClientConfig;\r\n\n\n/***/ }),\n\n/***/ 148:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction hashEmail_partial(email) {\r\n    var name = email\r\n        .substr(0, email.indexOf('@'))\r\n        .replace(/\\./g, '_')\r\n        .replace(/[^a-zA-Z0-9]/g, '');\r\n    var h = hash(email);\r\n    return name + h;\r\n}\r\nexports.hashEmail_partial = hashEmail_partial;\r\nfunction hash(text) {\r\n    return text.split('').reduce(function (hash, c) {\r\n        var code = c.charCodeAt(0);\r\n        hash = ((hash << 5) - hash) + code;\r\n        return hash | 0;\r\n    }, 0);\r\n}\r\nexports.hash = hash;\r\n\n\n/***/ }),\n\n/***/ 149:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar InstanceLoader = (function () {\r\n    function InstanceLoader(_load) {\r\n        var _this = this;\r\n        this._load = _load;\r\n        this._isLoading = false;\r\n        this._resolves = [];\r\n        this._getInstance = function () {\r\n            return new Promise(function (resolve, reject) {\r\n                if (_this._instance) {\r\n                    return resolve(_this._instance);\r\n                }\r\n                _this._resolves.push(resolve);\r\n                if (_this._isLoading) {\r\n                    return;\r\n                }\r\n                _this._isLoading = true;\r\n                console.log('InstanceLoader START');\r\n                _this._load().then(function (x) {\r\n                    console.log('InstanceLoader LOADED');\r\n                    _this._instance = x;\r\n                    var resolves = _this._resolves;\r\n                    _this._resolves = null;\r\n                    resolves.forEach(function (r) {\r\n                        setTimeout(function () {\r\n                            try {\r\n                                r(x);\r\n                            }\r\n                            catch (err) {\r\n                                console.error('InstanceLoader: A resolver threw an uncaught error', { err: err });\r\n                            }\r\n                        });\r\n                    });\r\n                    console.log('InstanceLoader DONE');\r\n                });\r\n            });\r\n        };\r\n    }\r\n    InstanceLoader.prototype.load = function () {\r\n        return this._getInstance();\r\n    };\r\n    Object.defineProperty(InstanceLoader.prototype, \"instance\", {\r\n        get: function () {\r\n            return this._getInstance();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return InstanceLoader;\r\n}());\r\nexports.InstanceLoader = InstanceLoader;\r\n\n\n/***/ }),\n\n/***/ 150:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n// maxLength = 64\r\nfunction randHex(length) {\r\n    if (length === void 0) { length = 8; }\r\n    return '0000000000000000000000000000000000000000000000000000000000000000'\r\n        .substr(0, length).replace(/0/g, function () { return (0 | Math.random() * 16).toString(16); });\r\n}\r\nexports.randHex = randHex;\r\n\n\n/***/ }),\n\n/***/ 151:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ScriptLoader = (function () {\r\n    function ScriptLoader(options) {\r\n        var _this = this;\r\n        this.options = options;\r\n        this.hasStartedLoading = false;\r\n        this.resolves = [];\r\n        this.resolveAll = function () {\r\n            var r = _this.resolves;\r\n            _this.resolves = [];\r\n            r.forEach(function (x) { return x(_this.instance); });\r\n        };\r\n    }\r\n    ScriptLoader.prototype.load = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (_this.instance) {\r\n                resolve(_this.instance);\r\n                return;\r\n            }\r\n            // Subscribe\r\n            _this.resolves.push(resolve);\r\n            if (_this.hasStartedLoading) {\r\n                return;\r\n            }\r\n            _this.hasStartedLoading = true;\r\n            console.log('ScriptLoader.load START');\r\n            if (_this.options.onBeforeLoadScript) {\r\n                _this.options.onBeforeLoadScript();\r\n            }\r\n            // Load Script\r\n            var d = document;\r\n            var s = 'script';\r\n            var id = _this.options.scriptElementId;\r\n            // Script already loaded\r\n            if (d.getElementById(id)) {\r\n                _this.resolveAll();\r\n                return;\r\n            }\r\n            var fjs = d.getElementsByTagName(s)[0];\r\n            var js = d.createElement(s);\r\n            js.id = id;\r\n            js.onload = function () {\r\n                if (_this.options.onAfterLoadScript) {\r\n                    _this.options.onAfterLoadScript();\r\n                }\r\n                _this.instance = _this.options.getInstance();\r\n                _this.resolveAll();\r\n            };\r\n            js.src = _this.options.url;\r\n            fjs.parentNode.insertBefore(js, fjs);\r\n        });\r\n    };\r\n    return ScriptLoader;\r\n}());\r\nexports.ScriptLoader = ScriptLoader;\r\n\n\n/***/ }),\n\n/***/ 152:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ids = [];\r\nvar CANCEL = -1;\r\nfunction setInterval_exponentialBackoff(callback, timeMs, options) {\r\n    if (timeMs === void 0) { timeMs = 1000; }\r\n    options = options || {};\r\n    var maxTime = options.maxTime;\r\n    var maxAttempts = options.maxAttempts || (!maxTime ? 5 : undefined);\r\n    var base = options.base || 2;\r\n    var id = ids.length;\r\n    ids.push(0);\r\n    var attempt = -1;\r\n    var call = function () {\r\n        callback();\r\n        if (ids[id] === CANCEL) {\r\n            return;\r\n        }\r\n        attempt++;\r\n        if (!maxAttempts || attempt < maxAttempts) {\r\n            var backoffTime = timeMs * Math.pow(base, attempt);\r\n            var actualTime = maxTime ? Math.min(maxTime, backoffTime) : backoffTime;\r\n            console.log('setInterval_exponentialBackoff', { actualTime: actualTime, backoffTime: backoffTime, timeMs: timeMs, maxTime: maxTime, maxAttempts: maxAttempts, base: base });\r\n            ids[id] = setTimeout(function () {\r\n                call();\r\n            }, actualTime);\r\n        }\r\n    };\r\n    call();\r\n    return id;\r\n}\r\nexports.setInterval_exponentialBackoff = setInterval_exponentialBackoff;\r\nfunction clearInterval_exponentialBackoff(id) {\r\n    clearTimeout(ids[id]);\r\n    ids[id] = CANCEL;\r\n}\r\nexports.clearInterval_exponentialBackoff = clearInterval_exponentialBackoff;\r\n\n\n/***/ }),\n\n/***/ 153:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n// https://gist.github.com/jed/982883\r\nexports.uuid = {\r\n    v4: function () { return ('' + 1e7 + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, function (a) { return (a ^ Math.random() * 16 >> a / 4).toString(16); }); }\r\n};\r\n\n\n/***/ }),\n\n/***/ 154:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar objects_1 = __webpack_require__(20);\r\nvar ClientConfig = (function () {\r\n    function ClientConfig(options) {\r\n        this.timePollSeconds = 1;\r\n        this.maxPollCount = 5;\r\n        this.timeToLiveSeconds = 60;\r\n        this.lookup_domain = '/';\r\n        this.lookup_route = 'api/lookup-lsc';\r\n        this.downloadBlob_domain = '/';\r\n        this.downloadBlob_route = 'blob';\r\n        // WARNING: Gzip is not working in the 4th step: Reading from .gzip blob with node and sending to client\r\n        // In addition, since using a function instead of proxy, gzip is done automatically by the function\r\n        // So it is not needed, and would only be useful to reduce storage size at the cost of increased processing\r\n        this.shouldGzipDownloadBlob = false;\r\n        objects_1.assignPartial(this, options);\r\n    }\r\n    ClientConfig.prototype.getLookupUrl = function (key) {\r\n        return this.lookup_domain + \"/\" + this.lookup_route + \"/\" + key.containerName + \"/\" + key.blobName;\r\n    };\r\n    ClientConfig.prototype.getDataDownloadUrl = function (key, lookup) {\r\n        return this.downloadBlob_domain + \"/\" + (this.downloadBlob_route ? this.downloadBlob_route + '/' : '') + key.containerName + \"/\" + this.getDataDownloadBlobName(key.blobName, lookup);\r\n    };\r\n    ClientConfig.prototype.getDataDownloadBlobName = function (blobName, lookup) {\r\n        // TODO: Test if works with .ext and switch to underscore if needed\r\n        return blobName + \"/\" + lookup.timeKey + (this.shouldGzipDownloadBlob ? '_gzip' : '');\r\n    };\r\n    return ClientConfig;\r\n}());\r\nexports.ClientConfig = ClientConfig;\r\n\n\n/***/ }),\n\n/***/ 155:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CheckoutStatus;\r\n(function (CheckoutStatus) {\r\n    // Nothing has happened yet\r\n    CheckoutStatus[\"NotStarted\"] = \"NotStarted\";\r\n    // The user has clicked the open button and is opening\r\n    CheckoutStatus[\"Started\"] = \"Started\";\r\n    // The form has called the opened callback\r\n    CheckoutStatus[\"Opened\"] = \"Opened\";\r\n    // The form has called the closed callback (Cancelled, Failed Verification?)\r\n    CheckoutStatus[\"Closed\"] = \"Closed\";\r\n    // // NOT SURE IF THESE CAN BE USED WITH STRIPE CHECKOUT\r\n    // // The user has submitted and the provider is verifying the information \r\n    // Verifing = 'Verifing',\r\n    // // The payment failed (Try Again)\r\n    // VerificationFailed = 'VerificationFailed',\r\n    // The payment was sent to the server\r\n    CheckoutStatus[\"Submitting\"] = \"Submitting\";\r\n    // The payment was received by the server (and Queued)\r\n    CheckoutStatus[\"Submitted\"] = \"Submitted\";\r\n    // The payment was rejected by the server (and not Queued)\r\n    CheckoutStatus[\"Submission_Failed\"] = \"Submission_Failed\";\r\n    // The Submission Requires User Login with the Stripe Email\r\n    CheckoutStatus[\"Submission_Rejected_LoginAndResubmit\"] = \"Submission_Rejected_LoginAndResubmit\";\r\n})(CheckoutStatus = exports.CheckoutStatus || (exports.CheckoutStatus = {}));\r\nvar PaymentStatus;\r\n(function (PaymentStatus) {\r\n    PaymentStatus[\"NotStarted\"] = \"NotStarted\";\r\n    PaymentStatus[\"Processing\"] = \"Processing\";\r\n    PaymentStatus[\"Paused\"] = \"Paused\";\r\n    PaymentStatus[\"PaymentSuceeded\"] = \"PaymentSuceeded\";\r\n    PaymentStatus[\"PaymentFailed\"] = \"PaymentFailed\";\r\n    // Payment Refunded or Disputed\r\n    PaymentStatus[\"PaymentWithdrawn\"] = \"PaymentWithdrawn\";\r\n})(PaymentStatus = exports.PaymentStatus || (exports.PaymentStatus = {}));\r\nvar SubscriptionStatus;\r\n(function (SubscriptionStatus) {\r\n    SubscriptionStatus[\"NotStarted\"] = \"NotStarted\";\r\n    SubscriptionStatus[\"Processing\"] = \"Processing\";\r\n    SubscriptionStatus[\"SubscriptionFailed\"] = \"SubscriptionFailed\";\r\n    SubscriptionStatus[\"Subscribed_TrialPeriod\"] = \"Subscribed_TrialPeriod\";\r\n    SubscriptionStatus[\"Subscribed_Normal\"] = \"Subscribed\";\r\n    // Payment Failed but Still Doing Automated Re-Attempts\r\n    SubscriptionStatus[\"Subscribed_PastDue\"] = \"Subscribed_PastDue\";\r\n    // Failed to Process (No Further Automated Attempts will be Made)\r\n    SubscriptionStatus[\"Unsubscribed_PastDue\"] = \"Unsubscribed_PastDue\";\r\n    SubscriptionStatus[\"Unsubscribed_Cancelled\"] = \"Unsubscribed_Cancelled\";\r\n})(SubscriptionStatus = exports.SubscriptionStatus || (exports.SubscriptionStatus = {}));\r\nvar DeliverableStatus;\r\n(function (DeliverableStatus) {\r\n    DeliverableStatus[\"NotStarted\"] = \"NotStarted\";\r\n    DeliverableStatus[\"Processing\"] = \"Processing\";\r\n    DeliverableStatus[\"Enabled\"] = \"Enabled\";\r\n    DeliverableStatus[\"Disabled\"] = \"Disabled\";\r\n})(DeliverableStatus = exports.DeliverableStatus || (exports.DeliverableStatus = {}));\r\nvar DeliverableStatus_ExecutionResult;\r\n(function (DeliverableStatus_ExecutionResult) {\r\n    DeliverableStatus_ExecutionResult[\"NotStarted\"] = \"NotStarted\";\r\n    DeliverableStatus_ExecutionResult[\"Processing\"] = \"Processing\";\r\n    DeliverableStatus_ExecutionResult[\"Enabled\"] = \"Enabled\";\r\n    DeliverableStatus_ExecutionResult[\"Disabled\"] = \"Disabled\";\r\n    // For example, something that is disabled but has already been delivered (so there is nothing further to do)\r\n    DeliverableStatus_ExecutionResult[\"Disabled_Impossible\"] = \"Disabled_Impossible\";\r\n    // Attempt to Activate Caused an Error in the Activation System\r\n    DeliverableStatus_ExecutionResult[\"Error\"] = \"Error\";\r\n})(DeliverableStatus_ExecutionResult = exports.DeliverableStatus_ExecutionResult || (exports.DeliverableStatus_ExecutionResult = {}));\r\n\n\n/***/ }),\n\n/***/ 156:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar observable_1 = __webpack_require__(76);\r\nvar checkout_types_1 = __webpack_require__(155);\r\nvar stripe_checkout_access_1 = __webpack_require__(157);\r\nvar objects_1 = __webpack_require__(20);\r\nvar uuid_1 = __webpack_require__(153);\r\nvar time_1 = __webpack_require__(152);\r\nvar StripeCheckoutProcess = (function () {\r\n    function StripeCheckoutProcess(config, runtime) {\r\n        var _this = this;\r\n        this.config = config;\r\n        this.runtime = runtime;\r\n        this.prepare = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var _this = this;\r\n            var clientCheckoutId, userToken, observer, lastResult, actualCheckoutOptions, updateResult, result, tokenCallback, open;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        console.log('StripeCheckoutProcess START');\r\n                        if (!this._access) {\r\n                            this._access = new stripe_checkout_access_1.StripeCheckoutAccess(this.config.stripePublishableKey);\r\n                        }\r\n                        console.log('StripeCheckoutProcess Prepare Stripe Access');\r\n                        return [4 /*yield*/, this._access.prepare()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        console.log('StripeCheckoutProcess Setup Result Observer');\r\n                        clientCheckoutId = uuid_1.uuid.v4();\r\n                        return [4 /*yield*/, this.config.getUserToken()];\r\n                    case 2:\r\n                        userToken = (_a.sent()).userToken;\r\n                        lastResult = {\r\n                            serverCheckoutId: null,\r\n                            clientCheckoutId: clientCheckoutId,\r\n                            checkoutStatus: checkout_types_1.CheckoutStatus.NotStarted,\r\n                            paymentStatus: checkout_types_1.PaymentStatus.NotStarted,\r\n                            subscriptionStatus: checkout_types_1.SubscriptionStatus.NotStarted,\r\n                            deliverableStatus: checkout_types_1.DeliverableStatus.NotStarted,\r\n                            deliverableStatus_executionResult: checkout_types_1.DeliverableStatus_ExecutionResult.NotStarted,\r\n                            timeChanged: Date.now(),\r\n                        };\r\n                        updateResult = function (result) {\r\n                            console.log('StripeCheckoutProcess updateResult', { result: result });\r\n                            if (result.clientCheckoutId && result.clientCheckoutId !== lastResult.clientCheckoutId) {\r\n                                throw 'StripeCheckoutProcess: Cannot change clientCheckoutId';\r\n                            }\r\n                            if (result.serverCheckoutId && result.serverCheckoutId !== lastResult.serverCheckoutId) {\r\n                                throw 'StripeCheckoutProcess: Cannot change serverCheckoutId';\r\n                            }\r\n                            objects_1.assignPartial(lastResult, result);\r\n                            lastResult.clientCheckoutId = clientCheckoutId;\r\n                            lastResult.timeChanged = Date.now();\r\n                            observer.next(lastResult);\r\n                            _this.runtime.logCheckoutEvent('ResultChange', lastResult);\r\n                        };\r\n                        result = new observable_1.Observable(function (o) {\r\n                            console.log('StripeCheckoutProcess Observable START');\r\n                            observer = o;\r\n                        });\r\n                        tokenCallback = function (token, args) { return __awaiter(_this, void 0, void 0, function () {\r\n                            var _this = this;\r\n                            var url, data, rSubmit, submitResult, updateUrl_1, updateIntervalId_1;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0:\r\n                                        updateResult({ checkoutStatus: checkout_types_1.CheckoutStatus.Submitting });\r\n                                        url = this.config.getSubmitTokenUrl();\r\n                                        data = {\r\n                                            userToken: userToken,\r\n                                            clientCheckoutId: clientCheckoutId,\r\n                                            token: token,\r\n                                            args: args,\r\n                                            checkoutOptions: actualCheckoutOptions,\r\n                                            metadata: this.config.getStripeChargeMetadata(actualCheckoutOptions),\r\n                                            statementDescriptor: this.config.getStripeChargeStatementDescriptor(actualCheckoutOptions),\r\n                                            statementDescriptor_subscription: this.config.getStripeChargeStatementDescriptor_subscription(actualCheckoutOptions),\r\n                                        };\r\n                                        return [4 /*yield*/, fetch(url, { method: 'POST', body: JSON.stringify(data) })];\r\n                                    case 1:\r\n                                        rSubmit = _a.sent();\r\n                                        return [4 /*yield*/, rSubmit.json()];\r\n                                    case 2:\r\n                                        submitResult = _a.sent();\r\n                                        updateResult(submitResult);\r\n                                        // Poll for Deliverable Status\r\n                                        if (submitResult.checkoutStatus === checkout_types_1.CheckoutStatus.Submitted) {\r\n                                            updateUrl_1 = this.config.getCheckoutStatusUrl(data.token.email, submitResult.serverCheckoutId);\r\n                                            updateIntervalId_1 = time_1.setInterval_exponentialBackoff(function () { return __awaiter(_this, void 0, void 0, function () {\r\n                                                var rStatus, submitResult;\r\n                                                return __generator(this, function (_a) {\r\n                                                    switch (_a.label) {\r\n                                                        case 0: return [4 /*yield*/, fetch(updateUrl_1)];\r\n                                                        case 1:\r\n                                                            rStatus = _a.sent();\r\n                                                            return [4 /*yield*/, rSubmit.json()];\r\n                                                        case 2:\r\n                                                            submitResult = _a.sent();\r\n                                                            updateResult(submitResult);\r\n                                                            if (submitResult.checkoutStatus === checkout_types_1.CheckoutStatus.Submission_Rejected_LoginAndResubmit) {\r\n                                                                time_1.clearInterval_exponentialBackoff(updateIntervalId_1);\r\n                                                                // TODO: Require Login and then resubmit with same payment token\r\n                                                                throw 'Require Login - Not Implemented';\r\n                                                                // return;\r\n                                                            }\r\n                                                            if (submitResult.deliverableStatus_executionResult > checkout_types_1.DeliverableStatus_ExecutionResult.Processing) {\r\n                                                                time_1.clearInterval_exponentialBackoff(updateIntervalId_1);\r\n                                                            }\r\n                                                            return [2 /*return*/];\r\n                                                    }\r\n                                                });\r\n                                            }); });\r\n                                        }\r\n                                        return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        }); };\r\n                        open = function (options) {\r\n                            var o = {};\r\n                            objects_1.assignPartial(o, _this.config.checkoutOptions);\r\n                            objects_1.assignPartial(o, options);\r\n                            actualCheckoutOptions = o;\r\n                            // TODO: Note Verification Step?\r\n                            // TODO: Handle Payment Failed\r\n                            _this._access.open({\r\n                                tokenCallback: tokenCallback,\r\n                                recommendedOptions: {\r\n                                    amount: o.product.amountCents,\r\n                                    name: o.business.name,\r\n                                    image: o.business.imageUrl,\r\n                                    description: o.product.description,\r\n                                    zipCode: o.requirements.requireZipCode,\r\n                                    billingAddress: o.requirements.requireBillingAddress,\r\n                                },\r\n                                additionalOptions: {\r\n                                    email: o.user.email,\r\n                                    allowRememberMe: o.experience.allowRememberMe,\r\n                                    opened: function () {\r\n                                        updateResult({ checkoutStatus: checkout_types_1.CheckoutStatus.Opened });\r\n                                    },\r\n                                    closed: function () {\r\n                                        if (lastResult.checkoutStatus < checkout_types_1.CheckoutStatus.Submitting) {\r\n                                            updateResult({ checkoutStatus: checkout_types_1.CheckoutStatus.Closed });\r\n                                        }\r\n                                    },\r\n                                },\r\n                            });\r\n                            _this.runtime.logCheckoutEvent('Open', { clientCheckoutId: clientCheckoutId, openOptions: options, configOptions: _this.config.checkoutOptions });\r\n                            updateResult({ checkoutStatus: checkout_types_1.CheckoutStatus.Started });\r\n                        };\r\n                        console.log('StripeCheckoutProcess DONE');\r\n                        return [2 /*return*/, {\r\n                                open: open,\r\n                                result: result\r\n                            }];\r\n                }\r\n            });\r\n        }); };\r\n    }\r\n    StripeCheckoutProcess.prototype.getResult = function (checkoutId) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    return StripeCheckoutProcess;\r\n}());\r\nexports.StripeCheckoutProcess = StripeCheckoutProcess;\r\n\n\n/***/ }),\n\n/***/ 157:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar script_loader_1 = __webpack_require__(151);\r\nvar instance_loader_1 = __webpack_require__(149);\r\nvar scriptLoader = new script_loader_1.ScriptLoader({\r\n    url: 'https://checkout.stripe.com/checkout.js',\r\n    scriptElementId: 'StripeCheckout',\r\n    getInstance: function () {\r\n        return StripeCheckout;\r\n    }\r\n});\r\nvar StripeCheckoutAccess = (function () {\r\n    function StripeCheckoutAccess(stripePublishableKey) {\r\n        var _this = this;\r\n        this.stripePublishableKey = stripePublishableKey;\r\n        this.handlerLoader = new instance_loader_1.InstanceLoader(function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var s, handler;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        console.log('StripeCheckoutProcess.handlerLoader START');\r\n                        return [4 /*yield*/, scriptLoader.load()];\r\n                    case 1:\r\n                        s = _a.sent();\r\n                        console.log('StripeCheckoutProcess.handlerLoader LOADED');\r\n                        return [4 /*yield*/, s.configure({ key: this.stripePublishableKey })];\r\n                    case 2:\r\n                        handler = _a.sent();\r\n                        console.log('StripeCheckoutProcess.handlerLoader END');\r\n                        return [2 /*return*/, handler];\r\n                }\r\n            });\r\n        }); });\r\n        this.prepare = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = this;\r\n                        return [4 /*yield*/, this.handlerLoader.instance];\r\n                    case 1:\r\n                        _a._handler = _b.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n        // This must be a direct call to handler.open (It cannot be async or will get popup-blocked)\r\n        this.open = function (options) {\r\n            var handler = _this._handler;\r\n            if (!handler) {\r\n                throw 'The Stripe Checkout Handler must be loaded before Open is Clicked';\r\n            }\r\n            handler.open(__assign({ token: options.tokenCallback }, options.recommendedOptions, options.additionalOptions));\r\n        };\r\n    }\r\n    return StripeCheckoutAccess;\r\n}());\r\nexports.StripeCheckoutAccess = StripeCheckoutAccess;\r\n\n\n/***/ }),\n\n/***/ 158:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n            t[p] = s[p];\r\n    }\r\n    return t;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar objects_1 = __webpack_require__(20);\r\nvar hash_1 = __webpack_require__(148);\r\nvar ClientConfig = (function () {\r\n    function ClientConfig(options, getUserToken) {\r\n        this.options = options;\r\n        this.getUserToken = getUserToken;\r\n        this.domain = '/';\r\n        this.submit_route = 'api/stripe-checkout-submit';\r\n        this.status_route_partial = 'api/stripe-checkout-status';\r\n        objects_1.assignPartial(this, options);\r\n    }\r\n    Object.defineProperty(ClientConfig.prototype, \"status_route\", {\r\n        get: function () { return \"status_route_partial/{emailHash}/{serverCheckoutId}\"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ClientConfig.prototype.getSubmitTokenUrl = function () {\r\n        return this.domain + \"/\" + this.submit_route;\r\n    };\r\n    ClientConfig.prototype.getCheckoutStatusUrl = function (email, serverCheckoutId) {\r\n        return this.domain + \"/\" + this.status_route + \"/\" + this.getEmailHash(email) + \"/\" + serverCheckoutId;\r\n    };\r\n    ClientConfig.prototype.getEmailHash = function (email) {\r\n        return hash_1.hashEmail_partial(email);\r\n    };\r\n    ClientConfig.prototype.getStripeChargeMetadata = function (options) {\r\n        return __assign({}, options.user, options.product);\r\n    };\r\n    ClientConfig.prototype.getStripeChargeStatementDescriptor = function (options) {\r\n        return (options.business.statementDescriptor + \" \" + options.product.statementDescriptor).substr(0, 22);\r\n    };\r\n    ClientConfig.prototype.getStripeChargeStatementDescriptor_subscription = function (options) {\r\n        return (options.business.statementDescriptor + \" \" + options.product.statementDescriptor_subscription).substr(0, 22);\r\n    };\r\n    return ClientConfig;\r\n}());\r\nexports.ClientConfig = ClientConfig;\r\n\n\n/***/ }),\n\n/***/ 20:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\n// export function objectToValueIterator<T>(obj: { [key: string]: T }): { [key: string]: T } & Iterable<T> {\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n//     const o = obj as any;\r\n//     o[Symbol.iterator] = () => {\r\n//         let keys = Object.getOwnPropertyNames(obj);\r\n//         let i = 0;\r\n//         return {\r\n//             next: () => {\r\n//                 const key = keys[i++];\r\n//                 const value = obj[key];\r\n//                 return {\r\n//                     value,\r\n//                     done: i >= keys.length\r\n//                 };\r\n//             }\r\n//         };\r\n//     };\r\n//     return o;\r\n// }\r\n// export function objectToKeyValueIterator<T>(obj: { [key: string]: T }): { [key: string]: T } & Iterable<{ key: string, value: T }> {\r\n//     const o = obj as any;\r\n//     o[Symbol.iterator] = () => {\r\n//         let keys = Object.getOwnPropertyNames(obj);\r\n//         let i = 0;\r\n//         return {\r\n//             next: () => {\r\n//                 const key = keys[i++];\r\n//                 const value = obj[key];\r\n//                 return {\r\n//                     value: { key, value },\r\n//                     done: i >= keys.length\r\n//                 };\r\n//             }\r\n//         };\r\n//     };\r\n//     return o;\r\n// }\r\nfunction group(items, getKey) {\r\n    var g = items.reduce(function (o, x) {\r\n        var k = getKey(x);\r\n        var group = o[k] = o[k] || { items: [] };\r\n        group.items.push(x);\r\n        return o;\r\n    }, {});\r\n    //return objectToValueIterator(g);\r\n    return g;\r\n}\r\nexports.group = group;\r\nfunction groupToArray(items, getKey) {\r\n    var g = group(items, getKey);\r\n    return Object.getOwnPropertyNames(g).map(function (k) { return g[k].items; });\r\n}\r\nexports.groupToArray = groupToArray;\r\nfunction assignPartial(t, p) {\r\n    for (var k in p) {\r\n        if (p.hasOwnProperty(k)) {\r\n            t[k] = p[k];\r\n        }\r\n    }\r\n    return t;\r\n}\r\nexports.assignPartial = assignPartial;\r\n\n\n/***/ }),\n\n/***/ 75:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar client_1 = __webpack_require__(138);\r\nexports.clientConfig_lookupLsc = client_1.clientConfig;\r\nvar logger_client_1 = __webpack_require__(137);\r\nexports.clientConfig_logger = logger_client_1.clientConfig;\r\nvar stripe_client_1 = __webpack_require__(139);\r\nexports.clientConfig_stripe = stripe_client_1.clientConfig;\r\n\n\n/***/ }),\n\n/***/ 76:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Observable_1 = __webpack_require__(348);\r\nexports.Observable = Observable_1.Observable;\r\n\n\n/***/ })\n\n},[144]);\n\n\n// WEBPACK FOOTER //\n// bundle.js","import * as RX from 'reactxp';\r\nimport { LookupLscTest } from \"./components/lookup-lsc-test\";\r\nimport { LoggerTest } from \"./components/logger-test\";\r\nimport { StripeTest } from \"./components/stripe-test\";\r\n// import { Store } from './store/store';\r\n// import { handleRoute } from \"./routes\";\r\n// import { Root } from \"./components/page/root\";\r\n\r\n// const store = Store;\r\n\r\n// handleRoute();\r\n\r\n// <Root store={store} />\r\nexport const App = () => (\r\n    <RX.View>\r\n        <RX.Text>TEST</RX.Text>\r\n        {/*<LookupLscTest />*/}\r\n        {/*<LoggerTest />*/}\r\n        <StripeTest />\r\n    </RX.View>\r\n);\n\n\n// WEBPACK FOOTER //\n// ./src/app/app.tsx","import { ClientConfig } from \"@told/stack/src/core/logger/config/client-config\";\r\n\r\nexport const clientConfig = new ClientConfig({\r\n    timeBatchSeconds: 10,\r\n    sendLog_domain: 'https://told-stack-demo.azureedge.net',\r\n    // sendLog_domain: 'http://localhost:7071',\r\n    sendLog_route: 'api/logger/send-log',\r\n});\n\n\n// WEBPACK FOOTER //\n// ./../config/src/core/logger-client.ts","import { ClientConfig } from \"@told/stack/src/data-patterns/lookup-lsc/src-config/client-config\";\r\n\r\nexport const clientConfig = new ClientConfig({\r\n    // lookup_domain: 'https://told-stack-demo.azurewebsites.net',\r\n    // downloadBlob_domain: 'https://told-stack-demo.azurewebsites.net',\r\n    lookup_domain: 'https://told-stack-demo.azureedge.net',\r\n    downloadBlob_domain: 'https://told-stack-demo.azureedge.net',\r\n\r\n    lookup_route: 'api/lookup-lsc',\r\n    downloadBlob_route: 'api/lookup-lsc-download'\r\n});\n\n\n// WEBPACK FOOTER //\n// ./../config/src/lookup-lsc/client.ts","import { ClientConfig } from \"@told/stack/src/payment/stripe/config/client-config\";\r\n\r\nexport const clientConfig = new ClientConfig({\r\n    stripePublishableKey: 'pk_stripe_publishable_key_1234',\r\n    checkoutOptions: {\r\n        business: {\r\n            name: 'Told Software',\r\n            imageUrl: 'https://toldstackdemo.blob.core.windows.net/images/ToldLogo128.png',\r\n            statementDescriptor: 'ToldSoft',\r\n        },\r\n        requirements: {\r\n            requireZipCode: true,\r\n            requireBillingAddress: true,\r\n        },\r\n        experience: {\r\n            allowRememberMe: true\r\n        },\r\n    },\r\n}, async () => null);\n\n\n// WEBPACK FOOTER //\n// ./../config/src/payment/stripe-client.ts","import * as RX from 'reactxp';\r\nimport { stripeCheckoutProcess } from \"../server-access/stripe\";\r\nimport { CheckoutOptions, CheckoutResult, CheckoutProcessOpen, CheckoutStatus } from \"@told/stack/src/payment/common/checkout-types\";\r\n\r\nexport class StripeTest extends RX.Component<{}, {\r\n    hasStarted: boolean,\r\n    isReady: boolean,\r\n    result: CheckoutResult,\r\n    open: CheckoutProcessOpen\r\n}>{\r\n\r\n    prepare = async () => {\r\n        const r = await stripeCheckoutProcess.prepare();\r\n        this.setState({\r\n            isReady: true,\r\n            open: r.open,\r\n        } as any);\r\n\r\n        r.result.subscribe(x => {\r\n            console.log('Result Changed', { result: x });\r\n\r\n            this.setState({\r\n                result: x\r\n            } as any);\r\n        });\r\n    }\r\n\r\n    open = () => {\r\n        if (this.state.open) {\r\n            this.state.open({\r\n                product: {\r\n                    productCode: 'test-product-01',\r\n                    amountCents: 10000,\r\n                    monthlyAmountCents: 1000,\r\n                    description: 'Cool Thing to Buy',\r\n                    statementDescriptor: 'prod 01',\r\n                    statementDescriptor_subscription: 'prod 01 sub',\r\n                    subscriptionPlanId_noPrice: 'prod01',\r\n                    subscriptionPlanName: 'prod01',\r\n                },\r\n                user: { email: 'me@home.com' },\r\n            });\r\n        }\r\n    }\r\n\r\n    render() {\r\n\r\n        if (!this.state.hasStarted) {\r\n            this.setState({\r\n                hasStarted: true\r\n            } as any);\r\n\r\n            setTimeout(this.prepare);\r\n        }\r\n\r\n        return (\r\n            <RX.View>\r\n                <RX.Button\r\n                    disabled={!this.state.isReady}\r\n                    onPress={this.open}\r\n                >Checkout</RX.Button>\r\n                {this.state.result && (\r\n                    <RX.View>\r\n                        <RX.Text>checkoutId: {this.state.result.clientCheckoutId}</RX.Text>\r\n                        <RX.Text>checkoutStatus: {this.state.result.checkoutStatus}</RX.Text>\r\n                        <RX.Text>paymentStatus: {this.state.result.paymentStatus}</RX.Text>\r\n                        <RX.Text>subscriptionStatus: {this.state.result.subscriptionStatus}</RX.Text>\r\n                        <RX.Text>deliverableStatus: {this.state.result.deliverableStatus}</RX.Text>\r\n                        <RX.Text>deliverableStatus_executionResult: {this.state.result.deliverableStatus_executionResult}</RX.Text>\r\n                        {/* <RX.Text>timeChanged: {this.state.result.}</RX.Text> */}\r\n                    </RX.View>\r\n                )}\r\n            </RX.View>\r\n        );\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/components/stripe-test.tsx","import { Logger } from '@told/stack/src/core/logger/client/logger';\r\nimport { SessionId } from '@told/stack/src/core/account/session-id';\r\nimport { clientConfig_logger as clientConfig } from '../../config';\r\nimport { DeviceInfoAccess, DeviceInfo } from \"../utils/deviceInfo\";\r\n\r\nconst session = new SessionId();\r\nconst deviceInfoAccess = new DeviceInfoAccess();\r\nlet lastDeviceInfo: Partial<DeviceInfo>;\r\n\r\nexport const logger = new Logger(clientConfig,\r\n    () => ({ sessionId: session.sessionId, userId: session.userId }),\r\n    () => ({ version: 'v1.0', path: 'a/b/c' }),\r\n    () => ({ deviceInfo: lastDeviceInfo }),\r\n);\r\n\r\nexport async function subscribeLoggerToDeviceInfoChanges() {\r\n    lastDeviceInfo = await deviceInfoAccess.getDeviceInfo();\r\n    deviceInfoAccess.getDeviceInfo_observable().subscribe(x => {\r\n        lastDeviceInfo = x;\r\n        console.log('DeviceInfo Changed', { lastDeviceInfo });\r\n        logger.log('DeviceInfo', 'Changed', lastDeviceInfo);\r\n    });\r\n}\r\n\r\nsubscribeLoggerToDeviceInfoChanges();\n\n\n// WEBPACK FOOTER //\n// ./src/app/server-access/logger.ts","import { StripeCheckoutProcess } from '@told/stack/src/payment/stripe/client/checkout-process';\r\nimport { clientConfig_stripe as clientConfig } from '../../config';\r\nimport { logger } from \"./logger\";\r\n\r\nexport const stripeCheckoutProcess = new StripeCheckoutProcess(clientConfig, {\r\n    logCheckoutEvent: (event, data) => {\r\n        logger.major('Stripe', event, data);\r\n    }\r\n});\n\n\n// WEBPACK FOOTER //\n// ./src/app/server-access/stripe.ts","import * as RX from 'reactxp';\r\nimport { Observable, Observer } from \"@told/stack/src/core/utils/observable\";\r\nimport { assignPartial } from \"@told/stack/src/core/utils/objects\";\r\n\r\nexport interface DeviceInfo {\r\n    platform: string;\r\n\r\n    isHighPixelDensityScreen: boolean;\r\n    windowSize: RX.Types.LayoutInfo;\r\n    pixelRatio: number;\r\n    maxContentSizeMultiplier: number;\r\n\r\n    isScreenReaderEnabled: boolean;\r\n\r\n    initialUrl: string;\r\n\r\n    timeZoneOffset: number;\r\n    isLocationAvailable: boolean;\r\n\r\n    web_userAgent: string;\r\n    web_platform: string;\r\n    web_language: string;\r\n    web_locationHref: string;\r\n\r\n    // Events\r\n    lastActivationState: string;\r\n    lastDeepLinkRequest: string;\r\n    lastConnectivity: boolean;\r\n    lastContentSizeMultiplier: number;\r\n    lastIsNavigatingWithKeyboard: boolean;\r\n    lastUserPresence: boolean;\r\n}\r\n\r\nexport class DeviceInfoAccess {\r\n\r\n    private deviceInfo: DeviceInfo;\r\n\r\n    private _isSubscribed: boolean;\r\n    private _observable: Observable<Partial<DeviceInfo>>;\r\n    private _observer: Observer<Partial<DeviceInfo>>;\r\n\r\n    getDeviceInfo = async (forceRefresh = false): Promise<DeviceInfo> => {\r\n        await this.init(forceRefresh);\r\n        return this.deviceInfo;\r\n    }\r\n\r\n    getDeviceInfo_observable(): Observable<Partial<DeviceInfo>> {\r\n        if (!this._observable) {\r\n            this._observable = new Observable(observer => {\r\n                this._observer = observer;\r\n            });\r\n            this.subscribe();\r\n        }\r\n        return this._observable;\r\n    }\r\n\r\n    private trigger(change: Partial<DeviceInfo>) {\r\n        console.log('DeviceInfoAccess.trigger', { change });\r\n\r\n        assignPartial(this.deviceInfo, change);\r\n\r\n        if (this._observer) {\r\n            this._observer.next(change);\r\n        }\r\n    }\r\n\r\n    private init = async (forceRefresh = false) => {\r\n        if (!forceRefresh && this.deviceInfo) { return; }\r\n\r\n        this.deviceInfo = {} as any;\r\n        this.deviceInfo.platform = RX.Platform.getType();\r\n\r\n        this.deviceInfo.isHighPixelDensityScreen = RX.UserInterface.isHighPixelDensityScreen();\r\n        this.deviceInfo.windowSize = RX.UserInterface.measureWindow();\r\n        this.deviceInfo.pixelRatio = RX.UserInterface.getPixelRatio();\r\n        this.deviceInfo.lastContentSizeMultiplier = await RX.UserInterface.getContentSizeMultiplier();\r\n        this.deviceInfo.maxContentSizeMultiplier = await RX.UserInterface.getMaxContentSizeMultiplier();\r\n\r\n        this.deviceInfo.isScreenReaderEnabled = RX.Accessibility.isScreenReaderEnabled();\r\n\r\n        this.deviceInfo.initialUrl = await RX.Linking.getInitialUrl();\r\n\r\n        this.deviceInfo.timeZoneOffset = new Date().getTimezoneOffset();\r\n        this.deviceInfo.isLocationAvailable = RX.Location.isAvailable();\r\n\r\n        if (this.deviceInfo.platform === 'web') {\r\n            this.deviceInfo.web_userAgent = window.navigator.userAgent;\r\n            this.deviceInfo.web_platform = window.navigator.platform;\r\n            this.deviceInfo.web_language = window.navigator.language;\r\n            this.deviceInfo.web_locationHref = window.location.href;\r\n        }\r\n\r\n        this.deviceInfo.lastActivationState = RX.Types.AppActivationState[RX.App.getActivationState()];\r\n    }\r\n\r\n    private subscribe() {\r\n        if (!this._isSubscribed) { return; }\r\n        this._isSubscribed = true;\r\n\r\n        RX.App.activationStateChangedEvent.subscribe((state) => {\r\n            this.trigger({\r\n                lastActivationState: RX.Types.AppActivationState[state]\r\n            });\r\n        });\r\n\r\n        RX.Linking.deepLinkRequestEvent.subscribe((e) => {\r\n            this.trigger({\r\n                lastDeepLinkRequest: e\r\n            });\r\n        });\r\n\r\n        RX.Network.connectivityChangedEvent.subscribe((e) => {\r\n            this.trigger({\r\n                lastConnectivity: e\r\n            });\r\n        });\r\n\r\n        RX.UserInterface.contentSizeMultiplierChangedEvent.subscribe((e) => {\r\n            this.trigger({\r\n                lastContentSizeMultiplier: e\r\n            });\r\n        });\r\n\r\n        RX.UserInterface.keyboardNavigationEvent.subscribe((e) => {\r\n            this.trigger({\r\n                lastIsNavigatingWithKeyboard: e\r\n            });\r\n        });\r\n\r\n        RX.UserPresence.userPresenceChangedEvent.subscribe((e) => {\r\n            this.trigger({\r\n                lastUserPresence: e\r\n            });\r\n        });\r\n    }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/utils/deviceInfo.ts","import * as RX from 'reactxp';\r\nimport { App } from './app/app';\r\n\r\nRX.App.initialize(true, true);\r\nRX.UserInterface.setMainView(<App />);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.tsx","import { randHex } from \"../utils/rand\";\r\n\r\nexport class SessionId {\r\n    public sessionId = createSessonId();\r\n\r\n    constructor(public userId: string = null) {\r\n        if (!this.userId) {\r\n            this.userId = createUserId_anonymous();\r\n        }\r\n    }\r\n\r\n    setActualUserId(userId: string) {\r\n        if (this.userId.indexOf('anon-') !== 0) { throw 'setActualUserId is only valid if the current userId is anonymous'; }\r\n        this.userId = userId;\r\n    }\r\n}\r\n\r\nexport function createSessonId() {\r\n    const iso = (new Date()).toISOString();\r\n    const rand = randHex(16);\r\n    return `s_${iso}_${rand}`;\r\n}\r\n\r\nexport function createUserId_anonymous() {\r\n    const iso = (new Date()).toISOString();\r\n    const rand = randHex(16);\r\n    return `u_anon_${iso}_${rand}`;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/account/session-id.ts","import { ClientConfig } from \"../config/client-config\";\r\nimport { UserInfo, AppContextInfo, DeviceInfo, LogItem } from \"../config/types\";\r\n\r\nexport class Logger {\r\n\r\n    private _hasSentSessionInfo = false;\r\n    private _startTime = Date.now();\r\n    private _lastSendTime = Date.now();\r\n\r\n    private _items: LogItem[] = [];\r\n\r\n    private _timeoutId: any = 0;\r\n\r\n    constructor(\r\n        private config: ClientConfig,\r\n        private getUserInfo: () => UserInfo,\r\n        private getContextInfo: () => AppContextInfo,\r\n        private getDeviceInfo: () => DeviceInfo,\r\n    ) {\r\n        setTimeout(() => this.sendSessionInfo(), 250);\r\n    }\r\n\r\n    private sendSessionInfo() {\r\n        if (!this._hasSentSessionInfo) {\r\n            this._hasSentSessionInfo = true;\r\n\r\n            this._items.push({\r\n                isError: null,\r\n                category: 'Session',\r\n                event: 'Info',\r\n                data: null,\r\n\r\n                time: Date.now(),\r\n                runTime: Date.now() - this._startTime,\r\n                startTime: this._startTime,\r\n\r\n                userInfo: this.getUserInfo(),\r\n                appContextInfo: this.getContextInfo(),\r\n                deviceInfo: this.getDeviceInfo(),\r\n            });\r\n\r\n            this.sendBatch(true);\r\n        }\r\n    }\r\n\r\n    error(category: string, event: string, data: Object, shouldSendImmediately = false) {\r\n        this.log(category, event, data, true, true);\r\n    }\r\n\r\n    major(category: string, event: string, data: Object, shouldSendImmediately = false) {\r\n        this.log(category, event, data, true);\r\n    }\r\n\r\n    log(category: string, event: string, data: Object, shouldSendImmediately = false, isError = false) {\r\n\r\n        const d: LogItem = {\r\n            isError: isError ? true : undefined,\r\n            category,\r\n            event,\r\n            data,\r\n\r\n            time: Date.now(),\r\n            runTime: Date.now() - this._startTime,\r\n            startTime: this._startTime,\r\n\r\n            userInfo: this.getUserInfo(),\r\n            appContextInfo: this.getContextInfo(),\r\n            deviceInfo: undefined,\r\n        };\r\n\r\n        this._items.push(d);\r\n        this.sendBatch(shouldSendImmediately);\r\n\r\n    }\r\n\r\n    private sendBatch = (shouldSendImmediately = false) => {\r\n        if (!shouldSendImmediately\r\n            && Date.now() - this._lastSendTime < this.config.timeBatchSeconds * 1000\r\n        ) {\r\n            this.scheduleSend();\r\n            return;\r\n        }\r\n\r\n        const items = this._items;\r\n        this._items = [];\r\n        this.sendNow(items);\r\n    }\r\n\r\n    private async sendNow(items: LogItem[]) {\r\n        this._lastSendTime = Date.now();\r\n        if (!items || !items.length) { return; }\r\n\r\n        items.forEach(x => {\r\n            if (!x.data) { return; }\r\n\r\n            let d = x.data;\r\n            if (typeof x.data !== 'string') {\r\n                d = JSON.stringify(x.data);\r\n            }\r\n\r\n            if (d.length > this.config.maxDataSize) {\r\n                x.data = 'truncated:' + d.substr(0, this.config.maxDataSize - 16) + '...';\r\n            }\r\n        });\r\n\r\n        let sentItems = items;\r\n        let body = JSON.stringify(items);\r\n\r\n        // If body is too large, break it up\r\n        let hasSentAll = true;\r\n        let count = items.length;\r\n        while (body.length > this.config.maxSendSize) {\r\n            if (count === 1) {\r\n                // Truncate Message Data\r\n                sentItems.forEach(x => x.data = 'truncated:' + JSON.stringify(x.data).substr(0, this.config.maxDataSize) + '...');\r\n                break;\r\n            }\r\n\r\n            hasSentAll = false;\r\n            count = Math.floor(count / 2);\r\n            sentItems = items.slice(0, count);\r\n            body = JSON.stringify(sentItems);\r\n        }\r\n\r\n        if (!hasSentAll) {\r\n            this._items.push(...items.slice(count));\r\n        }\r\n\r\n        const r = await fetch(this.config.getSendLogUrl(), { method: 'POST', body });\r\n\r\n        // If send failure, add items back to end of queue to try again\r\n        if (!r.ok) {\r\n            sentItems.forEach(x => x._attempts++);\r\n            this._items.push(...sentItems.filter(x => x._attempts < this.config.maxItemSendAttempts));\r\n        }\r\n\r\n        // Immediately Send Again to Send the rest of the batch\r\n        if (!hasSentAll) {\r\n            setTimeout(() => this.sendBatch(true));\r\n        }\r\n    }\r\n\r\n    private scheduleSend = () => {\r\n        const timeUsed = Date.now() - this._lastSendTime;\r\n        const timeRemaining = this.config.timeBatchSeconds - timeUsed;\r\n        clearTimeout(this._timeoutId);\r\n        this._timeoutId = setTimeout(this.sendBatch, timeRemaining);\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/logger/client/logger.ts","import { assignPartial } from \"../../utils/objects\";\r\n\r\nexport interface ClientConfigOptions {\r\n    timeBatchSeconds: number;\r\n\r\n    sendLog_domain: string;\r\n    sendLog_route: string;\r\n}\r\n\r\nexport class ClientConfig {\r\n    timeBatchSeconds: 60;\r\n    maxItemSendAttempts: 3;\r\n    maxSendSize = 32 * 1024;\r\n    maxDataSize = 28 * 1024;\r\n\r\n    sendLog_domain = '/';\r\n    sendLog_route = 'api/logger/send-log';\r\n\r\n    constructor(options: Partial<ClientConfigOptions>) {\r\n        assignPartial(this, options);\r\n    }\r\n\r\n    getSendLogUrl = () => `${this.sendLog_domain}/${this.sendLog_route}`;\r\n\r\n\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/logger/config/client-config.ts","\r\nexport function hashEmail_partial(email: string) {\r\n    const name = email\r\n        .substr(0, email.indexOf('@'))\r\n        .replace(/\\./g, '_')\r\n        .replace(/[^a-zA-Z0-9]/g, '')\r\n        ;\r\n\r\n    const h = hash(email);\r\n\r\n    return name + h;\r\n}\r\n\r\nexport function hash(text: string): number {\r\n    return text.split('').reduce((hash, c) => {\r\n        const code = c.charCodeAt(0);\r\n        hash = ((hash << 5) - hash) + code;\r\n        return hash | 0;\r\n    }, 0);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/hash.ts","import { delay } from \"./delay\";\r\n\r\nexport class InstanceLoader<T> {\r\n    private _isLoading = false;\r\n    private _instance: T;\r\n    private _resolves: ((value: T) => void)[] = [];\r\n\r\n    constructor(private _load: () => Promise<T>) {\r\n\r\n    }\r\n\r\n    load() {\r\n        return this._getInstance();\r\n    }\r\n\r\n    get instance() {\r\n        return this._getInstance();\r\n    }\r\n\r\n    private _getInstance = () => {\r\n        return new Promise<T>((resolve, reject) => {\r\n            if (this._instance) { return resolve(this._instance); }\r\n\r\n            this._resolves.push(resolve);\r\n\r\n            if (this._isLoading) { return; }\r\n            this._isLoading = true;\r\n\r\n            console.log('InstanceLoader START');\r\n\r\n            this._load().then(x => {\r\n                console.log('InstanceLoader LOADED');\r\n\r\n                this._instance = x;\r\n\r\n                const resolves = this._resolves;\r\n                this._resolves = null;\r\n\r\n                resolves.forEach(r => {\r\n                    setTimeout(() => {\r\n                        try {\r\n                            r(x);\r\n                        } catch (err) {\r\n                            console.error('InstanceLoader: A resolver threw an uncaught error', { err });\r\n                        }\r\n                    });\r\n                });\r\n\r\n                console.log('InstanceLoader DONE');\r\n            });\r\n\r\n        });\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/instance-loader.ts","\r\n// maxLength = 64\r\nexport function randHex(length = 8) {\r\n    return '0000000000000000000000000000000000000000000000000000000000000000'\r\n        .substr(0, length).replace(/0/g, () => (0 | Math.random() * 16).toString(16));\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/rand.ts","\r\nexport class ScriptLoader<T> {\r\n    private hasStartedLoading = false;\r\n    private instance: T;\r\n\r\n    private resolves: ((value: T) => void)[] = [];\r\n\r\n    constructor(private options: { url: string, scriptElementId: string, getInstance: () => T, onBeforeLoadScript?: () => void, onAfterLoadScript?: () => void }) {\r\n\r\n    }\r\n\r\n    private resolveAll = () => {\r\n        const r = this.resolves;\r\n        this.resolves = [];\r\n        r.forEach(x => x(this.instance));\r\n    };\r\n\r\n    load(): Promise<T> {\r\n        return new Promise<T>((resolve, reject) => {\r\n            if (this.instance) {\r\n                resolve(this.instance);\r\n                return;\r\n            }\r\n\r\n            // Subscribe\r\n            this.resolves.push(resolve);\r\n\r\n            if (this.hasStartedLoading) {\r\n                return;\r\n            }\r\n\r\n            this.hasStartedLoading = true;\r\n            console.log('ScriptLoader.load START');\r\n\r\n            if (this.options.onBeforeLoadScript) { this.options.onBeforeLoadScript(); }\r\n\r\n            // Load Script\r\n            const d = document;\r\n            const s = 'script';\r\n            const id = this.options.scriptElementId;\r\n\r\n            // Script already loaded\r\n            if (d.getElementById(id)) {\r\n                this.resolveAll();\r\n                return;\r\n            }\r\n\r\n            const fjs = d.getElementsByTagName(s)[0];\r\n            const js = d.createElement(s) as HTMLScriptElement;\r\n            js.id = id;\r\n\r\n            js.onload = () => {\r\n                if (this.options.onAfterLoadScript) { this.options.onAfterLoadScript(); }\r\n                this.instance = this.options.getInstance();\r\n                this.resolveAll();\r\n            }\r\n\r\n            js.src = this.options.url;\r\n            fjs.parentNode.insertBefore(js, fjs);\r\n        });\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/script-loader.ts","const ids: any[] = [];\r\nconst CANCEL = -1;\r\n\r\nexport function setInterval_exponentialBackoff(callback: () => void, timeMs = 1000, options?: {\r\n    maxAttempts?: number,\r\n    base?: number,\r\n    maxTime?: number,\r\n}): number {\r\n\r\n    options = options || {};\r\n    const maxTime = options.maxTime;\r\n    const maxAttempts = options.maxAttempts || (!maxTime ? 5 : undefined);\r\n    const base = options.base || 2;\r\n\r\n    const id = ids.length;\r\n    ids.push(0);\r\n\r\n    let attempt = -1;\r\n\r\n    const call = () => {\r\n        callback();\r\n        if (ids[id] === CANCEL) { return; }\r\n\r\n        attempt++;\r\n\r\n        if (!maxAttempts || attempt < maxAttempts) {\r\n            const backoffTime = timeMs * Math.pow(base, attempt);\r\n            const actualTime = maxTime ? Math.min(maxTime, backoffTime) : backoffTime;\r\n            console.log('setInterval_exponentialBackoff', { actualTime, backoffTime, timeMs, maxTime, maxAttempts, base });\r\n\r\n            ids[id] = setTimeout(() => {\r\n                call();\r\n            }, actualTime);\r\n        }\r\n    };\r\n\r\n    call();\r\n    return id;\r\n}\r\n\r\nexport function clearInterval_exponentialBackoff(id: number) {\r\n    clearTimeout(ids[id]);\r\n    ids[id] = CANCEL;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/time.ts","// https://gist.github.com/jed/982883\r\nexport const uuid = {\r\n    v4: () => ('' + 1e7 + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (a: any) => (a ^ Math.random() * 16 >> a / 4).toString(16))\r\n};\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/uuid.ts","import { HttpFunctionRequest } from \"../../../core/types/functions\";\r\nimport { assignPartial } from \"../../../core/utils/objects\";\r\n\r\nexport interface DataKey {\r\n    containerName: string;\r\n    blobName: string;\r\n}\r\n\r\nexport interface LookupData {\r\n    timeKey: string\r\n}\r\n\r\nexport interface LookupResponse {\r\n    timeKey?: string;\r\n    error?: string;\r\n    timeToExpireSeconds: number;\r\n}\r\n\r\nexport interface ClientConfigType {\r\n    timeToLiveSeconds: number;\r\n    timePollSeconds: number;\r\n    maxPollCount: number;\r\n\r\n    getLookupUrl(key: DataKey): string;\r\n    getDataDownloadUrl(key: DataKey, lookup: LookupData): string;\r\n}\r\n\r\nexport interface ClientConfigOptions {\r\n    timeToLiveSeconds: number;\r\n    timePollSeconds: number;\r\n    maxPollCount: number;\r\n    lookup_domain: string;\r\n    lookup_route: string;\r\n    downloadBlob_domain: string;\r\n    downloadBlob_route: string;\r\n}\r\n\r\nexport class ClientConfig implements ClientConfigType, ClientConfigOptions {\r\n    timePollSeconds = 1;\r\n    maxPollCount = 5;\r\n    timeToLiveSeconds = 60;\r\n\r\n    lookup_domain = '/';\r\n    lookup_route = 'api/lookup-lsc';\r\n    downloadBlob_domain = '/';\r\n    downloadBlob_route = 'blob';\r\n\r\n    // WARNING: Gzip is not working in the 4th step: Reading from .gzip blob with node and sending to client\r\n    // In addition, since using a function instead of proxy, gzip is done automatically by the function\r\n    // So it is not needed, and would only be useful to reduce storage size at the cost of increased processing\r\n    shouldGzipDownloadBlob = false;\r\n\r\n    constructor(options?: Partial<ClientConfigOptions>) {\r\n        assignPartial(this, options);\r\n    }\r\n\r\n    getLookupUrl(key: DataKey): string {\r\n        return `${this.lookup_domain}/${this.lookup_route}/${key.containerName}/${key.blobName}`;\r\n    }\r\n\r\n    getDataDownloadUrl(key: DataKey, lookup: LookupData): string {\r\n        return `${this.downloadBlob_domain}/${this.downloadBlob_route ? this.downloadBlob_route + '/' : ''}${key.containerName}/${this.getDataDownloadBlobName(key.blobName, lookup)}`;\r\n    }\r\n\r\n    getDataDownloadBlobName(blobName: string, lookup: LookupData) {\r\n        // TODO: Test if works with .ext and switch to underscore if needed\r\n        return `${blobName}/${lookup.timeKey}${this.shouldGzipDownloadBlob ? '_gzip' : ''}`;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/data-patterns/lookup-lsc/src-config/client-config.ts","import { Observable } from \"../../core/utils/observable\";\r\n\r\nexport interface CheckoutBusinessOptions {\r\n    name: string;\r\n    imageUrl: string;\r\n    statementDescriptor: string;\r\n}\r\n\r\nexport interface CheckoutProductOptions {\r\n    productCode: string;\r\n\r\n    amountCents: number;\r\n    monthlyAmountCents: number;\r\n\r\n    description: string;\r\n    subscriptionPlanName: string;\r\n    subscriptionPlanId_noPrice: string;\r\n\r\n    statementDescriptor: string;\r\n    statementDescriptor_subscription: string;\r\n}\r\n\r\nexport interface CheckoutUserOptions {\r\n    email?: string;\r\n}\r\n\r\nexport interface CheckoutRequirementOptions {\r\n    requireZipCode: boolean;\r\n    requireBillingAddress: boolean;\r\n}\r\n\r\nexport interface CheckoutExperienceOptions {\r\n    allowRememberMe: boolean;\r\n}\r\n\r\nexport interface CheckoutOptions {\r\n    product: CheckoutProductOptions;\r\n    user: CheckoutUserOptions;\r\n\r\n    business: CheckoutBusinessOptions;\r\n    requirements: CheckoutRequirementOptions;\r\n    experience: CheckoutExperienceOptions;\r\n}\r\n\r\nexport enum CheckoutStatus {\r\n    // Nothing has happened yet\r\n    NotStarted = 'NotStarted',\r\n    // The user has clicked the open button and is opening\r\n    Started = 'Started',\r\n    // The form has called the opened callback\r\n    Opened = 'Opened',\r\n    // The form has called the closed callback (Cancelled, Failed Verification?)\r\n    Closed = 'Closed',\r\n\r\n    // // NOT SURE IF THESE CAN BE USED WITH STRIPE CHECKOUT\r\n    // // The user has submitted and the provider is verifying the information \r\n    // Verifing = 'Verifing',\r\n    // // The payment failed (Try Again)\r\n    // VerificationFailed = 'VerificationFailed',\r\n\r\n    // The payment was sent to the server\r\n    Submitting = 'Submitting',\r\n\r\n    // The payment was received by the server (and Queued)\r\n    Submitted = 'Submitted',\r\n\r\n    // The payment was rejected by the server (and not Queued)\r\n    Submission_Failed = 'Submission_Failed',\r\n\r\n    // The Submission Requires User Login with the Stripe Email\r\n    Submission_Rejected_LoginAndResubmit = 'Submission_Rejected_LoginAndResubmit',\r\n}\r\n\r\nexport enum PaymentStatus {\r\n    NotStarted = 'NotStarted',\r\n    Processing = 'Processing',\r\n    Paused = 'Paused',\r\n    PaymentSuceeded = 'PaymentSuceeded',\r\n    PaymentFailed = 'PaymentFailed',\r\n\r\n    // Payment Refunded or Disputed\r\n    PaymentWithdrawn = 'PaymentWithdrawn',\r\n}\r\n\r\nexport enum SubscriptionStatus {\r\n    NotStarted = 'NotStarted',\r\n    Processing = 'Processing',\r\n    SubscriptionFailed = 'SubscriptionFailed',\r\n    \r\n    Subscribed_TrialPeriod = 'Subscribed_TrialPeriod',\r\n    Subscribed_Normal = 'Subscribed',\r\n\r\n    // Payment Failed but Still Doing Automated Re-Attempts\r\n    Subscribed_PastDue = 'Subscribed_PastDue',\r\n    // Failed to Process (No Further Automated Attempts will be Made)\r\n    Unsubscribed_PastDue = 'Unsubscribed_PastDue',\r\n    Unsubscribed_Cancelled = 'Unsubscribed_Cancelled',\r\n}\r\n\r\nexport enum DeliverableStatus {\r\n    NotStarted = 'NotStarted',\r\n    Processing = 'Processing',\r\n    Enabled = 'Enabled',\r\n    Disabled = 'Disabled',\r\n}\r\n\r\nexport enum DeliverableStatus_ExecutionResult {\r\n    NotStarted = 'NotStarted',\r\n    Processing = 'Processing',\r\n    Enabled = 'Enabled',\r\n    Disabled = 'Disabled',\r\n\r\n    // For example, something that is disabled but has already been delivered (so there is nothing further to do)\r\n    Disabled_Impossible = 'Disabled_Impossible',\r\n\r\n    // Attempt to Activate Caused an Error in the Activation System\r\n    Error = 'Error',\r\n}\r\n\r\n\r\nexport type CheckoutProcessOpen = (options: Partial<CheckoutOptions>) => void;\r\n\r\nexport interface CheckoutProcessPrepareResult {\r\n    open: CheckoutProcessOpen;\r\n    result: Observable<CheckoutResult_Client>;\r\n}\r\n\r\nexport interface CheckoutResult {\r\n    serverCheckoutId: string;\r\n    clientCheckoutId: string;\r\n\r\n    checkoutStatus: CheckoutStatus;\r\n    paymentStatus: PaymentStatus;\r\n    subscriptionStatus: SubscriptionStatus;\r\n    deliverableStatus: DeliverableStatus;\r\n    deliverableStatus_executionResult: DeliverableStatus_ExecutionResult;\r\n\r\n    error?: string;\r\n}\r\n\r\nexport interface CheckoutResult_Client extends CheckoutResult {\r\n    timeChanged: number;\r\n}\r\n\r\nexport interface CheckoutProcess {\r\n    // Prepare must be called before user can Click Button (Button should be disabled until ready)\r\n    prepare(): Promise<CheckoutProcessPrepareResult>;\r\n\r\n    // User Clicks Button (direct call only)\r\n    // open(options: CheckoutOptions): Observable<CheckoutResult>;\r\n\r\n    // Check Results on a Previously Submitted Process\r\n    getResult(checkoutId: string): Observable<CheckoutResult_Client>;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/payment/common/checkout-types.ts","import { Observable, Observer } from \"../../../core/utils/observable\";\r\nimport { CheckoutProcess, CheckoutOptions, CheckoutProcessPrepareResult, CheckoutStatus, DeliverableStatus_ExecutionResult, PaymentStatus, DeliverableStatus, CheckoutResult_Client, SubscriptionStatus } from '../../common/checkout-types';\r\nimport { ClientConfig, ClientRuntimeOptions, ClientConfigOptions, CheckoutSubmitResult, CheckoutStatusResult, CheckoutSubmitRequestBody } from \"../config/client-config\";\r\nimport { StripeCheckoutAccess, StripeToken, StripeTokenArgs } from \"./stripe-checkout-access\";\r\nimport { assignPartial } from \"../../../core/utils/objects\";\r\nimport { uuid } from \"../../../core/utils/uuid\";\r\nimport { setInterval_exponentialBackoff, clearInterval_exponentialBackoff } from \"../../../core/utils/time\";\r\n\r\nexport class StripeCheckoutProcess implements CheckoutProcess {\r\n\r\n    private _access: StripeCheckoutAccess;\r\n\r\n    constructor(private config: ClientConfigOptions, private runtime: ClientRuntimeOptions) {\r\n\r\n    }\r\n\r\n    prepare = async (): Promise<CheckoutProcessPrepareResult> => {\r\n        console.log('StripeCheckoutProcess START');\r\n\r\n        if (!this._access) {\r\n            this._access = new StripeCheckoutAccess(this.config.stripePublishableKey);\r\n        }\r\n\r\n        console.log('StripeCheckoutProcess Prepare Stripe Access');\r\n        await this._access.prepare();\r\n\r\n        console.log('StripeCheckoutProcess Setup Result Observer');\r\n        const clientCheckoutId = uuid.v4();\r\n        const { userToken } = await this.config.getUserToken();\r\n\r\n        let observer: Observer<CheckoutResult_Client>;\r\n        let lastResult: CheckoutResult_Client = {\r\n            serverCheckoutId: null,\r\n            clientCheckoutId,\r\n            checkoutStatus: CheckoutStatus.NotStarted,\r\n            paymentStatus: PaymentStatus.NotStarted,\r\n            subscriptionStatus: SubscriptionStatus.NotStarted,\r\n            deliverableStatus: DeliverableStatus.NotStarted,\r\n            deliverableStatus_executionResult: DeliverableStatus_ExecutionResult.NotStarted,\r\n            timeChanged: Date.now(),\r\n        };\r\n\r\n        let actualCheckoutOptions: CheckoutOptions;\r\n\r\n        const updateResult = (result: Partial<CheckoutResult_Client>) => {\r\n            console.log('StripeCheckoutProcess updateResult', { result });\r\n\r\n            if (result.clientCheckoutId && result.clientCheckoutId !== lastResult.clientCheckoutId) {\r\n                throw 'StripeCheckoutProcess: Cannot change clientCheckoutId';\r\n            }\r\n\r\n            if (result.serverCheckoutId && result.serverCheckoutId !== lastResult.serverCheckoutId) {\r\n                throw 'StripeCheckoutProcess: Cannot change serverCheckoutId';\r\n            }\r\n\r\n            assignPartial(lastResult, result);\r\n            lastResult.clientCheckoutId = clientCheckoutId;\r\n            lastResult.timeChanged = Date.now();\r\n            observer.next(lastResult);\r\n\r\n            this.runtime.logCheckoutEvent('ResultChange', lastResult);\r\n        }\r\n\r\n        const result = new Observable<CheckoutResult_Client>(o => {\r\n            console.log('StripeCheckoutProcess Observable START');\r\n            observer = o;\r\n        });\r\n\r\n        const tokenCallback = async (token: StripeToken, args: StripeTokenArgs) => {\r\n\r\n            updateResult({ checkoutStatus: CheckoutStatus.Submitting });\r\n\r\n            const url = this.config.getSubmitTokenUrl();\r\n            const data: CheckoutSubmitRequestBody = {\r\n                userToken,\r\n                clientCheckoutId,\r\n                token,\r\n                args,\r\n                checkoutOptions: actualCheckoutOptions,\r\n                metadata: this.config.getStripeChargeMetadata(actualCheckoutOptions),\r\n                statementDescriptor: this.config.getStripeChargeStatementDescriptor(actualCheckoutOptions),\r\n                statementDescriptor_subscription: this.config.getStripeChargeStatementDescriptor_subscription(actualCheckoutOptions),\r\n            };\r\n\r\n            const rSubmit = await fetch(url, { method: 'POST', body: JSON.stringify(data) });\r\n            const submitResult = await rSubmit.json() as CheckoutSubmitResult;\r\n\r\n            updateResult(submitResult);\r\n\r\n            // Poll for Deliverable Status\r\n            if (submitResult.checkoutStatus === CheckoutStatus.Submitted) {\r\n\r\n                const updateUrl = this.config.getCheckoutStatusUrl(data.token.email, submitResult.serverCheckoutId);\r\n\r\n                const updateIntervalId = setInterval_exponentialBackoff(async () => {\r\n                    const rStatus = await fetch(updateUrl);\r\n                    const submitResult = await rSubmit.json() as CheckoutStatusResult;\r\n\r\n                    updateResult(submitResult);\r\n\r\n                    if (submitResult.checkoutStatus === CheckoutStatus.Submission_Rejected_LoginAndResubmit) {\r\n                        clearInterval_exponentialBackoff(updateIntervalId);\r\n                        // TODO: Require Login and then resubmit with same payment token\r\n                        throw 'Require Login - Not Implemented';\r\n\r\n                        // return;\r\n                    }\r\n\r\n                    if (submitResult.deliverableStatus_executionResult > DeliverableStatus_ExecutionResult.Processing) {\r\n                        clearInterval_exponentialBackoff(updateIntervalId);\r\n                    }\r\n\r\n                });\r\n            }\r\n\r\n        };\r\n\r\n        const open = (options: Partial<CheckoutOptions>): void => {\r\n\r\n            const o = {} as CheckoutOptions;\r\n            assignPartial(o, this.config.checkoutOptions);\r\n            assignPartial(o, options);\r\n\r\n            actualCheckoutOptions = o;\r\n\r\n            // TODO: Note Verification Step?\r\n            // TODO: Handle Payment Failed\r\n\r\n            this._access.open({\r\n                tokenCallback,\r\n                recommendedOptions: {\r\n                    amount: o.product.amountCents,\r\n                    name: o.business.name,\r\n                    image: o.business.imageUrl,\r\n                    description: o.product.description,\r\n                    zipCode: o.requirements.requireZipCode,\r\n                    billingAddress: o.requirements.requireBillingAddress,\r\n                },\r\n                additionalOptions: {\r\n                    email: o.user.email,\r\n                    allowRememberMe: o.experience.allowRememberMe,\r\n                    opened: () => {\r\n                        updateResult({ checkoutStatus: CheckoutStatus.Opened });\r\n                    },\r\n                    closed: () => {\r\n                        if (lastResult.checkoutStatus < CheckoutStatus.Submitting) {\r\n                            updateResult({ checkoutStatus: CheckoutStatus.Closed });\r\n                        }\r\n                    },\r\n                },\r\n            });\r\n\r\n            this.runtime.logCheckoutEvent('Open', { clientCheckoutId, openOptions: options, configOptions: this.config.checkoutOptions });\r\n            updateResult({ checkoutStatus: CheckoutStatus.Started });\r\n        };\r\n\r\n        console.log('StripeCheckoutProcess DONE');\r\n\r\n        return {\r\n            open,\r\n            result\r\n        };\r\n    }\r\n\r\n    getResult(checkoutId: string): Observable<CheckoutResult_Client> {\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/payment/stripe/client/checkout-process.ts","import { ScriptLoader } from \"../../../core/utils/script-loader\";\r\nimport { InstanceLoader } from \"../../../core/utils/instance-loader\";\r\n\r\n// https://stripe.com/docs/checkout#integration-custom\r\n\r\nexport interface StripeCheckout {\r\n    configure(options: StripeConfigureOptions & StripeRequiredOptions & StripeRecommendedOptions & StripeAdditionalOptions): StripeCheckoutHandler;\r\n}\r\n\r\nexport interface StripeCheckoutHandler {\r\n    open(options: StripeRequiredOptions & StripeRecommendedOptions & StripeAdditionalOptions): void;\r\n}\r\n\r\nexport interface StripeConfigureOptions {\r\n    // Stripe Publishable Key\r\n    key: string;\r\n}\r\n\r\nexport interface StripeRequiredOptions {\r\n    // Callback\r\n    token?: (token: StripeToken, args: StripeTokenArgs) => void;\r\n}\r\n\r\n// export export interface TokenResult {\r\n//     token: StripeToken;\r\n//     args: StripeTokenArgs;\r\n// }\r\n\r\nexport interface StripeRecommendedOptions {\r\n    // Business Image\r\n    image?: string;\r\n    // Business Name\r\n    name?: string;\r\n    // Product Description\r\n    description?: string;\r\n    // Amount in Cents\r\n    amount?: number;\r\n    // Language\r\n    locale?: 'auto' | string;\r\n    // Zip Code Required\r\n    zipCode?: boolean;\r\n    // Billing Address Required\r\n    billingAddress?: boolean;\r\n}\r\n\r\nexport interface StripeAdditionalOptions {\r\n    // Currency Code (Default: USD)\r\n    currency?: string;\r\n    // Payment Button Label\r\n    panelLabel?: string;\r\n    // Shipping Addres Required\r\n    shippingAddress?: boolean;\r\n    // Prefilled Email\r\n    email?: string;\r\n    // Start Button Text  (Simple Only)\r\n    // label?: string;\r\n    // Remember Me Allowed\r\n    allowRememberMe?: boolean;\r\n    // Bitcoin Payment Allowed\r\n    bitcoin?: boolean;\r\n    // Opened Callback\r\n    opened?: () => void;\r\n    // Closed Callback\r\n    closed?: () => void;\r\n}\r\n\r\nexport interface StripeToken {\r\n    id: string;\r\n    email: string;\r\n}\r\n\r\nexport interface StripeTokenArgs {\r\n\r\n    // Billing name and address\r\n    billing_name?: string;\r\n    billing_address_country?: string;\r\n    billing_address_zip?: string;\r\n    billing_address_state?: string;\r\n    billing_address_line1?: string;\r\n    billing_address_city?: string;\r\n    billing_address_country_code?: string;\r\n\r\n    // Shipping name and address\r\n    shipping_name?: string;\r\n    shipping_address_country?: string;\r\n    shipping_address_zip?: string;\r\n    shipping_address_state?: string;\r\n    shipping_address_line1?: string;\r\n    shipping_address_city?: string;\r\n    shipping_address_country_code?: string;\r\n}\r\n\r\n\r\ndeclare var StripeCheckout: StripeCheckout;\r\n\r\nconst scriptLoader = new ScriptLoader({\r\n    url: 'https://checkout.stripe.com/checkout.js',\r\n    scriptElementId: 'StripeCheckout',\r\n    getInstance: () => {\r\n        return StripeCheckout;\r\n    }\r\n});\r\n\r\nexport class StripeCheckoutAccess {\r\n\r\n    _handler: StripeCheckoutHandler;\r\n\r\n    constructor(private stripePublishableKey: string) { }\r\n\r\n    private handlerLoader = new InstanceLoader(async () => {\r\n        console.log('StripeCheckoutProcess.handlerLoader START');\r\n        const s = await scriptLoader.load();\r\n        console.log('StripeCheckoutProcess.handlerLoader LOADED');\r\n        const handler = await s.configure({ key: this.stripePublishableKey });\r\n        console.log('StripeCheckoutProcess.handlerLoader END');\r\n        return handler;\r\n    });\r\n\r\n    prepare = async () => {\r\n        this._handler = await this.handlerLoader.instance;\r\n        return;\r\n    }\r\n\r\n    // This must be a direct call to handler.open (It cannot be async or will get popup-blocked)\r\n    open = (options: {\r\n        tokenCallback: (token: StripeToken, args: StripeTokenArgs) => void,\r\n        recommendedOptions?: StripeRecommendedOptions,\r\n        additionalOptions?: StripeAdditionalOptions\r\n    }) => {\r\n        const handler = this._handler;\r\n\r\n        if (!handler) {\r\n            throw 'The Stripe Checkout Handler must be loaded before Open is Clicked';\r\n        }\r\n\r\n        handler.open({\r\n            token: options.tokenCallback,\r\n            ...options.recommendedOptions,\r\n            ...options.additionalOptions,\r\n        });\r\n    };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/payment/stripe/client/stripe-checkout-access.ts","import { CheckoutOptions, CheckoutResult } from \"../../common/checkout-types\";\r\nimport { ClientConfig as LoggerClientConfig } from \"../../../core/logger/config/client-config\";\r\nimport { assignPartial } from \"../../../core/utils/objects\";\r\nimport { StripeToken, StripeTokenArgs } from \"../client/stripe-checkout-access\";\r\nimport { hashEmail_partial } from \"../../../core/utils/hash\";\r\n\r\nexport type CheckoutEventType = 'Open' | 'ResultChange';\r\n\r\nexport interface ClientRuntimeOptions {\r\n    logCheckoutEvent: (type: CheckoutEventType, data: Object) => void;\r\n}\r\n\r\nexport interface ClientConfigOptions {\r\n    stripePublishableKey: string;\r\n    checkoutOptions: Partial<CheckoutOptions>;\r\n    getUserToken: () => Promise<{ userToken: string }>;\r\n\r\n    getSubmitTokenUrl(): string;\r\n    getCheckoutStatusUrl(email: string, serverCheckoutId: string): string;\r\n    getStripeChargeMetadata(options: CheckoutOptions): { [key: string]: string | number };\r\n    getStripeChargeStatementDescriptor(options: CheckoutOptions): string;\r\n    getStripeChargeStatementDescriptor_subscription(options: CheckoutOptions): string;\r\n}\r\n\r\nexport interface CheckoutSubmitRequestBody {\r\n    userToken: string;\r\n    clientCheckoutId: string;\r\n    token: StripeToken;\r\n    args: StripeTokenArgs;\r\n    checkoutOptions: CheckoutOptions;\r\n    metadata: { [key: string]: string | number }\r\n    statementDescriptor: string;\r\n    statementDescriptor_subscription: string;\r\n}\r\n\r\nexport interface CheckoutSubmitResult extends Partial<CheckoutResult> {\r\n}\r\n\r\nexport interface CheckoutStatusResult extends Partial<CheckoutResult> {\r\n}\r\n\r\nexport class ClientConfig implements ClientConfigOptions {\r\n    stripePublishableKey: string;\r\n    checkoutOptions: CheckoutOptions;\r\n\r\n    domain = '/';\r\n    submit_route = 'api/stripe-checkout-submit';\r\n    status_route_partial = 'api/stripe-checkout-status';\r\n    get status_route() { return `status_route_partial/{emailHash}/{serverCheckoutId}`; }\r\n\r\n    constructor(\r\n        private options: Partial<ClientConfigOptions>,\r\n        public getUserToken: () => Promise<{ userToken: string }>,\r\n\r\n    ) {\r\n        assignPartial(this, options);\r\n    }\r\n\r\n    getSubmitTokenUrl(): string {\r\n        return `${this.domain}/${this.submit_route}`;\r\n    }\r\n\r\n    getCheckoutStatusUrl(email: string, serverCheckoutId: string): string {\r\n        return `${this.domain}/${this.status_route}/${this.getEmailHash(email)}/${serverCheckoutId}`;\r\n    }\r\n\r\n    getEmailHash(email: string): string {\r\n        return hashEmail_partial(email);\r\n    }\r\n\r\n    getStripeChargeMetadata(options: CheckoutOptions): { [key: string]: string | number } {\r\n        return {\r\n            ...options.user,\r\n            ...options.product,\r\n        };\r\n    }\r\n\r\n    getStripeChargeStatementDescriptor(options: CheckoutOptions): string {\r\n        return `${options.business.statementDescriptor} ${options.product.statementDescriptor}`.substr(0, 22);\r\n    }\r\n\r\n\r\n    getStripeChargeStatementDescriptor_subscription(options: CheckoutOptions): string {\r\n        return `${options.business.statementDescriptor} ${options.product.statementDescriptor_subscription}`.substr(0, 22);\r\n    }\r\n\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/payment/stripe/config/client-config.ts","\r\n// export function objectToValueIterator<T>(obj: { [key: string]: T }): { [key: string]: T } & Iterable<T> {\r\n\r\n//     const o = obj as any;\r\n//     o[Symbol.iterator] = () => {\r\n//         let keys = Object.getOwnPropertyNames(obj);\r\n//         let i = 0;\r\n\r\n//         return {\r\n//             next: () => {\r\n//                 const key = keys[i++];\r\n//                 const value = obj[key];\r\n//                 return {\r\n//                     value,\r\n//                     done: i >= keys.length\r\n//                 };\r\n//             }\r\n//         };\r\n//     };\r\n\r\n//     return o;\r\n// }\r\n\r\n\r\n// export function objectToKeyValueIterator<T>(obj: { [key: string]: T }): { [key: string]: T } & Iterable<{ key: string, value: T }> {\r\n\r\n//     const o = obj as any;\r\n//     o[Symbol.iterator] = () => {\r\n//         let keys = Object.getOwnPropertyNames(obj);\r\n//         let i = 0;\r\n\r\n//         return {\r\n//             next: () => {\r\n//                 const key = keys[i++];\r\n//                 const value = obj[key];\r\n//                 return {\r\n//                     value: { key, value },\r\n//                     done: i >= keys.length\r\n//                 };\r\n//             }\r\n//         };\r\n//     };\r\n\r\n//     return o;\r\n// }\r\n\r\nexport function group<T>(items: T[], getKey: (x: T) => string) {\r\n    const g = items.reduce((o, x) => {\r\n        const k = getKey(x);\r\n        const group = o[k] = o[k] || { items: [] };\r\n        group.items.push(x);\r\n        return o;\r\n    }, {} as any) as { [key: string]: { items: T[] } };\r\n\r\n    //return objectToValueIterator(g);\r\n    return g;\r\n}\r\n\r\nexport function groupToArray<T>(items: T[], getKey: (x: T) => string) {\r\n    const g = group(items, getKey);\r\n    return Object.getOwnPropertyNames(g).map(k => g[k].items);\r\n}\r\n\r\n\r\nexport function assignPartial<T>(t: T, p: Partial<T>): T {\r\n    for (let k in p) {\r\n        if (p.hasOwnProperty(k)) {\r\n            t[k] = p[k];\r\n        }\r\n    }\r\n\r\n    return t;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/objects.ts","export { clientConfig as clientConfig_lookupLsc } from '../../config/src/lookup-lsc/client';\nexport { clientConfig as clientConfig_logger } from '../../config/src/core/logger-client';\nexport { clientConfig as clientConfig_stripe } from '../../config/src/payment/stripe-client';\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.ts","import { Observable } from 'rxjs/Observable';\r\nimport { Subscriber } from 'rxjs/Subscriber';\r\n\r\nexport { Observable };\r\nexport type Observer<T> = Subscriber<T>;\r\n\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/observable.ts"],"sourceRoot":""}