{"version":3,"sources":["webpack:///bundle.js","webpack:///./src/app/app.tsx","webpack:///./config/config-lookup-lsc.ts","webpack:///./src/app/components/lookup-lsc-test.tsx","webpack:///./src/app/server-access/lookup-lsc-data-access.ts","webpack:///./src/index.tsx","webpack:///./../../../told-stack-npm/src/core/utils/time.ts","webpack:///./../../../told-stack-npm/src/data-patterns/lookup-lsc/src-client/data-access.ts","webpack:///./../../../told-stack-npm/src/data-patterns/lookup-lsc/src-config/client-config.ts"],"names":["webpackJsonp","157","module","exports","__webpack_require__","Object","defineProperty","value","RX","lookup_lsc_test_1","App","createElement","View","Text","LookupLscTest","158","client_config_1","clientConfig","ClientConfig","lookup_domain","downloadBlob_domain","lookup_route","downloadBlob_route","159","__extends","this","extendStatics","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","verb","n","v","op","f","TypeError","_","y","t","call","label","ops","pop","trys","length","push","g","sent","throw","return","Symbol","iterator","lookup_lsc_data_access_1","_super","_this","arguments","notifyUpdate","data","obj","_a","setState","hasStarted","isWaitingForUpdate","download","lookupLscDataAccess","readAndUpdate","blobName","containerName","shouldAutoRefresh","render","state","setTimeout","JSON","stringify","Component","160","data_access_1","config_lookup_lsc_1","DataAccess","161","app_1","initialize","UserInterface","setMainView","162","setInterval_exponentialBackoff","callback","timeMs","options","maxTime","maxAttempts","undefined","base","id","ids","attempt","CANCEL","backoffTime","Math","pow","actualTime","min","console","log","clearInterval_exponentialBackoff","clearTimeout","163","readAppBlob","config","key","readAppBlob_inner","rLookup","lookup","node_fetch_1","default","getLookupUrl","json","error","readAppBlobData","r","getDataDownloadUrl","readAppBlobAndUpdate","refreshTimeoutId_1","cancel_1","lookupLoop_1","_b","intervalId","time_1","rLookup_update","lookup_update","data_1","timeKey","timeToExpireSeconds","timePollSeconds","maxPollCount","timeToLiveSeconds","read","164","shouldGzipDownloadBlob","assign","getDataDownloadBlobName","409"],"mappings":"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","file":"bundle.js","sourcesContent":["webpackJsonp([0],{\n\n/***/ 157:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RX = __webpack_require__(54);\r\nvar lookup_lsc_test_1 = __webpack_require__(159);\r\n// import { Store } from './store/store';\r\n// import { handleRoute } from \"./routes\";\r\n// import { Root } from \"./components/page/root\";\r\n// const store = Store;\r\n// handleRoute();\r\n// <Root store={store} />\r\nexports.App = function () { return (RX.createElement(RX.View, null,\r\n    RX.createElement(RX.Text, null, \"TEST\"),\r\n    RX.createElement(lookup_lsc_test_1.LookupLscTest, null))); };\r\n\n\n/***/ }),\n\n/***/ 158:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar client_config_1 = __webpack_require__(164);\r\nexports.clientConfig = new client_config_1.ClientConfig({\r\n    // lookup_domain: 'https://told-stack-demo.azurewebsites.net',\r\n    // downloadBlob_domain: 'https://told-stack-demo.azurewebsites.net',\r\n    lookup_domain: 'https://told-stack-demo.azureedge.net',\r\n    downloadBlob_domain: 'https://told-stack-demo.azureedge.net',\r\n    lookup_route: 'api/lookup-lsc',\r\n    downloadBlob_route: 'api/lookup-lsc-download'\r\n});\r\n\n\n/***/ }),\n\n/***/ 159:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RX = __webpack_require__(54);\r\nvar lookup_lsc_data_access_1 = __webpack_require__(160);\r\nvar LookupLscTest = (function (_super) {\r\n    __extends(LookupLscTest, _super);\r\n    function LookupLscTest() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.notifyUpdate = function (data) { return __awaiter(_this, void 0, void 0, function () {\r\n            var obj;\r\n            return __generator(this, function (_a) {\r\n                obj = data;\r\n                this.setState({\r\n                    hasStarted: true,\r\n                    isWaitingForUpdate: false,\r\n                    obj: obj\r\n                });\r\n                return [2 /*return*/];\r\n            });\r\n        }); };\r\n        _this.download = function () { return __awaiter(_this, void 0, void 0, function () {\r\n            var obj;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, lookup_lsc_data_access_1.lookupLscDataAccess.readAndUpdate({ blobName: 'test', containerName: 'test' }, { shouldAutoRefresh: true }, this.notifyUpdate)];\r\n                    case 1:\r\n                        obj = _a.sent();\r\n                        this.setState({\r\n                            hasStarted: true,\r\n                            isWaitingForUpdate: true,\r\n                            obj: obj\r\n                        });\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        }); };\r\n        return _this;\r\n    }\r\n    LookupLscTest.prototype.render = function () {\r\n        if (!this.state.hasStarted) {\r\n            this.setState({\r\n                hasStarted: true,\r\n            });\r\n            setTimeout(this.download);\r\n        }\r\n        return (RX.createElement(RX.View, null,\r\n            RX.createElement(RX.Text, null,\r\n                \"hasStarted: \",\r\n                '' + this.state.hasStarted),\r\n            RX.createElement(RX.Text, null,\r\n                \"isWaitingForUpdate: \",\r\n                '' + this.state.isWaitingForUpdate),\r\n            RX.createElement(RX.Text, null, JSON.stringify(this.state.obj))));\r\n    };\r\n    return LookupLscTest;\r\n}(RX.Component));\r\nexports.LookupLscTest = LookupLscTest;\r\n\n\n/***/ }),\n\n/***/ 160:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar data_access_1 = __webpack_require__(163);\r\nvar config_lookup_lsc_1 = __webpack_require__(158);\r\nexports.lookupLscDataAccess = new data_access_1.DataAccess(config_lookup_lsc_1.clientConfig);\r\n\n\n/***/ }),\n\n/***/ 161:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RX = __webpack_require__(54);\r\nvar app_1 = __webpack_require__(157);\r\nRX.App.initialize(true, true);\r\nRX.UserInterface.setMainView(RX.createElement(app_1.App, null));\r\n\n\n/***/ }),\n\n/***/ 162:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ids = [];\r\nvar CANCEL = -1;\r\nfunction setInterval_exponentialBackoff(callback, timeMs, options) {\r\n    if (timeMs === void 0) { timeMs = 1000; }\r\n    var maxTime = options.maxTime;\r\n    var maxAttempts = options.maxAttempts || (!maxTime ? 5 : undefined);\r\n    var base = options.base || 2;\r\n    var id = ids.length;\r\n    ids.push(0);\r\n    var attempt = 0;\r\n    var call = function () {\r\n        callback();\r\n        if (ids[id] === CANCEL) {\r\n            return;\r\n        }\r\n        attempt++;\r\n        if (!maxAttempts || attempt < maxAttempts) {\r\n            var backoffTime = timeMs * Math.pow(base, attempt);\r\n            var actualTime = maxTime ? Math.min(maxTime, backoffTime) : backoffTime;\r\n            console.log('setInterval_exponentialBackoff', { actualTime: actualTime, backoffTime: backoffTime, timeMs: timeMs, maxTime: maxTime, maxAttempts: maxAttempts, base: base });\r\n            ids[id] = setTimeout(function () {\r\n                call();\r\n            }, actualTime);\r\n        }\r\n    };\r\n    call();\r\n    return id;\r\n}\r\nexports.setInterval_exponentialBackoff = setInterval_exponentialBackoff;\r\nfunction clearInterval_exponentialBackoff(id) {\r\n    clearTimeout(ids[id]);\r\n    ids[id] = CANCEL;\r\n}\r\nexports.clearInterval_exponentialBackoff = clearInterval_exponentialBackoff;\r\n\n\n/***/ }),\n\n/***/ 163:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar node_fetch_1 = __webpack_require__(406);\r\nvar time_1 = __webpack_require__(162);\r\nvar DataAccess = (function () {\r\n    function DataAccess(config) {\r\n        this.config = config;\r\n    }\r\n    DataAccess.prototype.read = function (key) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2 /*return*/, readAppBlob(this.config, key)];\r\n            });\r\n        });\r\n    };\r\n    DataAccess.prototype.readAndUpdate = function (key, options, notifyUpdate) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2 /*return*/, readAppBlobAndUpdate(this.config, key, options, notifyUpdate)];\r\n            });\r\n        });\r\n    };\r\n    return DataAccess;\r\n}());\r\nexports.DataAccess = DataAccess;\r\nfunction readAppBlob(config, key) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var data;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, readAppBlob_inner(config, key)];\r\n                case 1:\r\n                    data = (_a.sent()).data;\r\n                    return [2 /*return*/, data];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.readAppBlob = readAppBlob;\r\nfunction readAppBlob_inner(config, key) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var rLookup, lookup;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, node_fetch_1.default(config.getLookupUrl(key))];\r\n                case 1:\r\n                    rLookup = _a.sent();\r\n                    return [4 /*yield*/, rLookup.json()];\r\n                case 2:\r\n                    lookup = _a.sent();\r\n                    if (!lookup.error) return [3 /*break*/, 3];\r\n                    return [2 /*return*/, { data: null, lookup: lookup }];\r\n                case 3: return [4 /*yield*/, readAppBlobData(config, key, lookup)];\r\n                case 4: return [2 /*return*/, _a.sent()];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.readAppBlob_inner = readAppBlob_inner;\r\nfunction readAppBlobData(config, key, lookup) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var r, data;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, node_fetch_1.default(config.getDataDownloadUrl(key, lookup))];\r\n                case 1:\r\n                    r = _a.sent();\r\n                    return [4 /*yield*/, r.json()];\r\n                case 2:\r\n                    data = _a.sent();\r\n                    return [2 /*return*/, { data: data, lookup: lookup }];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.readAppBlobData = readAppBlobData;\r\nfunction readAppBlobAndUpdate(config, key, options, notifyUpdate) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _this = this;\r\n        var _a, data, lookup, refreshTimeoutId_1, cancel_1, lookupLoop_1;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, readAppBlob_inner(config, key)];\r\n                case 1:\r\n                    _a = _b.sent(), data = _a.data, lookup = _a.lookup;\r\n                    if (notifyUpdate) {\r\n                        refreshTimeoutId_1 = 0;\r\n                        cancel_1 = function () {\r\n                            clearTimeout(refreshTimeoutId_1);\r\n                        };\r\n                        lookupLoop_1 = function () {\r\n                            var intervalId = time_1.setInterval_exponentialBackoff(function () { return __awaiter(_this, void 0, void 0, function () {\r\n                                var rLookup_update, lookup_update, data_1;\r\n                                return __generator(this, function (_a) {\r\n                                    switch (_a.label) {\r\n                                        case 0: return [4 /*yield*/, node_fetch_1.default(config.getLookupUrl(key))];\r\n                                        case 1:\r\n                                            rLookup_update = _a.sent();\r\n                                            return [4 /*yield*/, rLookup_update.json()];\r\n                                        case 2:\r\n                                            lookup_update = _a.sent();\r\n                                            if (!(JSON.stringify(lookup_update.timeKey) !== JSON.stringify(lookup.timeKey))) return [3 /*break*/, 4];\r\n                                            lookup = lookup_update;\r\n                                            time_1.clearInterval_exponentialBackoff(intervalId);\r\n                                            return [4 /*yield*/, readAppBlobData(config, key, lookup_update)];\r\n                                        case 3:\r\n                                            data_1 = (_a.sent()).data;\r\n                                            notifyUpdate(data_1, cancel_1);\r\n                                            if (options.shouldAutoRefresh) {\r\n                                                refreshTimeoutId_1 = setTimeout(lookupLoop_1, lookup.timeToExpireSeconds * 1000);\r\n                                            }\r\n                                            _a.label = 4;\r\n                                        case 4: return [2 /*return*/];\r\n                                    }\r\n                                });\r\n                            }); }, config.timePollSeconds * 1000, {\r\n                                maxAttempts: options.shouldAutoRefresh ? undefined : config.maxPollCount,\r\n                                maxTime: options.shouldAutoRefresh ? config.timeToLiveSeconds * 1000 / 2 : undefined,\r\n                            });\r\n                        };\r\n                        lookupLoop_1();\r\n                    }\r\n                    return [2 /*return*/, data];\r\n            }\r\n        });\r\n    });\r\n}\r\nexports.readAppBlobAndUpdate = readAppBlobAndUpdate;\r\n\n\n/***/ }),\n\n/***/ 164:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ClientConfig = (function () {\r\n    function ClientConfig(options) {\r\n        this.timePollSeconds = 1;\r\n        this.maxPollCount = 5;\r\n        this.timeToLiveSeconds = 60;\r\n        this.lookup_domain = '/';\r\n        this.lookup_route = 'api/lookup-lsc';\r\n        this.downloadBlob_domain = '/';\r\n        this.downloadBlob_route = 'blob';\r\n        // WARNING: Gzip is not working in the 4th step: Reading from .gzip blob with node and sending to client\r\n        // In addition, since using a function instead of proxy, gzip is done automatically by the function\r\n        // So it is not needed, and would only be useful to reduce storage size at the cost of increased processing\r\n        this.shouldGzipDownloadBlob = false;\r\n        Object.assign(this, options);\r\n    }\r\n    ClientConfig.prototype.getLookupUrl = function (key) {\r\n        return this.lookup_domain + \"/\" + this.lookup_route + \"/\" + key.containerName + \"/\" + key.blobName;\r\n    };\r\n    ClientConfig.prototype.getDataDownloadUrl = function (key, lookup) {\r\n        return this.downloadBlob_domain + \"/\" + (this.downloadBlob_route ? this.downloadBlob_route + '/' : '') + key.containerName + \"/\" + this.getDataDownloadBlobName(key.blobName, lookup);\r\n    };\r\n    ClientConfig.prototype.getDataDownloadBlobName = function (blobName, lookup) {\r\n        // TODO: Test if works with .ext and switch to underscore if needed\r\n        return blobName + \"/\" + lookup.timeKey + (this.shouldGzipDownloadBlob ? '_gzip' : '');\r\n    };\r\n    return ClientConfig;\r\n}());\r\nexports.ClientConfig = ClientConfig;\r\n\n\n/***/ }),\n\n/***/ 409:\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ })\n\n},[161]);\n\n\n// WEBPACK FOOTER //\n// bundle.js","import * as RX from 'reactxp';\r\nimport { LookupLscTest } from \"./components/lookup-lsc-test\";\r\n// import { Store } from './store/store';\r\n// import { handleRoute } from \"./routes\";\r\n// import { Root } from \"./components/page/root\";\r\n\r\n// const store = Store;\r\n\r\n// handleRoute();\r\n\r\n// <Root store={store} />\r\nexport const App = () => (\r\n    <RX.View>\r\n        <RX.Text>TEST</RX.Text>\r\n        <LookupLscTest />\r\n    </RX.View>\r\n);\n\n\n// WEBPACK FOOTER //\n// ./src/app/app.tsx","import { ClientConfig } from \"@told/stack/src/data-patterns/lookup-lsc/src-config/client-config\";\r\n\r\nexport const clientConfig = new ClientConfig({\r\n    // lookup_domain: 'https://told-stack-demo.azurewebsites.net',\r\n    // downloadBlob_domain: 'https://told-stack-demo.azurewebsites.net',\r\n    lookup_domain: 'https://told-stack-demo.azureedge.net',\r\n    downloadBlob_domain: 'https://told-stack-demo.azureedge.net',\r\n\r\n    lookup_route: 'api/lookup-lsc',\r\n    downloadBlob_route: 'api/lookup-lsc-download'\r\n});\n\n\n// WEBPACK FOOTER //\n// ./config/config-lookup-lsc.ts","import * as RX from 'reactxp';\r\nimport { lookupLscDataAccess } from \"../server-access/lookup-lsc-data-access\";\r\n\r\n\r\nexport class LookupLscTest extends RX.Component<{}, {\r\n    hasStarted: boolean,\r\n    isWaitingForUpdate: boolean,\r\n    obj: any,\r\n}>{\r\n\r\n    notifyUpdate = async (data: any) => {\r\n        const obj = data;\r\n\r\n        this.setState({\r\n            hasStarted: true,\r\n            isWaitingForUpdate: false,\r\n            obj\r\n        });\r\n    }\r\n\r\n    download = async () => {\r\n        const obj = await lookupLscDataAccess.readAndUpdate({ blobName: 'test', containerName: 'test' }, { shouldAutoRefresh: true }, this.notifyUpdate);\r\n\r\n        this.setState({\r\n            hasStarted: true,\r\n            isWaitingForUpdate: true,\r\n            obj\r\n        });\r\n    }\r\n\r\n    render() {\r\n\r\n        if (!this.state.hasStarted) {\r\n            this.setState({\r\n                hasStarted: true,\r\n            } as any);\r\n\r\n            setTimeout(this.download);\r\n        }\r\n\r\n        return (\r\n            <RX.View>\r\n                <RX.Text>hasStarted: {'' + this.state.hasStarted}</RX.Text>\r\n                <RX.Text>isWaitingForUpdate: {'' + this.state.isWaitingForUpdate}</RX.Text>\r\n                <RX.Text>{JSON.stringify(this.state.obj)}</RX.Text>\r\n            </RX.View>\r\n        );\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/app/components/lookup-lsc-test.tsx","import { DataAccess } from '@told/stack/src/data-patterns/lookup-lsc/src-client/data-access';\r\nimport { clientConfig } from '../../../config/config-lookup-lsc';\r\n\r\nexport const lookupLscDataAccess = new DataAccess(clientConfig);\n\n\n// WEBPACK FOOTER //\n// ./src/app/server-access/lookup-lsc-data-access.ts","import * as RX from 'reactxp';\r\nimport { App } from './app/app';\r\n\r\nRX.App.initialize(true, true);\r\nRX.UserInterface.setMainView(<App />);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.tsx","const ids: any[] = [];\r\nconst CANCEL = -1;\r\n\r\nexport function setInterval_exponentialBackoff(callback: () => void, timeMs = 1000, options: {\r\n    maxAttempts?: number,\r\n    base?: number,\r\n    maxTime?: number,\r\n}): number {\r\n\r\n    const maxTime = options.maxTime;\r\n    const maxAttempts = options.maxAttempts || (!maxTime ? 5 : undefined);\r\n    const base = options.base || 2;\r\n\r\n    const id = ids.length;\r\n    ids.push(0);\r\n\r\n    let attempt = 0;\r\n\r\n    const call = () => {\r\n        callback();\r\n        if (ids[id] === CANCEL) { return; }\r\n\r\n        attempt++;\r\n\r\n        if (!maxAttempts || attempt < maxAttempts) {\r\n            const backoffTime = timeMs * Math.pow(base, attempt);\r\n            const actualTime = maxTime ? Math.min(maxTime, backoffTime) : backoffTime;\r\n            console.log('setInterval_exponentialBackoff', { actualTime, backoffTime, timeMs, maxTime, maxAttempts, base });\r\n\r\n            ids[id] = setTimeout(() => {\r\n                call();\r\n            }, actualTime);\r\n        }\r\n    };\r\n\r\n    call();\r\n    return id;\r\n}\r\n\r\nexport function clearInterval_exponentialBackoff(id: number) {\r\n    clearTimeout(ids[id]);\r\n    ids[id] = CANCEL;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/core/utils/time.ts","import fetch from 'node-fetch';\r\nimport { ClientConfigType, DataKey, LookupResponse, LookupData } from \"../src-config/client-config\";\r\nimport { setInterval_exponentialBackoff, clearInterval_exponentialBackoff } from \"../../../core/utils/time\";\r\n\r\ninterface NotifyUpdateOptions {\r\n    shouldAutoRefresh: boolean;\r\n}\r\n\r\nexport class DataAccess<T> {\r\n    constructor(private config: ClientConfigType) { }\r\n\r\n    async read(key: DataKey) {\r\n        return readAppBlob<T>(this.config, key);\r\n    }\r\n\r\n    async readAndUpdate(key: DataKey, options: NotifyUpdateOptions, notifyUpdate: (newData: T) => void) {\r\n        return readAppBlobAndUpdate<T>(this.config, key, options, notifyUpdate);\r\n    }\r\n}\r\n\r\nexport async function readAppBlob<T>(config: ClientConfigType, key: DataKey) {\r\n    const { data } = await readAppBlob_inner<T>(config, key);\r\n    return data;\r\n}\r\n\r\nexport async function readAppBlob_inner<T>(config: ClientConfigType, key: DataKey) {\r\n    const rLookup = await fetch(config.getLookupUrl(key));\r\n    const lookup = await rLookup.json() as LookupResponse;\r\n    if (lookup.error) {\r\n        return { data: null as T, lookup };\r\n    } else {\r\n        return await readAppBlobData<T>(config, key, lookup);\r\n    }\r\n}\r\nexport async function readAppBlobData<T>(config: ClientConfigType, key: DataKey, lookup: LookupResponse) {\r\n    const r = await fetch(config.getDataDownloadUrl(key, lookup as LookupData));\r\n    const data = await r.json() as T;\r\n    return { data, lookup };\r\n}\r\n\r\nexport async function readAppBlobAndUpdate<T>(config: ClientConfigType, key: DataKey, options: NotifyUpdateOptions, notifyUpdate: (newData: T, cancel: () => void) => void) {\r\n    let { data, lookup } = await readAppBlob_inner<T>(config, key);\r\n\r\n    if (notifyUpdate) {\r\n\r\n        let refreshTimeoutId: any = 0;\r\n        const cancel = () => {\r\n            clearTimeout(refreshTimeoutId);\r\n        };\r\n\r\n        const lookupLoop = () => {\r\n            const intervalId = setInterval_exponentialBackoff(async () => {\r\n                const rLookup_update = await fetch(config.getLookupUrl(key));\r\n                const lookup_update = await rLookup_update.json() as LookupResponse;\r\n\r\n                if (JSON.stringify(lookup_update.timeKey) !== JSON.stringify(lookup.timeKey)) {\r\n                    lookup = lookup_update;\r\n                    clearInterval_exponentialBackoff(intervalId);\r\n\r\n                    const { data } = await readAppBlobData<T>(config, key, lookup_update);\r\n                    notifyUpdate(data, cancel);\r\n\r\n                    if (options.shouldAutoRefresh) {\r\n                        refreshTimeoutId = setTimeout(lookupLoop, lookup.timeToExpireSeconds * 1000);\r\n                    }\r\n                }\r\n            }, config.timePollSeconds * 1000, {\r\n                    maxAttempts: options.shouldAutoRefresh ? undefined : config.maxPollCount,\r\n                    maxTime: options.shouldAutoRefresh ? config.timeToLiveSeconds * 1000 / 2 : undefined,\r\n                });\r\n        };\r\n\r\n        lookupLoop();\r\n\r\n    }\r\n\r\n    return data;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/data-patterns/lookup-lsc/src-client/data-access.ts","import { HttpFunctionRequest } from \"../../../core/types/functions\";\r\n\r\nexport interface DataKey {\r\n    containerName: string;\r\n    blobName: string;\r\n}\r\n\r\nexport interface LookupData {\r\n    timeKey: string\r\n}\r\n\r\nexport interface LookupResponse {\r\n    timeKey?: string;\r\n    error?: string;\r\n    timeToExpireSeconds: number;\r\n}\r\n\r\nexport interface ClientConfigType {\r\n    timeToLiveSeconds: number;\r\n    timePollSeconds: number;\r\n    maxPollCount: number;\r\n\r\n    getLookupUrl(key: DataKey): string;\r\n    getDataDownloadUrl(key: DataKey, lookup: LookupData): string;\r\n}\r\n\r\nexport interface ClientConfigOptions {\r\n    timeToLiveSeconds: number;\r\n    timePollSeconds: number;\r\n    maxPollCount: number;\r\n    lookup_domain: string;\r\n    lookup_route: string;\r\n    downloadBlob_domain: string;\r\n    downloadBlob_route: string;\r\n}\r\n\r\nexport class ClientConfig implements ClientConfigType, ClientConfigOptions {\r\n    timePollSeconds = 1;\r\n    maxPollCount = 5;\r\n    timeToLiveSeconds = 60;\r\n\r\n    lookup_domain = '/';\r\n    lookup_route = 'api/lookup-lsc';\r\n    downloadBlob_domain = '/';\r\n    downloadBlob_route = 'blob';\r\n\r\n    // WARNING: Gzip is not working in the 4th step: Reading from .gzip blob with node and sending to client\r\n    // In addition, since using a function instead of proxy, gzip is done automatically by the function\r\n    // So it is not needed, and would only be useful to reduce storage size at the cost of increased processing\r\n    shouldGzipDownloadBlob = false;\r\n\r\n    constructor(options?: Partial<ClientConfigOptions>) {\r\n        Object.assign(this, options);\r\n    }\r\n\r\n    getLookupUrl(key: DataKey): string {\r\n        return `${this.lookup_domain}/${this.lookup_route}/${key.containerName}/${key.blobName}`;\r\n    }\r\n\r\n    getDataDownloadUrl(key: DataKey, lookup: LookupData): string {\r\n        return `${this.downloadBlob_domain}/${this.downloadBlob_route ? this.downloadBlob_route + '/' : ''}${key.containerName}/${this.getDataDownloadBlobName(key.blobName, lookup)}`;\r\n    }\r\n\r\n    getDataDownloadBlobName(blobName: string, lookup: LookupData) {\r\n        // TODO: Test if works with .ext and switch to underscore if needed\r\n        return `${blobName}/${lookup.timeKey}${this.shouldGzipDownloadBlob ? '_gzip' : ''}`;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./../../../told-stack-npm/src/data-patterns/lookup-lsc/src-config/client-config.ts"],"sourceRoot":""}